!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.powerProduction=t():e.powerProduction=t()}(this,(()=>(()=>{"use strict";var e,t=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(e){a(e)}}function c(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}d((o=o.apply(e,t||[])).next())}))},n=function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(d){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,d])}}};return function(e){e.Add="add",e.Delete="delete",e.Update="update",e.Calculate="calculate"}(e||(e={})),(new(function(){function o(){this.powerProduction=$("#powerProduction"),this.newInput=$("#powerProductionCardNew")}return o.prototype.addNewPowerPlant=function(o){return t(this,void 0,void 0,(function(){var t,r,a,i,c,d;return n(this,(function(n){switch(n.label){case 0:return t=this.newInput.find("#building option:selected").text(),r=this.newInput.find("#amount").val()||"1",a=this.newInput.find("#clock_speed").val()||"100",this.validateAndHandleInput(t,r,a)?(i=this.newCard(),[4,this.applyToDatabase(e.Add,o)]):[2];case 1:return(c=n.sent()).hasOwnProperty("error")?(console.error(c.error),[2]):(this.powerProduction.find("#noPowerBuildings").length>0&&this.powerProduction.find("#noPowerBuildings").remove(),d="powerProductionCard".concat(c.powerProductionId),i.attr("id",d),i.find(".col-5 h6").text(t),i.find("#amount").val(r.toString()),i.find("#clock_speed").val(a),this.applyEventListenersToCard(i),this.powerProduction.append(i),this.resetAddCard(),this.calculatePowerProduction(),[2])}}))}))},o.prototype.deletePowerPlant=function(o){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return[4,this.applyToDatabase(e.Delete,o)];case 1:return(t=n.sent()).hasOwnProperty("error")?(console.error(t.error),[2]):($(o).closest(".card").remove(),0===this.powerProduction.find(".card").length&&this.powerProduction.append('<div class="alert alert-warning text-center" id="noPowerBuildings" role="alert">\n                                Oh no! You don\'t have any power production buildings yet. Add some down below.\n                            </div>'),this.calculatePowerProduction(),[2])}}))}))},o.prototype.updatePowerPlant=function(o){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return[4,this.applyToDatabase(e.Update,o)];case 1:return(t=n.sent()).hasOwnProperty("error")?(console.error(t.error),[2]):(this.calculatePowerProduction(),[2])}}))}))},o.prototype.calculatePowerProduction=function(){return t(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:return[4,this.applyToDatabase(e.Calculate,document.createElement("div"))];case 1:return(t=n.sent()).hasOwnProperty("error")?(console.error(t.error),[2]):(o=t.totalPowerProduction,updatePowerProduction(o),[2])}}))}))},o.prototype.applyEventListenersToCard=function(e){var t=this,n=e.find(".deletePowerProduction"),o=e.find("input");n.length>0&&n.on("click",(function(e){t.deletePowerPlant(e.currentTarget)})),o.length>0&&o.on("change",(function(e){t.updatePowerPlant(e.currentTarget)}))},o.prototype.applyEventListeners=function(){var e=this,t=this.newInput.find("button"),n=this.powerProduction.find(".deletePowerProduction"),o=this.powerProduction.find("input");t&&t.on("click",(function(t){e.addNewPowerPlant(t.currentTarget)})),n&&n.on("click",(function(t){e.deletePowerPlant(t.currentTarget)})),o&&o.on("change",(function(t){e.updatePowerPlant(t.currentTarget)}))},o.prototype.checkAndHandleNoPowerPlants=function(){0===this.powerProduction.find(".card").length&&this.powerProduction.append("<h6>No power plants added yet</h6>")},o.prototype.newCard=function(){var e=document.createElement("div");e.className="card mb-2";var t=document.createElement("div");return t.className="card-body p-2 row d-flex justify-content-between align-items-center",t.innerHTML='\n        <div class="col-5 col-lg-6 ps-3 pe-1">\n            <h6 class="m-0"></h6>\n        </div>\n        <div class="col-2 px-1">\n            <input type="number" class="form-control" id="amount" name="amount"\n                   min="1" max="1000">\n        </div>\n        <div class="col-2 px-1">\n            <input type="number" class="form-control" id="clock_speed"\n                   name="clock_speed" min="1" max="250" step="any">\n        </div>\n        <div class="col-3 col-lg-2 text-end ps-1 pe-3">\n            <button type="button" class="btn btn-danger deletePowerProduction">\n            Delete\n            </button>\n        </div>\n    ',e.appendChild(t),$(e)},o.prototype.resetAddCard=function(){this.newInput.find("#amount").val("1"),this.newInput.find("#clock_speed").val("100"),this.newInput.find("select").prop("selectedIndex",0)},o.prototype.validateAndHandleInput=function(e,t,n){var o=this,r=function(e){return o.newInput.find(e).addClass("is-invalid")},a=function(e){return o.newInput.find(e).removeClass("is-invalid")},i=!1;a("#building"),a("#amount"),a("#clock_speed"),e&&"Select a building"!==e||(r("#building"),i=!0);var c=parseFloat(Array.isArray(t)?t[0]:t.toString());(isNaN(c)||c<1||c>1e3)&&(r("#amount"),i=!0);var d=parseFloat(Array.isArray(n)?n[0]:n.toString());return(isNaN(d)||d<1||d>250)&&(r("#clock_speed"),i=!0),!i},o._getCsrfToken=function(){var e=$('meta[name="csrf-token"]');if(0===e.length||void 0===e.attr("content"))throw new Error("CSRF token not found");return e.attr("content")},o.prototype.applyToDatabase=function(r,a){return t(this,void 0,void 0,(function(){var t,i,c,d,u,s,l,p,f,w;return n(this,(function(n){switch(t=$(a).closest(".card"),i=t.attr("id")||"",c=i.replace("powerProductionCard",""),d=new URL(window.location.href),u=d.searchParams.get("id"),r){case e.Add:return s=t.find("#building").val(),l=t.find("#amount").val(),p=t.find("#clock_speed").val(),[2,new Promise((function(e,t){$.ajax({url:"powerProduction/add",type:"POST",dataType:"json",headers:{"X-CSRF-Token":o._getCsrfToken()},data:{gameSaveId:u,buildingId:s,amount:l,clockSpeed:p},success:function(t){e(t)}})}))];case e.Delete:return[2,new Promise((function(e,t){$.ajax({url:"powerProduction/delete",type:"POST",dataType:"json",headers:{"X-CSRF-Token":o._getCsrfToken()},data:{gameSaveId:u,powerProductionId:c},success:function(t){e(t)}})}))];case e.Update:return f=t.find("#amount").val(),w=t.find("#clock_speed").val(),[2,new Promise((function(e,t){$.ajax({url:"powerProduction/update",type:"POST",dataType:"json",headers:{"X-CSRF-Token":o._getCsrfToken()},data:{gameSaveId:u,powerProductionId:c,amount:f,clockSpeed:w},success:function(t){e(t)}})}))];case e.Calculate:return[2,new Promise((function(e,t){$.ajax({url:"powerProduction/calculate",type:"POST",dataType:"json",headers:{"X-CSRF-Token":o._getCsrfToken()},data:{gameSaveId:u},success:function(t){e(t)}})}))]}return[2]}))}))},o}())).applyEventListeners(),{}})()));