!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.tables=n():t.tables=n()}(this,(()=>(()=>{"use strict";var t=function(t,n,e){void 0===t&&(t=0),void 0===n&&(n=0),void 0===e&&(e=""),this.itemId=t,this.quantity=n,this.product=e},n=function(){function t(){}return t.getRecipe=function(t){return new Promise((function(n,e){$.ajax({type:"GET",url:"getRecipe",data:{id:t},dataType:"json",success:function(t){try{n(t)}catch(t){e(t)}},error:function(t,n,o){e(o)}})}))},t.getBuilding=function(t){return new Promise((function(n,e){$.ajax({type:"GET",url:"getBuilding",data:{id:t},dataType:"json",success:function(t){try{n(t)}catch(t){e(t)}},error:function(t,n,o){e(o)}})}))},t.saveData=function(t,n){return e=this,o=void 0,r=function(){return function(t,n){var e,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(a=0)),a;)try{if(e=1,o&&(i=2&u[0]?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,o=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=n.call(t,a)}catch(t){u=[6,t],o=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}(this,(function(e){return[2,new Promise((function(e,o){$.ajax({type:"POST",url:"saveProductionLine",data:{data:JSON.stringify(t),id:n},success:function(t){e(JSON.parse(t))},error:function(t,n,e){o(e)}})}))]}))},new((i=void 0)||(i=Promise))((function(t,n){function a(t){try{l(r.next(t))}catch(t){n(t)}}function u(t){try{l(r.throw(t))}catch(t){n(t)}}function l(n){var e;n.done?t(n.value):(e=n.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,u)}l((r=r.apply(e,o||[])).next())}));var e,o,i,r},t}(),e=function(t,n,e,o){void 0===t&&(t=""),void 0===n&&(n=0),void 0===e&&(e=0),void 0===o&&(o=0),this.Product=t,this.Usage=n,this.ExportPerMin=e,this.Quantity=o},o=function(t,n,e,o){return new(e||(e=Promise))((function(i,r){function a(t){try{l(o.next(t))}catch(t){r(t)}}function u(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}l((o=o.apply(t,n||[])).next())}))},i=function(t,n){var e,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(a=0)),a;)try{if(e=1,o&&(i=2&u[0]?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,o=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=n.call(t,a)}catch(t){u=[6,t],o=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}},r=function(){function t(){}return t.calculateProductionExport=function(t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(e){return t.exportPerMin=t.quantity-t.Usage,t.doubleExport&&null!==t.recipe&&void 0!==(n=this.calculateSecondExportPerMin(t))&&(t.extraCells.Quantity=n,t.extraCells.ExportPerMin=n),[2]}))}))},t.updateRecipe=function(t,n){return o(this,void 0,void 0,(function(){var o,r,a,u,l;return i(this,(function(i){switch(i.label){case 0:return[4,this.saveRecipe(n,t)];case 1:return i.sent(),null===(o=t.recipe)||(t.recipeId=o.id,t.product=o.itemName,t.doubleExport=null!==o.secondItemName,t.doubleExport&&(r=+o.export_amount_per_min,a=+o.export_amount_per_min2,u=a/r,l=t.quantity,t.extraCells=new e(o.secondItemName,0,l*u))),[2]}}))}))},t.saveRecipe=function(t,e){return o(this,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:return o=e,[4,n.getRecipe(+t)];case 1:return o.recipe=i.sent(),[2]}}))}))},t.handleDoubleExport=function(t,n){if(t.doubleExport&&null!==t.extraCells)if(n.next(".extra-output").length){var e=(i=n.next(".extra-output")).find('input[name="production_usage2[]"]'),o=i.find('input[name="production_export2[]"]');e.val(t.extraCells.Usage),o.val(t.extraCells.ExportPerMin)}else{var i;n.find("td:first").attr("rowspan",2),n.find("td:nth-child(2)").attr("rowspan",2),n.find("td:first select").css("height","78px"),n.find("td:nth-child(2) input").css("height","78px"),(i=$('\n                    <tr class="extra-output">\n                        <td class="m-0 p-0">\n                            <input type="text" name="product" value="'.concat(t.extraCells.Product,'" class="form-control rounded-0" readonly>\n                        </td>\n                        <td class="m-0 p-0">\n                            <input type="number" name="production_usage2[]" value="').concat(t.extraCells.Usage,'" class="form-control rounded-0" readonly step="any">\n                        </td>\n                        <td class="m-0 p-0">\n                            <input type="number" name="production_export2[]" value="').concat(t.extraCells.ExportPerMin,'" class="form-control rounded-0" readonly step="any">\n                        </td>\n                    </tr>\n                '))).insertAfter(n)}else n.next(".extra-output").length&&(n.next(".extra-output").remove(),n.find("td:first").removeAttr("rowspan"),n.find("td:nth-child(2)").removeAttr("rowspan"),n.find("td:first select").css("height",""),n.find("td:nth-child(2) input").css("height",""))},t.calculateSecondExportPerMin=function(t){if(null!==t.recipe){var n=t.recipe.export_amount_per_min2,e=t.recipe.export_amount_per_min;if(null!==n&&null!==e){var o=n/e;return t.quantity*o}}},t}(),a=function(){function t(t,n,e,o,i,r,a){void 0===t&&(t=""),void 0===n&&(n=0),void 0===e&&(e=""),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=null);var u=this;this.recipeId=+t,this.quantity=n,this.product=e,this.Usage=o,this.exportPerMin=i,this.doubleExport=r,this.extraCells=a,this.recipe=null,this.imports=[],this.productionImports=[],this.getRecipe(t).then((function(t){return u.saveDoubleExportQuantity()}))}return t.prototype.getRecipe=function(t){return e=this,o=void 0,r=function(){var e;return function(t,n){var e,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(a=0)),a;)try{if(e=1,o&&(i=2&u[0]?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,o=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=n.call(t,a)}catch(t){u=[6,t],o=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}(this,(function(o){switch(o.label){case 0:return e=this,[4,n.getRecipe(+t)];case 1:return e.recipe=o.sent(),[2]}}))},new((i=void 0)||(i=Promise))((function(t,n){function a(t){try{l(r.next(t))}catch(t){n(t)}}function u(t){try{l(r.throw(t))}catch(t){n(t)}}function l(n){var e;n.done?t(n.value):(e=n.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,u)}l((r=r.apply(e,o||[])).next())}));var e,o,i,r},t.prototype.saveDoubleExportQuantity=function(){this.doubleExport&&null!==this.extraCells&&(this.extraCells.Quantity=r.calculateSecondExportPerMin(this))},t}(),u=function(t,e,o,i,r,a){void 0===t&&(t=NaN),void 0===e&&(e=0),void 0===o&&(o=100),void 0===i&&(i=0),void 0===r&&(r=!0),void 0===a&&(a=null);var u=this;this.buildingId=t,this.quantity=e,this.clockSpeed=o,this.Consumption=i,this.userRow=r,this.building=a,isNaN(t)||null===t||null!==a||n.getBuilding(t).then((function(t){u.building=t}))},l='\n  <option value="" disabled>Select a building</option>\n  <option value="16">Assembler</option>\n  <option value="17">Blender</option>\n  <option value="19">Constructor</option>\n  <option value="6">Converter</option>\n  <option value="13">Foundry</option>\n  <option value="21">Main Portal</option>\n  <option value="15">Manufacturer</option>\n  <option value="10">Miner Mk.1</option>\n  <option value="9">Miner Mk.2</option>\n  <option value="11">Miner Mk.3</option>\n  <option value="8">Oil Extractor</option>\n  <option value="14">Packager</option>\n  <option value="7">Particle Accelerator</option>\n  <option value="5">Quantum Encoder</option>\n  <option value="12">Refinery</option>\n  <option value="22">Satellite Portal</option>\n  <option value="18">Smelter</option>\n  <option value="4">Water Extractor</option>\n',s='\n<option value="" disabled>Select an item</option>\n<option value="111">Actual Snow</option>\n<option value="82">Adaptive Control Unit</option>\n<option value="48">AI Expansion Server</option>\n<option value="79">AI Limiter</option>\n<option value="45">Alclad Aluminum Sheet</option>\n<option value="102">Alien DNA Capsule</option>\n<option value="100">Alien Protein</option>\n<option value="72">Alumina Solution</option>\n<option value="71">Aluminum Casing</option>\n<option value="7">Aluminum Ingot</option>\n<option value="70">Aluminum Scrap</option>\n<option value="56">Assembly Director System</option>\n<option value="77">Automated Wiring</option>\n<option value="98">Ballistic Warp Drive</option>\n<option value="8">Battery</option>\n<option value="128">Bauxite</option>\n<option value="55">Biochemical Sculptor</option>\n<option value="137">Biomass</option>\n<option value="95">Black Powder</option>\n<option value="117">Blue FICSMAS Ornament</option>\n<option value="101">Blue Power Slug</option>\n<option value="20">Cable</option>\n<option value="110">Candy Cane</option>\n<option value="57">Caterium Ingot</option>\n<option value="129">Caterium Ore</option>\n<option value="59">Circuit Board</option>\n<option value="123">Coal</option>\n<option value="14">Compacted Coal</option>\n<option value="73">Computer</option>\n<option value="3">Concrete</option>\n<option value="37">Cooling System</option>\n<option value="113">Copper FICSMAS Ornament</option>\n<option value="69">Copper Ingot</option>\n<option value="130">Copper Ore</option>\n<option value="88">Copper Powder</option>\n<option value="26">Copper Sheet</option>\n<option value="134">Crude Oil</option>\n<option value="32">Crystal Oscillator</option>\n<option value="34">Dark Matter Crystal</option>\n<option value="41">Dark Matter Residue</option>\n<option value="44">Diamonds</option>\n<option value="93">Dissolved Silica</option>\n<option value="90">Electromagnetic Control Rod</option>\n<option value="58">Empty Canister</option>\n<option value="31">Empty Fluid Tank</option>\n<option value="61">Encased Industrial Beam</option>\n<option value="84">Encased Plutonium Cell</option>\n<option value="92">Encased Uranium Cell</option>\n<option value="43">Excited Photonic Matter</option>\n<option value="146">Fabric</option>\n<option value="54">Ficsite Ingot</option>\n<option value="38">Ficsite Trigon</option>\n<option value="112">FICSMAS Bow</option>\n<option value="109">FICSMAS Decoration</option>\n<option value="118">FICSMAS Gift</option>\n<option value="108">FICSMAS Ornament Bundle</option>\n<option value="115">FICSMAS Tree Branch</option>\n<option value="107">FICSMAS Wonder Star</option>\n<option value="96">Ficsonium</option>\n<option value="121">Ficsonium Fuel Rod</option>\n<option value="24">Fuel</option>\n<option value="52">Fused Modular Frame</option>\n<option value="99">Gas Filter</option>\n<option value="150">Hatcher Remains</option>\n<option value="89">Heat Sink</option>\n<option value="74">Heavy Modular Frame</option>\n<option value="64">Heavy Oil Residue</option>\n<option value="76">High-Speed Connector</option>\n<option value="147">Hog Remains</option>\n<option value="13">Iodine-Infused Filter</option>\n<option value="35">Ionized Fuel</option>\n<option value="114">Iron FICSMAS Ornament</option>\n<option value="21">Iron Ingot</option>\n<option value="122">Iron Ore</option>\n<option value="5">Iron Plate</option>\n<option value="18">Iron Rod</option>\n<option value="138">Leaves</option>\n<option value="132">Limestone</option>\n<option value="141">Liquid Biofuel</option>\n<option value="49">Magnetic Field Generator</option>\n<option value="103">Mercer Sphere</option>\n<option value="81">Modular Engine</option>\n<option value="27">Modular Frame</option>\n<option value="33">Motor</option>\n<option value="139">Mycelia</option>\n<option value="47">Neural-Quantum Processor</option>\n<option value="29">Nitric Acid</option>\n<option value="125">Nitrogen Gas</option>\n<option value="86">Non-Fissile Uranium</option>\n<option value="91">Nuclear Pasta</option>\n<option value="142">Packaged Alumina Solution</option>\n<option value="9">Packaged Fuel</option>\n<option value="15">Packaged Heavy Oil Residue</option>\n<option value="10">Packaged Ionized Fuel</option>\n<option value="136">Packaged Liquid Biofuel</option>\n<option value="144">Packaged Nitric Acid</option>\n<option value="143">Packaged Nitrogen Gas</option>\n<option value="17">Packaged Oil</option>\n<option value="11">Packaged Rocket Fuel</option>\n<option value="145">Packaged Sulfuric Acid</option>\n<option value="12">Packaged Turbofuel</option>\n<option value="68">Packaged Water</option>\n<option value="16">Petroleum Coke</option>\n<option value="60">Plastic</option>\n<option value="120">Plutonium Fuel Rod</option>\n<option value="85">Plutonium Pellet</option>\n<option value="2">Plutonium Waste</option>\n<option value="63">Polymer Resin</option>\n<option value="83">Pressure Conversion Cube</option>\n<option value="104">Purple Power Slug</option>\n<option value="65">Quartz Crystal</option>\n<option value="80">Quickwire</option>\n<option value="53">Radio Control Unit</option>\n<option value="131">Raw Quartz</option>\n<option value="42">Reanimated SAM</option>\n<option value="116">Red FICSMAS Ornament</option>\n<option value="22">Reinforced Iron Plate</option>\n<option value="25">Rocket Fuel</option>\n<option value="23">Rotor</option>\n<option value="62">Rubber</option>\n<option value="127">SAM</option>\n<option value="50">SAM Fluctuator</option>\n<option value="28">Screw</option>\n<option value="4">Silica</option>\n<option value="97">Singularity Cell</option>\n<option value="75">Smart Plating</option>\n<option value="106">Smokeless Powder</option>\n<option value="135">Solid Biofuel</option>\n<option value="148">Spitter Remains</option>\n<option value="78">Stator</option>\n<option value="6">Steel Beam</option>\n<option value="66">Steel Ingot</option>\n<option value="51">Steel Pipe</option>\n<option value="149">Stinger Remains</option>\n<option value="126">Sulfur</option>\n<option value="87">Sulfuric Acid</option>\n<option value="36">Supercomputer</option>\n<option value="46">Superposition Oscillator</option>\n<option value="94">Thermal Propulsion Rocket</option>\n<option value="40">Time Crystal</option>\n<option value="39">Turbo Motor</option>\n<option value="30">Turbofuel</option>\n<option value="133">Uranium</option>\n<option value="119">Uranium Fuel Rod</option>\n<option value="1">Uranium Waste</option>\n<option value="67">Versatile Framework</option>\n<option value="124">Water</option>\n<option value="19">Wire</option>\n<option value="140">Wood</option>\n<option value="105">Yellow Power Slug</option>\n',p='\n    <option value="" disabled>Select a recipe</option>\n    <option value="259">Actual Snow</option>\n    <option value="116">Adaptive Control Unit</option>\n    <option value="14">AI Expansion Server</option>\n    <option value="110">AI Limiter</option>\n    <option value="95">Alclad Aluminum Sheet</option>\n    <option value="245">Alien DNA Capsule</option>\n    <option value="242">Alien Power Matrix</option>\n    <option value="133">Alternate: Adhered Iron Plate</option>\n    <option value="177">Alternate: Alclad Casing</option>\n    <option value="182">Alternate: Aluminum Beam</option>\n    <option value="183">Alternate: Aluminum Rod</option>\n    <option value="105">Alternate: Automated Speed Wiring</option>\n    <option value="189">Alternate: Basic Iron Ingot</option>\n    <option value="49">Alternate: Biocoal</option>\n    <option value="132">Alternate: Bolted Frame</option>\n    <option value="208">Alternate: Bolted Iron Plate</option>\n    <option value="204">Alternate: Cast Screw</option>\n    <option value="227">Alternate: Caterium Circuit Board</option>\n    <option value="226">Alternate: Caterium Computer</option>\n    <option value="194">Alternate: Caterium Wire</option>\n    <option value="48">Alternate: Charcoal</option>\n    <option value="202">Alternate: Cheap Silica</option>\n    <option value="176">Alternate: Classic Battery</option>\n    <option value="62">Alternate: Cloudy Diamonds</option>\n    <option value="131">Alternate: Coated Cable</option>\n    <option value="130">Alternate: Coated Iron Canister</option>\n    <option value="129">Alternate: Coated Iron Plate</option>\n    <option value="128">Alternate: Coke Steel Ingot</option>\n    <option value="50">Alternate: Compacted Coal</option>\n    <option value="215">Alternate: Compacted Steel Ingot</option>\n    <option value="175">Alternate: Cooling Device</option>\n    <option value="127">Alternate: Copper Alloy Ingot</option>\n    <option value="122">Alternate: Copper Rotor</option>\n    <option value="225">Alternate: Crystal Computer</option>\n    <option value="64">Alternate: Dark Matter Crystallization</option>\n    <option value="63">Alternate: Dark Matter Trap</option>\n    <option value="8">Alternate: Dark-Ion Fuel</option>\n    <option value="174">Alternate: Diluted Fuel</option>\n    <option value="121">Alternate: Diluted Packaged Fuel</option>\n    <option value="185">Alternate: Distilled Silica</option>\n    <option value="173">Alternate: Electric Motor</option>\n    <option value="120">Alternate: Electrode Aluminum Scrap</option>\n    <option value="119">Alternate: Electrode Circuit Board</option>\n    <option value="222">Alternate: Electromagnetic Connection Rod</option>\n    <option value="206">Alternate: Encased Industrial Pipe</option>\n    <option value="172">Alternate: Fertile Uranium</option>\n    <option value="221">Alternate: Fine Black Powder</option>\n    <option value="224">Alternate: Fine Concrete</option>\n    <option value="118">Alternate: Flexible Framework</option>\n    <option value="187">Alternate: Fused Quartz Crystal</option>\n    <option value="210">Alternate: Fused Quickwire</option>\n    <option value="117">Alternate: Fused Wire</option>\n    <option value="220">Alternate: Heat Exchanger</option>\n    <option value="171">Alternate: Heat-Fused Frame</option>\n    <option value="219">Alternate: Heavy Encased Frame</option>\n    <option value="112">Alternate: Heavy Flexible Frame</option>\n    <option value="111">Alternate: Heavy Oil Residue</option>\n    <option value="196">Alternate: Infused Uranium Cell</option>\n    <option value="170">Alternate: Instant Plutonium Cell</option>\n    <option value="169">Alternate: Instant Scrap</option>\n    <option value="230">Alternate: Insulated Cable</option>\n    <option value="223">Alternate: Insulated Crystal Oscillator</option>\n    <option value="217">Alternate: Iron Alloy Ingot</option>\n    <option value="179">Alternate: Iron Pipe</option>\n    <option value="195">Alternate: Iron Wire</option>\n    <option value="193">Alternate: Leached Caterium Ingot</option>\n    <option value="191">Alternate: Leached Copper Ingot</option>\n    <option value="188">Alternate: Leached Iron ingot</option>\n    <option value="181">Alternate: Molded Beam</option>\n    <option value="178">Alternate: Molded Steel Pipe</option>\n    <option value="4">Alternate: Nitro Rocket Fuel</option>\n    <option value="163">Alternate: OC Supercomputer</option>\n    <option value="61">Alternate: Oil-Based Diamonds</option>\n    <option value="60">Alternate: Petroleum Diamonds</option>\n    <option value="59">Alternate: Pink Diamonds</option>\n    <option value="184">Alternate: Plastic AI Limiter</option>\n    <option value="104">Alternate: Plastic Smart Plating</option>\n    <option value="162">Alternate: Plutonium Fuel Unit</option>\n    <option value="248">Alternate: Polyester Fabric</option>\n    <option value="103">Alternate: Polymer Resin</option>\n    <option value="93">Alternate: Pure Aluminum Ingot</option>\n    <option value="92">Alternate: Pure Caterium Ingot</option>\n    <option value="91">Alternate: Pure Copper Ingot</option>\n    <option value="90">Alternate: Pure Iron Ingot</option>\n    <option value="88">Alternate: Pure Quartz Crystal</option>\n    <option value="186">Alternate: Quartz Purification</option>\n    <option value="229">Alternate: Quickwire Cable</option>\n    <option value="201">Alternate: Quickwire Stator</option>\n    <option value="209">Alternate: Radio Connection Unit</option>\n    <option value="161">Alternate: Radio Control System</option>\n    <option value="211">Alternate: Recycled Plastic</option>\n    <option value="87">Alternate: Recycled Rubber</option>\n    <option value="213">Alternate: Rigor Motor</option>\n    <option value="86">Alternate: Rubber Concrete</option>\n    <option value="228">Alternate: Silicon Circuit Board</option>\n    <option value="218">Alternate: Silicon High-Speed Connector</option>\n    <option value="160">Alternate: Sloppy Alumina</option>\n    <option value="216">Alternate: Solid Steel Ingot</option>\n    <option value="85">Alternate: Steamed Copper Sheet</option>\n    <option value="72">Alternate: Steel Canister</option>\n    <option value="180">Alternate: Steel Cast Plate</option>\n    <option value="67">Alternate: Steel Rod</option>\n    <option value="205">Alternate: Steel Rotor</option>\n    <option value="203">Alternate: Steel Screw</option>\n    <option value="214">Alternate: Steeled Frame</option>\n    <option value="207">Alternate: Stitched Iron Plate</option>\n    <option value="156">Alternate: Super-State Computer</option>\n    <option value="192">Alternate: Tempered Caterium Ingot</option>\n    <option value="190">Alternate: Tempered Copper Ingot</option>\n    <option value="145">Alternate: Turbo Blend Fuel</option>\n    <option value="18">Alternate: Turbo Diamonds</option>\n    <option value="198">Alternate: Turbo Electric Motor</option>\n    <option value="66">Alternate: Turbo Heavy Fuel</option>\n    <option value="134">Alternate: Turbo Pressure Motor</option>\n    <option value="212">Alternate: Uranium Fuel Unit</option>\n    <option value="65">Alternate: Wet Concrete</option>\n    <option value="96">Alumina Solution</option>\n    <option value="94">Aluminum Casing</option>\n    <option value="99">Aluminum Ingot</option>\n    <option value="97">Aluminum Scrap</option>\n    <option value="153">Assembly Director System</option>\n    <option value="109">Automated Wiring</option>\n    <option value="234">Ballistic Warp Drive</option>\n    <option value="148">Battery</option>\n    <option value="28">Bauxite (Caterium)</option>\n    <option value="29">Bauxite (Copper)</option>\n    <option value="25">Biochemical Sculptor</option>\n    <option value="240">Biomass (Mycelia)</option>\n    <option value="246">Biomass (Alien Protein)</option>\n    <option value="263">Biomass (Leaves)</option>\n    <option value="264">Biomass (Wood)</option>\n    <option value="241">Black Powder</option>\n    <option value="256">Blue FICSMAS Ornament</option>\n    <option value="268">Cable</option>\n    <option value="262">Candy Cane</option>\n    <option value="197">Caterium Ingot</option>\n    <option value="30">Caterium Ore (Copper)</option>\n    <option value="31">Caterium Ore (Quartz)</option>\n    <option value="51">Circuit Board</option>\n    <option value="32">Coal (Iron)</option>\n    <option value="33">Coal (Limestone)</option>\n    <option value="113">Computer</option>\n    <option value="266">Concrete</option>\n    <option value="147">Cooling System</option>\n    <option value="257">Copper FICSMAS Ornament</option>\n    <option value="270">Copper Ingot</option>\n    <option value="34">Copper Ore (Quartz)</option>\n    <option value="35">Copper Ore (Sulfur)</option>\n    <option value="139">Copper Powder</option>\n    <option value="125">Copper Sheet</option>\n    <option value="101">Crystal Oscillator</option>\n    <option value="11">Dark Matter Crystal</option>\n    <option value="9">Dark Matter Residue</option>\n    <option value="23">Diamonds</option>\n    <option value="157">Electromagnetic Control Rod</option>\n    <option value="73">Empty Canister</option>\n    <option value="166">Empty Fluid Tank</option>\n    <option value="106">Encased Industrial Beam</option>\n    <option value="135">Encased Plutonium Cell</option>\n    <option value="146">Encased Uranium Cell</option>\n    <option value="10">Excited Photonic Matter</option>\n    <option value="249">Fabric</option>\n    <option value="21">Ficsite Ingot (Iron)</option>\n    <option value="26">Ficsite Ingot (Aluminum)</option>\n    <option value="27">Ficsite Ingot (Caterium)</option>\n    <option value="20">Ficsite Trigon</option>\n    <option value="261">FICSMAS Bow</option>\n    <option value="253">FICSMAS Decoration</option>\n    <option value="254">FICSMAS Ornament Bundle</option>\n    <option value="260">FICSMAS Tree Branch</option>\n    <option value="252">FICSMAS Wonder Star</option>\n    <option value="231">Ficsonium</option>\n    <option value="232">Ficsonium Fuel Rod</option>\n    <option value="52">Fuel</option>\n    <option value="165">Fused Modular Frame</option>\n    <option value="247">Gas Filter</option>\n    <option value="244">Hatcher Protein</option>\n    <option value="164">Heat Sink</option>\n    <option value="114">Heavy Modular Frame</option>\n    <option value="154">High-Speed Connector</option>\n    <option value="238">Hog Protein</option>\n    <option value="235">Iodine-Infused Filter</option>\n    <option value="15">Ionized Fuel</option>\n    <option value="258">Iron FICSMAS Ornament</option>\n    <option value="3">Iron Ingot</option>\n    <option value="36">Iron Ore (Limestone)</option>\n    <option value="1">Iron Plate</option>\n    <option value="2">Iron Rod</option>\n    <option value="37">Limestone (Sulfur)</option>\n    <option value="75">Liquid Biofuel</option>\n    <option value="159">Magnetic Field Generator</option>\n    <option value="115">Modular Engine</option>\n    <option value="123">Modular Frame</option>\n    <option value="107">Motor</option>\n    <option value="13">Neural-Quantum Processor</option>\n    <option value="137">Nitric Acid</option>\n    <option value="38">Nitrogen Gas (Bauxite)</option>\n    <option value="39">Nitrogen Gas (Caterium)</option>\n    <option value="138">Non-Fissile Uranium</option>\n    <option value="143">Nuclear Pasta</option>\n    <option value="98">Packaged Alumina Solution</option>\n    <option value="74">Packaged Fuel</option>\n    <option value="78">Packaged Heavy Oil Residue</option>\n    <option value="16">Packaged Ionized Fuel</option>\n    <option value="76">Packaged Liquid Biofuel</option>\n    <option value="142">Packaged Nitric Acid</option>\n    <option value="167">Packaged Nitrogen Gas</option>\n    <option value="77">Packaged Oil</option>\n    <option value="6">Packaged Rocket Fuel</option>\n    <option value="152">Packaged Sulfuric Acid</option>\n    <option value="46">Packaged Turbofuel</option>\n    <option value="79">Packaged Water</option>\n    <option value="53">Petroleum Coke</option>\n    <option value="54">Plastic</option>\n    <option value="141">Plutonium Fuel Rod</option>\n    <option value="140">Plutonium Pellet</option>\n    <option value="136">Pressure Conversion Cube</option>\n    <option value="89">Quartz Crystal</option>\n    <option value="236">Quickwire</option>\n    <option value="150">Radio Control Unit</option>\n    <option value="40">Raw Quartz (Bauxite)</option>\n    <option value="41">Raw Quartz (Coal)</option>\n    <option value="24">Reanimated SAM</option>\n    <option value="255">Red FICSMAS Ornament</option>\n    <option value="265">Reinforced Iron Plate</option>\n    <option value="56">Residual Fuel</option>\n    <option value="57">Residual Plastic</option>\n    <option value="58">Residual Rubber</option>\n    <option value="5">Rocket Fuel</option>\n    <option value="124">Rotor</option>\n    <option value="55">Rubber</option>\n    <option value="19">SAM Fluctuator</option>\n    <option value="267">Screw</option>\n    <option value="100">Silica</option>\n    <option value="233">Singularity Cell</option>\n    <option value="126">Smart Plating</option>\n    <option value="251">Smokeless Powder</option>\n    <option value="237">Solid Biofuel</option>\n    <option value="239">Spitter Protein</option>\n    <option value="108">Stator</option>\n    <option value="68">Steel Beam</option>\n    <option value="70">Steel Ingot</option>\n    <option value="69">Steel Pipe</option>\n    <option value="243">Stinger Protein</option>\n    <option value="42">Sulfur (Coal)</option>\n    <option value="43">Sulfur (Iron)</option>\n    <option value="151">Sulfuric Acid</option>\n    <option value="149">Supercomputer</option>\n    <option value="12">Superposition Oscillator</option>\n    <option value="250">Synthetic Power Shard</option>\n    <option value="200">Thermal Propulsion Rocket</option>\n    <option value="22">Time Crystal</option>\n    <option value="199">Turbo Motor</option>\n    <option value="45">Turbofuel</option>\n    <option value="102">Unpackage Alumina Solution</option>\n    <option value="81">Unpackage Fuel</option>\n    <option value="83">Unpackage Heavy Oil Residue</option>\n    <option value="17">Unpackage Ionized Fuel</option>\n    <option value="80">Unpackage Liquid Biofuel</option>\n    <option value="144">Unpackage Nitric Acid</option>\n    <option value="168">Unpackage Nitrogen Gas</option>\n    <option value="82">Unpackage Oil</option>\n    <option value="7">Unpackage Rocket Fuel</option>\n    <option value="155">Unpackage Sulfuric Acid</option>\n    <option value="47">Unpackage Turbofuel</option>\n    <option value="84">Unpackage Water</option>\n    <option value="158">Uranium Fuel Rod</option>\n    <option value="44">Uranium Ore (Bauxite)</option>\n    <option value="71">Versatile Framework</option>\n    <option value="269">Wire</option>\n',c=function(){function t(){}return t.generatePowerTable=function(t,n,e){return t.map((function(t,e){return'\n      <tr>\n        <td class="m-0 p-0 w-50">\n          <select class="form-control rounded-0" name="power_building_id[]" min="0">\n            '.concat(n.replace('<option value="'.concat(t.buildingId,'">'),'<option value="'.concat(t.buildingId,'" selected>')),'\n          </select>\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="').concat(t.quantity,'" class="form-control rounded-0" name="power_amount[]" min="0" step="any" data-index="').concat(e,'" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="').concat(t.clockSpeed,'" class="form-control rounded-0" name="power_clock_speed[]" min="1" max="250" step="any" data-index="').concat(e,'" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="').concat(t.Consumption,'" class="form-control rounded-0" disabled name="power_Consumption[]" min="0" step="any">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="hidden" value="').concat(t.userRow?1:0,'" class="form-control rounded-0" readonly name="user[]" min="0">\n        </td>\n      </tr>\n    ')})).join("")+'\n      <tr>\n        <td class="m-0 p-0 w-50">\n          <select class="form-control rounded-0" name="power_building_id[]" min="0">\n            '.concat(n.replace(/<option /,"<option selected "),' \x3c!-- Selects the first option --\x3e\n          </select>\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="0" class="form-control rounded-0" name="power_amount[]" min="0" step="any" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="100" class="form-control rounded-0" name="power_clock_speed[]" min="1" max="250" step="any" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="0" class="form-control rounded-0" readonly name="power_Consumption[]" min="0" step="any">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="hidden" value="1" class="form-control rounded-0" readonly name="user[]" min="0">\n        </td>\n      </tr>\n    ')+'\n      <tr>\n        <td colspan="1" class="table-dark">\n          Total:\n        </td>\n        <td colspan="2"></td>\n        <td class="w-25 m-0 p-0">\n          <input type="number" name="total_consumption" readonly class="form-control rounded-0" id="totalConsumption" value="'.concat(e,'">\n        </td>\n      </tr>\n    ')},t.generateImportsTableRows=function(t){return t.map((function(t){var n=Number(t.quantity)%1==0?t.quantity.toFixed(0):t.quantity.toFixed(1);return'\n            <tr>\n                <td class="m-0 p-0 w-75">\n                    <select name="imports_item_id[]" class="form-control rounded-0">\n                        '.concat(s.replace('value="'.concat(t.itemId,'"'),'value="'.concat(t.itemId,'" selected')),'\n                    </select>\n                </td>\n                <td class="m-0 p-0 w-25">\n                    <input min="0" type="number" name="imports_ammount[]" class="form-control rounded-0" value="').concat(n,'" readonly>\n                </td>\n            </tr>\n        ')})).join("")+'\n        <tr>\n            <td class="m-0 p-0 w-75">\n                <select name="imports_item_id[]" class="form-control rounded-0">\n                    '.concat(s.replace(/<option /,"<option selected "),' \x3c!-- Selects the first option --\x3e\n                </select>\n            </td>\n            <td class="m-0 p-0 w-25">\n                <input min="0" type="number" name="imports_ammount[]" class="form-control rounded-0">\n            </td>\n        </tr>')},t.generateProductionTableRows=function(t){return t.map((function(t){var n,e,o,i="",r="",a="";return t.doubleExport&&(i='style="height: 78px"',a='rowspan="2"',r='\n            <tr class="extra-output">\n                <td class="m-0 p-0">\n                    <input type="text" readonly class="form-control rounded-0 product-name" value="'.concat(null===(n=t.extraCells)||void 0===n?void 0:n.Product,'">\n                </td>\n                <td class="m-0 p-0">\n                    <input min="0" type="number" step="any" name="production_usage2[]" value="').concat(null===(e=t.extraCells)||void 0===e?void 0:e.Usage,'" required readonly class="form-control rounded-0 usage-amount">\n                </td>\n                <td class="m-0 p-0">\n                    <input min="0" type="number" step="any" name="production_export2[]" value="').concat(null===(o=t.extraCells)||void 0===o?void 0:o.Quantity,'" required readonly class="form-control rounded-0 export-amount">\n                </td>\n            </tr>\n            ')),' <tr>\n          <td class="m-0 p-0" '.concat(a,'>\n            <select name="production_recipe_id[]" class="form-control rounded-0 item-recipe-id recipe" ').concat(i,">\n              ").concat(p.replace('value="'.concat(t.recipeId,'"'),'value="'.concat(t.recipeId,'" selected')),'\n            </select>\n          </td>\n          <td class="m-0 p-0" ').concat(a,'>\n            <input min="0" type="number" step="any" name="production_quantity[]" value="').concat(t.quantity,'" required class="form-control rounded-0 production-quantity" ').concat(i,'>\n          </td>\n          <td class="m-0 p-0">\n            <input type="text" readonly class="form-control rounded-0 product-name" value="').concat(t.product,'">\n          </td>\n          <td class="m-0 p-0">\n            <input min="0" type="number" step="any" name="production_usage[]" value="').concat(t.Usage,'" required readonly class="form-control rounded-0 usage-amount">\n          </td>\n          <td class="m-0 p-0">\n            <input min="0" type="number" step="any" name="production_export[]" value="').concat(t.exportPerMin,'" required readonly class="form-control rounded-0 export-amount">\n          </td>\n        </tr>\n        ').concat(r,"\n        ")})).join("")+'\n        <tr>\n            <td class="m-0 p-0">\n                <select name="production_recipe_id[]" class="form-control rounded-0 item-recipe-id recipe">\n                    '.concat(p.replace(/<option /,"<option selected "),'\n                </select>\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_quantity[]" required class="form-control rounded-0 production-quantity">\n            </td>\n            <td class="m-0 p-0">\n                <input type="text" readonly class="form-control rounded-0 product-name">\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_usage[]" required readonly class="form-control rounded-0 usage-amount">\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_export[]" required readonly class="form-control rounded-0 export-amount">\n            </td>\n        </tr>\n    ')},t}(),h=function(){function t(){}return t.calculateBuildings=function(n,e){var o=e.filter((function(t){return 1==t.userRow}));o.pop();for(var i=[],r=function(e){var o=n[e],r=o.recipe;if(null!==r){var a=r.building,l=o.quantity,s=i.find((function(t){return t.buildingId===a.id})),p=l/r.export_amount_per_min,c=0,h=+t.calculateConsumption(p,100,a.power_used);if(p%1!=0&&(c=p%1,p=Math.floor(p)),s?(s.quantity+=p,s.Consumption=+t.calculateConsumption(s.quantity,100,a.power_used)):i.push(new u(a.id,p,100,h,!1,a)),c>0){var d=100*c,f=+t.calculateConsumption(1,d,a.power_used);i.push(new u(a.id,1,+d.toFixed(1),f,!1,a))}}},a=0;a+1<n.length;a++)r(a);i=i.concat(o);var s=c.generatePowerTable(i,l,t.calculateTotalConsumption(i));return $("#power tbody").html(s),i.push(new u),i},t.calculateConsumption=function(t,n,e){return(t*e*Math.pow(n/100,1.321928)).toFixed(1)},t.calculateTotalConsumption=function(t){var n=t.filter((function(t){return 0!==t.Consumption})).reduce((function(t,n){return t+(Number(n.Consumption)||0)}),0);return parseFloat(n.toFixed(3))},t.calculateSingleConsumption=function(t){if(null===t.building)return 0;var n=Math.pow(t.clockSpeed/100,1.321928);return+(t.quantity*t.building.power_used*n).toFixed(1)},t.updateBuilding=function(e,o){return i=this,r=void 0,u=function(){var i;return function(t,n){var e,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(a=0)),a;)try{if(e=1,o&&(i=2&u[0]?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,o=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=n.call(t,a)}catch(t){u=[6,t],o=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}(this,(function(r){switch(r.label){case 0:return i=e,[4,n.getBuilding(o)];case 1:return i.building=r.sent(),e.buildingId=o,e.Consumption=+t.calculateSingleConsumption(e),[2]}}))},new((a=void 0)||(a=Promise))((function(t,n){function e(t){try{l(u.next(t))}catch(t){n(t)}}function o(t){try{l(u.throw(t))}catch(t){n(t)}}function l(n){var i;n.done?t(n.value):(i=n.value,i instanceof a?i:new a((function(t){t(i)}))).then(e,o)}l((u=u.apply(i,r||[])).next())}));var i,r,a,u},t.updateTotalConsumption=function(n){var e=t.calculateTotalConsumption(n);$("#totalConsumption").val(e)},t}(),d=function(t,n,e,o){void 0===t&&(t=0),void 0===n&&(n=0),void 0===e&&(e=""),void 0===o&&(o=!1),this.index=t,this.amount=n,this.product=e,this.doubleExport=o},f=function(){function n(){}return n.calculateImports=function(n){for(var e,o=[],i=this.resetUsage(n),r=0;r+1<n.length;r++){var a=n[r],u=null===(e=a.recipe)||void 0===e?void 0:e.resources,l=this.calculateProductionRate(a);u&&this.processRequiredItems(u,l,a,n,o,i)}var s=c.generateImportsTableRows(o);return $("#imports tbody").html(s),o.push(new t),{importsTableRows:o,indexes:i}},n.resetUsage=function(t){for(var n=[],e=0,o=t;e<o.length;e++){var i=o[e];if(i.productionImports=[],i.imports=[],i.Usage>0&&(n.push(t.indexOf(i)),i.Usage=0,i.exportPerMin=i.quantity),null!==i.extraCells&&i.extraCells.Usage>0){var r=t.indexOf(i);-1===r||n.includes(r)||n.push(r),i.extraCells.Usage=0,i.extraCells.ExportPerMin=i.extraCells.Quantity}}return n},n.calculateProductionRate=function(t){var n;return(null===(n=t.recipe)||void 0===n?void 0:n.export_amount_per_min)?t.quantity/t.recipe.export_amount_per_min:0},n.processRequiredItems=function(t,n,e,o,i,r){for(var a=function(t){var a=t.importAmount*n,l=o.filter((function(n){return n.product===t.name})),s=o.filter((function(n){return null!==n.extraCells&&n.extraCells.Product===t.name})),p=0,c=0,h=u.processProducedRows(l,a,c,p,o,r,e,t.name);c=h.totalUsed,p=h.totalAvailable;var d=u.processDoubleExportRows(s,a,c,p,o,r,e,t.name),f=d.totalUsed;p=d.totalAvailable;var v=a-(c=f);v>0&&u.addToImportsTable(i,t.itemId,v,e,t.name)},u=this,l=0,s=t;l<s.length;l++)a(s[l])},n.processProducedRows=function(t,n,e,o,i,r,a,u){for(var l=0,s=t;l<s.length;l++){var p=s[l],c=p.quantity-p.Usage,h=Math.min(c,n-e);if(!(h<=0)){p.Usage+=+h.toFixed(2),p.exportPerMin=+(p.quantity-p.Usage).toFixed(2),e+=h,o+=c;var f=i.indexOf(p);a.productionImports.push(new d(f,h,u)),-1===f||r.includes(f)||r.push(f)}}return{totalUsed:e,totalAvailable:o}},n.processDoubleExportRows=function(t,n,e,o,i,r,a,u){for(var l=0,s=t;l<s.length;l++){var p=s[l];if(null!==p.extraCells){var c=p.extraCells.Quantity-p.extraCells.Usage,h=Math.min(c,n-e);if(!(h<=0)){p.extraCells.Usage+=+h.toFixed(2),p.extraCells.ExportPerMin=+(p.extraCells.Quantity-p.extraCells.Usage).toFixed(2),e+=h,o+=c;var f=i.indexOf(p);a.productionImports.push(new d(f,h,u,!0)),-1===f||r.includes(f)||r.push(f)}}}return{totalUsed:e,totalAvailable:o}},n.addToImportsTable=function(n,e,o,i,r){var a=n.find((function(t){return t.itemId===e}));o=+o.toFixed(2),a?(a.quantity+=o,i.imports.push(new d(n.indexOf(a),o,r))):(n.push(new t(e,o,r)),i.imports.push(new d(n.length-1,o,r)))},n}(),v=function(){function t(){this.autoImportExport=!0,this.autoPowerMachine=!0,this.autoSave=!1,this.addEventListeners(),this.applyChanges()}return t.prototype.applyChanges=function(){var t=new URL(window.location.href),n=parseInt(t.searchParams.get("id")),e=document.getElementById("auto_import_export"),o=document.getElementById("auto_power_machine");e&&(this.autoImportExport=e.checked),o&&(this.autoPowerMachine=o.checked),this.saveSettings(n)},t.prototype.addEventListeners=function(){var t=this,n=document.getElementById("auto_import_export"),e=document.getElementById("auto_power_machine");n&&n.addEventListener("change",(function(){$("#auto_import_export").parent().parent().tooltip("hide"),t.applyChanges()})),e&&e.addEventListener("change",(function(){$("#auto_power_machine").parent().parent().tooltip("hide"),t.applyChanges()}))},t.prototype.saveSettings=function(t){$.ajax({type:"POST",url:"updateProductionLineSettings",data:{productionLineId:t,autoImportExport:this.autoImportExport,autoPowerMachine:this.autoPowerMachine,autoSave:this.autoSave}})},t}(),m=function(t,n,e){this.id=t,this.product=n,this.quantity=e,this.X=0,this.Y=0},y=function(t,n,e,o,i){this.id=t,this.product=n,this.quantity=e,this.building=o,this.buildingId=i,this.X=0,this.Y=0},g=function(t,n,e){this.id=t,this.product=n,this.quantity=e,this.X=0,this.Y=0},w=function(t,n,e,o,i){this.id=t,this.sourceId=n,this.targetId=e,this.quantity=o,this.product=i};function b(){}function x(t){return null==t?b:function(){return this.querySelector(t)}}function _(){return[]}function A(t){return null==t?_:function(){return this.querySelectorAll(t)}}function C(t){return function(){return this.matches(t)}}function S(t){return function(n){return n.matches(t)}}var k=Array.prototype.find;function I(){return this.firstElementChild}var P=Array.prototype.filter;function T(){return Array.from(this.children)}function M(t){return new Array(t.length)}function R(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}function E(t,n,e,o,i,r){for(var a,u=0,l=n.length,s=r.length;u<s;++u)(a=n[u])?(a.__data__=r[u],o[u]=a):e[u]=new R(t,r[u]);for(;u<l;++u)(a=n[u])&&(i[u]=a)}function N(t,n,e,o,i,r,a){var u,l,s,p=new Map,c=n.length,h=r.length,d=new Array(c);for(u=0;u<c;++u)(l=n[u])&&(d[u]=s=a.call(l,l.__data__,u,n)+"",p.has(s)?i[u]=l:p.set(s,l));for(u=0;u<h;++u)s=a.call(t,r[u],u,r)+"",(l=p.get(s))?(o[u]=l,l.__data__=r[u],p.delete(s)):e[u]=new R(t,r[u]);for(u=0;u<c;++u)(l=n[u])&&p.get(d[u])===l&&(i[u]=l)}function F(t){return t.__data__}function B(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function z(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}R.prototype={constructor:R,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var L="http://www.w3.org/1999/xhtml";const O={svg:"http://www.w3.org/2000/svg",xhtml:L,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function q(t){var n=t+="",e=n.indexOf(":");return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),O.hasOwnProperty(n)?{space:O[n],local:t}:t}function D(t){return function(){this.removeAttribute(t)}}function U(t){return function(){this.removeAttributeNS(t.space,t.local)}}function X(t,n){return function(){this.setAttribute(t,n)}}function Y(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function H(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}function j(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function Q(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function W(t){return function(){this.style.removeProperty(t)}}function G(t,n,e){return function(){this.style.setProperty(t,n,e)}}function V(t,n,e){return function(){var o=n.apply(this,arguments);null==o?this.style.removeProperty(t):this.style.setProperty(t,o,e)}}function J(t,n){return t.style.getPropertyValue(n)||Q(t).getComputedStyle(t,null).getPropertyValue(n)}function K(t){return function(){delete this[t]}}function Z(t,n){return function(){this[t]=n}}function tt(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}function nt(t){return t.trim().split(/^|\s+/)}function et(t){return t.classList||new ot(t)}function ot(t){this._node=t,this._names=nt(t.getAttribute("class")||"")}function it(t,n){for(var e=et(t),o=-1,i=n.length;++o<i;)e.add(n[o])}function rt(t,n){for(var e=et(t),o=-1,i=n.length;++o<i;)e.remove(n[o])}function at(t){return function(){it(this,t)}}function ut(t){return function(){rt(this,t)}}function lt(t,n){return function(){(n.apply(this,arguments)?it:rt)(this,t)}}function st(){this.textContent=""}function pt(t){return function(){this.textContent=t}}function ct(t){return function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}}function ht(){this.innerHTML=""}function dt(t){return function(){this.innerHTML=t}}function ft(t){return function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}}function vt(){this.nextSibling&&this.parentNode.appendChild(this)}function mt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function yt(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===L&&n.documentElement.namespaceURI===L?n.createElement(t):n.createElementNS(e,t)}}function gt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function wt(t){var n=q(t);return(n.local?gt:yt)(n)}function bt(){return null}function xt(){var t=this.parentNode;t&&t.removeChild(this)}function _t(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function At(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function Ct(t){return function(){var n=this.__on;if(n){for(var e,o=0,i=-1,r=n.length;o<r;++o)e=n[o],t.type&&e.type!==t.type||e.name!==t.name?n[++i]=e:this.removeEventListener(e.type,e.listener,e.options);++i?n.length=i:delete this.__on}}}function St(t,n,e){return function(){var o,i=this.__on,r=function(t){return function(n){t.call(this,n,this.__data__)}}(n);if(i)for(var a=0,u=i.length;a<u;++a)if((o=i[a]).type===t.type&&o.name===t.name)return this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=r,o.options=e),void(o.value=n);this.addEventListener(t.type,r,e),o={type:t.type,name:t.name,value:n,listener:r,options:e},i?i.push(o):this.__on=[o]}}function kt(t,n,e){var o=Q(t),i=o.CustomEvent;"function"==typeof i?i=new i(n,e):(i=o.document.createEvent("Event"),e?(i.initEvent(n,e.bubbles,e.cancelable),i.detail=e.detail):i.initEvent(n,!1,!1)),t.dispatchEvent(i)}function It(t,n){return function(){return kt(this,t,n)}}function Pt(t,n){return function(){return kt(this,t,n.apply(this,arguments))}}ot.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Tt=[null];function Mt(t,n){this._groups=t,this._parents=n}function Rt(){return new Mt([[document.documentElement]],Tt)}Mt.prototype=Rt.prototype={constructor:Mt,select:function(t){"function"!=typeof t&&(t=x(t));for(var n=this._groups,e=n.length,o=new Array(e),i=0;i<e;++i)for(var r,a,u=n[i],l=u.length,s=o[i]=new Array(l),p=0;p<l;++p)(r=u[p])&&(a=t.call(r,r.__data__,p,u))&&("__data__"in r&&(a.__data__=r.__data__),s[p]=a);return new Mt(o,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(n=t.apply(this,arguments))?[]:Array.isArray(n)?n:Array.from(n);var n}}(t):A(t);for(var n=this._groups,e=n.length,o=[],i=[],r=0;r<e;++r)for(var a,u=n[r],l=u.length,s=0;s<l;++s)(a=u[s])&&(o.push(t.call(a,a.__data__,s,u)),i.push(a));return new Mt(o,i)},selectChild:function(t){return this.select(null==t?I:function(t){return function(){return k.call(this.children,t)}}("function"==typeof t?t:S(t)))},selectChildren:function(t){return this.selectAll(null==t?T:function(t){return function(){return P.call(this.children,t)}}("function"==typeof t?t:S(t)))},filter:function(t){"function"!=typeof t&&(t=C(t));for(var n=this._groups,e=n.length,o=new Array(e),i=0;i<e;++i)for(var r,a=n[i],u=a.length,l=o[i]=[],s=0;s<u;++s)(r=a[s])&&t.call(r,r.__data__,s,a)&&l.push(r);return new Mt(o,this._parents)},data:function(t,n){if(!arguments.length)return Array.from(this,F);var e,o=n?N:E,i=this._parents,r=this._groups;"function"!=typeof t&&(e=t,t=function(){return e});for(var a=r.length,u=new Array(a),l=new Array(a),s=new Array(a),p=0;p<a;++p){var c=i[p],h=r[p],d=h.length,f=B(t.call(c,c&&c.__data__,p,i)),v=f.length,m=l[p]=new Array(v),y=u[p]=new Array(v);o(c,h,m,y,s[p]=new Array(d),f,n);for(var g,w,b=0,x=0;b<v;++b)if(g=m[b]){for(b>=x&&(x=b+1);!(w=y[x])&&++x<v;);g._next=w||null}}return(u=new Mt(u,i))._enter=l,u._exit=s,u},enter:function(){return new Mt(this._enter||this._groups.map(M),this._parents)},exit:function(){return new Mt(this._exit||this._groups.map(M),this._parents)},join:function(t,n,e){var o=this.enter(),i=this,r=this.exit();return"function"==typeof t?(o=t(o))&&(o=o.selection()):o=o.append(t+""),null!=n&&(i=n(i))&&(i=i.selection()),null==e?r.remove():e(r),o&&i?o.merge(i).order():i},merge:function(t){for(var n=t.selection?t.selection():t,e=this._groups,o=n._groups,i=e.length,r=o.length,a=Math.min(i,r),u=new Array(i),l=0;l<a;++l)for(var s,p=e[l],c=o[l],h=p.length,d=u[l]=new Array(h),f=0;f<h;++f)(s=p[f]||c[f])&&(d[f]=s);for(;l<i;++l)u[l]=e[l];return new Mt(u,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var o,i=t[n],r=i.length-1,a=i[r];--r>=0;)(o=i[r])&&(a&&4^o.compareDocumentPosition(a)&&a.parentNode.insertBefore(o,a),a=o);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}t||(t=z);for(var e=this._groups,o=e.length,i=new Array(o),r=0;r<o;++r){for(var a,u=e[r],l=u.length,s=i[r]=new Array(l),p=0;p<l;++p)(a=u[p])&&(s[p]=a);s.sort(n)}return new Mt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var o=t[n],i=0,r=o.length;i<r;++i){var a=o[i];if(a)return a}return null},size:function(){let t=0;for(const n of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,o=n.length;e<o;++e)for(var i,r=n[e],a=0,u=r.length;a<u;++a)(i=r[a])&&t.call(i,i.__data__,a,r);return this},attr:function(t,n){var e=q(t);if(arguments.length<2){var o=this.node();return e.local?o.getAttributeNS(e.space,e.local):o.getAttribute(e)}return this.each((null==n?e.local?U:D:"function"==typeof n?e.local?j:H:e.local?Y:X)(e,n))},style:function(t,n,e){return arguments.length>1?this.each((null==n?W:"function"==typeof n?V:G)(t,n,null==e?"":e)):J(this.node(),t)},property:function(t,n){return arguments.length>1?this.each((null==n?K:"function"==typeof n?tt:Z)(t,n)):this.node()[t]},classed:function(t,n){var e=nt(t+"");if(arguments.length<2){for(var o=et(this.node()),i=-1,r=e.length;++i<r;)if(!o.contains(e[i]))return!1;return!0}return this.each(("function"==typeof n?lt:n?at:ut)(e,n))},text:function(t){return arguments.length?this.each(null==t?st:("function"==typeof t?ct:pt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?ht:("function"==typeof t?ft:dt)(t)):this.node().innerHTML},raise:function(){return this.each(vt)},lower:function(){return this.each(mt)},append:function(t){var n="function"==typeof t?t:wt(t);return this.select((function(){return this.appendChild(n.apply(this,arguments))}))},insert:function(t,n){var e="function"==typeof t?t:wt(t),o=null==n?bt:"function"==typeof n?n:x(n);return this.select((function(){return this.insertBefore(e.apply(this,arguments),o.apply(this,arguments)||null)}))},remove:function(){return this.each(xt)},clone:function(t){return this.select(t?At:_t)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var o,i,r=function(t){return t.trim().split(/^|\s+/).map((function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}}))}(t+""),a=r.length;if(!(arguments.length<2)){for(u=n?St:Ct,o=0;o<a;++o)this.each(u(r[o],n,e));return this}var u=this.node().__on;if(u)for(var l,s=0,p=u.length;s<p;++s)for(o=0,l=u[s];o<a;++o)if((i=r[o]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,n){return this.each(("function"==typeof n?Pt:It)(t,n))},[Symbol.iterator]:function*(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var o,i=t[n],r=0,a=i.length;r<a;++r)(o=i[r])&&(yield o)}};const Et=Rt;var Nt={value:()=>{}};function Ft(){for(var t,n=0,e=arguments.length,o={};n<e;++n){if(!(t=arguments[n]+"")||t in o||/[\s.]/.test(t))throw new Error("illegal type: "+t);o[t]=[]}return new Bt(o)}function Bt(t){this._=t}function $t(t,n){for(var e,o=0,i=t.length;o<i;++o)if((e=t[o]).name===n)return e.value}function zt(t,n,e){for(var o=0,i=t.length;o<i;++o)if(t[o].name===n){t[o]=Nt,t=t.slice(0,o).concat(t.slice(o+1));break}return null!=e&&t.push({name:n,value:e}),t}Bt.prototype=Ft.prototype={constructor:Bt,on:function(t,n){var e,o,i=this._,r=(o=i,(t+"").trim().split(/^|\s+/).map((function(t){var n="",e=t.indexOf(".");if(e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),t&&!o.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))),a=-1,u=r.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++a<u;)if(e=(t=r[a]).type)i[e]=zt(i[e],t.name,n);else if(null==n)for(e in i)i[e]=zt(i[e],t.name,null);return this}for(;++a<u;)if((e=(t=r[a]).type)&&(e=$t(i[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new Bt(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,o,i=new Array(e),r=0;r<e;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,e=(o=this._[t]).length;r<e;++r)o[r].value.apply(n,i)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var o=this._[t],i=0,r=o.length;i<r;++i)o[i].value.apply(n,e)}};const Lt=Ft;var Ot,qt,Dt=0,Ut=0,Xt=0,Yt=1e3,Ht=0,jt=0,Qt=0,Wt="object"==typeof performance&&performance.now?performance:Date,Gt="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Vt(){return jt||(Gt(Jt),jt=Wt.now()+Qt)}function Jt(){jt=0}function Kt(){this._call=this._time=this._next=null}function Zt(t,n,e){var o=new Kt;return o.restart(t,n,e),o}function tn(){jt=(Ht=Wt.now())+Qt,Dt=Ut=0;try{!function(){Vt(),++Dt;for(var t,n=Ot;n;)(t=jt-n._time)>=0&&n._call.call(void 0,t),n=n._next;--Dt}()}finally{Dt=0,function(){for(var t,n,e=Ot,o=1/0;e;)e._call?(o>e._time&&(o=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ot=n);qt=t,en(o)}(),jt=0}}function nn(){var t=Wt.now(),n=t-Ht;n>Yt&&(Qt-=n,Ht=t)}function en(t){Dt||(Ut&&(Ut=clearTimeout(Ut)),t-jt>24?(t<1/0&&(Ut=setTimeout(tn,t-Wt.now()-Qt)),Xt&&(Xt=clearInterval(Xt))):(Xt||(Ht=Wt.now(),Xt=setInterval(nn,Yt)),Dt=1,Gt(tn)))}function on(t,n,e){var o=new Kt;return n=null==n?0:+n,o.restart((e=>{o.stop(),t(e+n)}),n,e),o}Kt.prototype=Zt.prototype={constructor:Kt,restart:function(t,n,e){if("function"!=typeof t)throw new TypeError("callback is not a function");e=(null==e?Vt():+e)+(null==n?0:+n),this._next||qt===this||(qt?qt._next=this:Ot=this,qt=this),this._call=t,this._time=e,en()},stop:function(){this._call&&(this._call=null,this._time=1/0,en())}};var rn=Lt("start","end","cancel","interrupt"),an=[],un=0,ln=2,sn=3,pn=5,cn=6;function hn(t,n,e,o,i,r){var a=t.__transition;if(a){if(e in a)return}else t.__transition={};!function(t,n,e){var o,i=t.__transition;function r(l){var s,p,c,h;if(1!==e.state)return u();for(s in i)if((h=i[s]).name===e.name){if(h.state===sn)return on(r);4===h.state?(h.state=cn,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[s]):+s<n&&(h.state=cn,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[s])}if(on((function(){e.state===sn&&(e.state=4,e.timer.restart(a,e.delay,e.time),a(l))})),e.state=ln,e.on.call("start",t,t.__data__,e.index,e.group),e.state===ln){for(e.state=sn,o=new Array(c=e.tween.length),s=0,p=-1;s<c;++s)(h=e.tween[s].value.call(t,t.__data__,e.index,e.group))&&(o[++p]=h);o.length=p+1}}function a(n){for(var i=n<e.duration?e.ease.call(null,n/e.duration):(e.timer.restart(u),e.state=pn,1),r=-1,a=o.length;++r<a;)o[r].call(t,i);e.state===pn&&(e.on.call("end",t,t.__data__,e.index,e.group),u())}function u(){for(var o in e.state=cn,e.timer.stop(),delete i[n],i)return;delete t.__transition}i[n]=e,e.timer=Zt((function(t){e.state=1,e.timer.restart(r,e.delay,e.time),e.delay<=t&&r(t-e.delay)}),0,e.time)}(t,e,{name:n,index:o,group:i,on:rn,tween:an,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:un})}function dn(t,n){var e=vn(t,n);if(e.state>un)throw new Error("too late; already scheduled");return e}function fn(t,n){var e=vn(t,n);if(e.state>sn)throw new Error("too late; already running");return e}function vn(t,n){var e=t.__transition;if(!e||!(e=e[n]))throw new Error("transition not found");return e}function mn(t,n){var e,o,i,r=t.__transition,a=!0;if(r){for(i in n=null==n?null:n+"",r)(e=r[i]).name===n?(o=e.state>ln&&e.state<pn,e.state=cn,e.timer.stop(),e.on.call(o?"interrupt":"cancel",t,t.__data__,e.index,e.group),delete r[i]):a=!1;a&&delete t.__transition}}function yn(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}var gn,wn=180/Math.PI,bn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function xn(t,n,e,o,i,r){var a,u,l;return(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a),(l=t*e+n*o)&&(e-=t*l,o-=n*l),(u=Math.sqrt(e*e+o*o))&&(e/=u,o/=u,l/=u),t*o<n*e&&(t=-t,n=-n,l=-l,a=-a),{translateX:i,translateY:r,rotate:Math.atan2(n,t)*wn,skewX:Math.atan(l)*wn,scaleX:a,scaleY:u}}function _n(t,n,e,o){function i(t){return t.length?t.pop()+" ":""}return function(r,a){var u=[],l=[];return r=t(r),a=t(a),function(t,o,i,r,a,u){if(t!==i||o!==r){var l=a.push("translate(",null,n,null,e);u.push({i:l-4,x:yn(t,i)},{i:l-2,x:yn(o,r)})}else(i||r)&&a.push("translate("+i+n+r+e)}(r.translateX,r.translateY,a.translateX,a.translateY,u,l),function(t,n,e,r){t!==n?(t-n>180?n+=360:n-t>180&&(t+=360),r.push({i:e.push(i(e)+"rotate(",null,o)-2,x:yn(t,n)})):n&&e.push(i(e)+"rotate("+n+o)}(r.rotate,a.rotate,u,l),function(t,n,e,r){t!==n?r.push({i:e.push(i(e)+"skewX(",null,o)-2,x:yn(t,n)}):n&&e.push(i(e)+"skewX("+n+o)}(r.skewX,a.skewX,u,l),function(t,n,e,o,r,a){if(t!==e||n!==o){var u=r.push(i(r)+"scale(",null,",",null,")");a.push({i:u-4,x:yn(t,e)},{i:u-2,x:yn(n,o)})}else 1===e&&1===o||r.push(i(r)+"scale("+e+","+o+")")}(r.scaleX,r.scaleY,a.scaleX,a.scaleY,u,l),r=a=null,function(t){for(var n,e=-1,o=l.length;++e<o;)u[(n=l[e]).i]=n.x(t);return u.join("")}}}var An=_n((function(t){const n=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return n.isIdentity?bn:xn(n.a,n.b,n.c,n.d,n.e,n.f)}),"px, ","px)","deg)"),Cn=_n((function(t){return null==t?bn:(gn||(gn=document.createElementNS("http://www.w3.org/2000/svg","g")),gn.setAttribute("transform",t),(t=gn.transform.baseVal.consolidate())?xn((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):bn)}),", ",")",")");function Sn(t,n){var e,o;return function(){var i=fn(this,t),r=i.tween;if(r!==e)for(var a=0,u=(o=e=r).length;a<u;++a)if(o[a].name===n){(o=o.slice()).splice(a,1);break}i.tween=o}}function kn(t,n,e){var o,i;if("function"!=typeof e)throw new Error;return function(){var r=fn(this,t),a=r.tween;if(a!==o){i=(o=a).slice();for(var u={name:n,value:e},l=0,s=i.length;l<s;++l)if(i[l].name===n){i[l]=u;break}l===s&&i.push(u)}r.tween=i}}function In(t,n,e){var o=t._id;return t.each((function(){var t=fn(this,o);(t.value||(t.value={}))[n]=e.apply(this,arguments)})),function(t){return vn(t,o).value[n]}}function Pn(t,n,e){t.prototype=n.prototype=e,e.constructor=t}function Tn(t,n){var e=Object.create(t.prototype);for(var o in n)e[o]=n[o];return e}function Mn(){}var Rn=.7,En=1/Rn,Nn="\\s*([+-]?\\d+)\\s*",Fn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Bn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",$n=/^#([0-9a-f]{3,8})$/,zn=new RegExp(`^rgb\\(${Nn},${Nn},${Nn}\\)$`),Ln=new RegExp(`^rgb\\(${Bn},${Bn},${Bn}\\)$`),On=new RegExp(`^rgba\\(${Nn},${Nn},${Nn},${Fn}\\)$`),qn=new RegExp(`^rgba\\(${Bn},${Bn},${Bn},${Fn}\\)$`),Dn=new RegExp(`^hsl\\(${Fn},${Bn},${Bn}\\)$`),Un=new RegExp(`^hsla\\(${Fn},${Bn},${Bn},${Fn}\\)$`),Xn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Yn(){return this.rgb().formatHex()}function Hn(){return this.rgb().formatRgb()}function jn(t){var n,e;return t=(t+"").trim().toLowerCase(),(n=$n.exec(t))?(e=n[1].length,n=parseInt(n[1],16),6===e?Qn(n):3===e?new Vn(n>>8&15|n>>4&240,n>>4&15|240&n,(15&n)<<4|15&n,1):8===e?Wn(n>>24&255,n>>16&255,n>>8&255,(255&n)/255):4===e?Wn(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|240&n,((15&n)<<4|15&n)/255):null):(n=zn.exec(t))?new Vn(n[1],n[2],n[3],1):(n=Ln.exec(t))?new Vn(255*n[1]/100,255*n[2]/100,255*n[3]/100,1):(n=On.exec(t))?Wn(n[1],n[2],n[3],n[4]):(n=qn.exec(t))?Wn(255*n[1]/100,255*n[2]/100,255*n[3]/100,n[4]):(n=Dn.exec(t))?ee(n[1],n[2]/100,n[3]/100,1):(n=Un.exec(t))?ee(n[1],n[2]/100,n[3]/100,n[4]):Xn.hasOwnProperty(t)?Qn(Xn[t]):"transparent"===t?new Vn(NaN,NaN,NaN,0):null}function Qn(t){return new Vn(t>>16&255,t>>8&255,255&t,1)}function Wn(t,n,e,o){return o<=0&&(t=n=e=NaN),new Vn(t,n,e,o)}function Gn(t,n,e,o){return 1===arguments.length?((i=t)instanceof Mn||(i=jn(i)),i?new Vn((i=i.rgb()).r,i.g,i.b,i.opacity):new Vn):new Vn(t,n,e,null==o?1:o);var i}function Vn(t,n,e,o){this.r=+t,this.g=+n,this.b=+e,this.opacity=+o}function Jn(){return`#${ne(this.r)}${ne(this.g)}${ne(this.b)}`}function Kn(){const t=Zn(this.opacity);return`${1===t?"rgb(":"rgba("}${te(this.r)}, ${te(this.g)}, ${te(this.b)}${1===t?")":`, ${t})`}`}function Zn(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function te(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ne(t){return((t=te(t))<16?"0":"")+t.toString(16)}function ee(t,n,e,o){return o<=0?t=n=e=NaN:e<=0||e>=1?t=n=NaN:n<=0&&(t=NaN),new ie(t,n,e,o)}function oe(t){if(t instanceof ie)return new ie(t.h,t.s,t.l,t.opacity);if(t instanceof Mn||(t=jn(t)),!t)return new ie;if(t instanceof ie)return t;var n=(t=t.rgb()).r/255,e=t.g/255,o=t.b/255,i=Math.min(n,e,o),r=Math.max(n,e,o),a=NaN,u=r-i,l=(r+i)/2;return u?(a=n===r?(e-o)/u+6*(e<o):e===r?(o-n)/u+2:(n-e)/u+4,u/=l<.5?r+i:2-r-i,a*=60):u=l>0&&l<1?0:a,new ie(a,u,l,t.opacity)}function ie(t,n,e,o){this.h=+t,this.s=+n,this.l=+e,this.opacity=+o}function re(t){return(t=(t||0)%360)<0?t+360:t}function ae(t){return Math.max(0,Math.min(1,t||0))}function ue(t,n,e){return 255*(t<60?n+(e-n)*t/60:t<180?e:t<240?n+(e-n)*(240-t)/60:n)}function le(t,n,e,o,i){var r=t*t,a=r*t;return((1-3*t+3*r-a)*n+(4-6*r+3*a)*e+(1+3*t+3*r-3*a)*o+a*i)/6}Pn(Mn,jn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Yn,formatHex:Yn,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return oe(this).formatHsl()},formatRgb:Hn,toString:Hn}),Pn(Vn,Gn,Tn(Mn,{brighter(t){return t=null==t?En:Math.pow(En,t),new Vn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Rn:Math.pow(Rn,t),new Vn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Vn(te(this.r),te(this.g),te(this.b),Zn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Jn,formatHex:Jn,formatHex8:function(){return`#${ne(this.r)}${ne(this.g)}${ne(this.b)}${ne(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Kn,toString:Kn})),Pn(ie,(function(t,n,e,o){return 1===arguments.length?oe(t):new ie(t,n,e,null==o?1:o)}),Tn(Mn,{brighter(t){return t=null==t?En:Math.pow(En,t),new ie(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Rn:Math.pow(Rn,t),new ie(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),n=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,o=e+(e<.5?e:1-e)*n,i=2*e-o;return new Vn(ue(t>=240?t-240:t+120,i,o),ue(t,i,o),ue(t<120?t+240:t-120,i,o),this.opacity)},clamp(){return new ie(re(this.h),ae(this.s),ae(this.l),Zn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Zn(this.opacity);return`${1===t?"hsl(":"hsla("}${re(this.h)}, ${100*ae(this.s)}%, ${100*ae(this.l)}%${1===t?")":`, ${t})`}`}}));const se=t=>()=>t;function pe(t,n){var e=n-t;return e?function(t,n){return function(e){return t+e*n}}(t,e):se(isNaN(t)?n:t)}const ce=function t(n){var e=function(t){return 1==(t=+t)?pe:function(n,e){return e-n?function(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(o){return Math.pow(t+o*n,e)}}(n,e,t):se(isNaN(n)?e:n)}}(n);function o(t,n){var o=e((t=Gn(t)).r,(n=Gn(n)).r),i=e(t.g,n.g),r=e(t.b,n.b),a=pe(t.opacity,n.opacity);return function(n){return t.r=o(n),t.g=i(n),t.b=r(n),t.opacity=a(n),t+""}}return o.gamma=t,o}(1);function he(t){return function(n){var e,o,i=n.length,r=new Array(i),a=new Array(i),u=new Array(i);for(e=0;e<i;++e)o=Gn(n[e]),r[e]=o.r||0,a[e]=o.g||0,u[e]=o.b||0;return r=t(r),a=t(a),u=t(u),o.opacity=1,function(t){return o.r=r(t),o.g=a(t),o.b=u(t),o+""}}}he((function(t){var n=t.length-1;return function(e){var o=e<=0?e=0:e>=1?(e=1,n-1):Math.floor(e*n),i=t[o],r=t[o+1],a=o>0?t[o-1]:2*i-r,u=o<n-1?t[o+2]:2*r-i;return le((e-o/n)*n,a,i,r,u)}})),he((function(t){var n=t.length;return function(e){var o=Math.floor(((e%=1)<0?++e:e)*n),i=t[(o+n-1)%n],r=t[o%n],a=t[(o+1)%n],u=t[(o+2)%n];return le((e-o/n)*n,i,r,a,u)}}));var de=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fe=new RegExp(de.source,"g");function ve(t,n){var e,o,i,r=de.lastIndex=fe.lastIndex=0,a=-1,u=[],l=[];for(t+="",n+="";(e=de.exec(t))&&(o=fe.exec(n));)(i=o.index)>r&&(i=n.slice(r,i),u[a]?u[a]+=i:u[++a]=i),(e=e[0])===(o=o[0])?u[a]?u[a]+=o:u[++a]=o:(u[++a]=null,l.push({i:a,x:yn(e,o)})),r=fe.lastIndex;return r<n.length&&(i=n.slice(r),u[a]?u[a]+=i:u[++a]=i),u.length<2?l[0]?function(t){return function(n){return t(n)+""}}(l[0].x):function(t){return function(){return t}}(n):(n=l.length,function(t){for(var e,o=0;o<n;++o)u[(e=l[o]).i]=e.x(t);return u.join("")})}function me(t,n){var e;return("number"==typeof n?yn:n instanceof jn?ce:(e=jn(n))?(n=e,ce):ve)(t,n)}function ye(t){return function(){this.removeAttribute(t)}}function ge(t){return function(){this.removeAttributeNS(t.space,t.local)}}function we(t,n,e){var o,i,r=e+"";return function(){var a=this.getAttribute(t);return a===r?null:a===o?i:i=n(o=a,e)}}function be(t,n,e){var o,i,r=e+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===r?null:a===o?i:i=n(o=a,e)}}function xe(t,n,e){var o,i,r;return function(){var a,u,l=e(this);if(null!=l)return(a=this.getAttribute(t))===(u=l+"")?null:a===o&&u===i?r:(i=u,r=n(o=a,l));this.removeAttribute(t)}}function _e(t,n,e){var o,i,r;return function(){var a,u,l=e(this);if(null!=l)return(a=this.getAttributeNS(t.space,t.local))===(u=l+"")?null:a===o&&u===i?r:(i=u,r=n(o=a,l));this.removeAttributeNS(t.space,t.local)}}function Ae(t,n){var e,o;function i(){var i=n.apply(this,arguments);return i!==o&&(e=(o=i)&&function(t,n){return function(e){this.setAttributeNS(t.space,t.local,n.call(this,e))}}(t,i)),e}return i._value=n,i}function Ce(t,n){var e,o;function i(){var i=n.apply(this,arguments);return i!==o&&(e=(o=i)&&function(t,n){return function(e){this.setAttribute(t,n.call(this,e))}}(t,i)),e}return i._value=n,i}function Se(t,n){return function(){dn(this,t).delay=+n.apply(this,arguments)}}function ke(t,n){return n=+n,function(){dn(this,t).delay=n}}function Ie(t,n){return function(){fn(this,t).duration=+n.apply(this,arguments)}}function Pe(t,n){return n=+n,function(){fn(this,t).duration=n}}var Te=Et.prototype.constructor;function Me(t){return function(){this.style.removeProperty(t)}}var Re=0;function Ee(t,n,e,o){this._groups=t,this._parents=n,this._name=e,this._id=o}function Ne(){return++Re}var Fe=Et.prototype;Ee.prototype=function(t){return Et().transition(t)}.prototype={constructor:Ee,select:function(t){var n=this._name,e=this._id;"function"!=typeof t&&(t=x(t));for(var o=this._groups,i=o.length,r=new Array(i),a=0;a<i;++a)for(var u,l,s=o[a],p=s.length,c=r[a]=new Array(p),h=0;h<p;++h)(u=s[h])&&(l=t.call(u,u.__data__,h,s))&&("__data__"in u&&(l.__data__=u.__data__),c[h]=l,hn(c[h],n,e,h,c,vn(u,e)));return new Ee(r,this._parents,n,e)},selectAll:function(t){var n=this._name,e=this._id;"function"!=typeof t&&(t=A(t));for(var o=this._groups,i=o.length,r=[],a=[],u=0;u<i;++u)for(var l,s=o[u],p=s.length,c=0;c<p;++c)if(l=s[c]){for(var h,d=t.call(l,l.__data__,c,s),f=vn(l,e),v=0,m=d.length;v<m;++v)(h=d[v])&&hn(h,n,e,v,d,f);r.push(d),a.push(l)}return new Ee(r,a,n,e)},selectChild:Fe.selectChild,selectChildren:Fe.selectChildren,filter:function(t){"function"!=typeof t&&(t=C(t));for(var n=this._groups,e=n.length,o=new Array(e),i=0;i<e;++i)for(var r,a=n[i],u=a.length,l=o[i]=[],s=0;s<u;++s)(r=a[s])&&t.call(r,r.__data__,s,a)&&l.push(r);return new Ee(o,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,e=t._groups,o=n.length,i=e.length,r=Math.min(o,i),a=new Array(o),u=0;u<r;++u)for(var l,s=n[u],p=e[u],c=s.length,h=a[u]=new Array(c),d=0;d<c;++d)(l=s[d]||p[d])&&(h[d]=l);for(;u<o;++u)a[u]=n[u];return new Ee(a,this._parents,this._name,this._id)},selection:function(){return new Te(this._groups,this._parents)},transition:function(){for(var t=this._name,n=this._id,e=Ne(),o=this._groups,i=o.length,r=0;r<i;++r)for(var a,u=o[r],l=u.length,s=0;s<l;++s)if(a=u[s]){var p=vn(a,n);hn(a,t,e,s,u,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new Ee(o,this._parents,t,e)},call:Fe.call,nodes:Fe.nodes,node:Fe.node,size:Fe.size,empty:Fe.empty,each:Fe.each,on:function(t,n){var e=this._id;return arguments.length<2?vn(this.node(),e).on.on(t):this.each(function(t,n,e){var o,i,r=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||"start"===t}))}(n)?dn:fn;return function(){var a=r(this,t),u=a.on;u!==o&&(i=(o=u).copy()).on(n,e),a.on=i}}(e,t,n))},attr:function(t,n){var e=q(t),o="transform"===e?Cn:me;return this.attrTween(t,"function"==typeof n?(e.local?_e:xe)(e,o,In(this,"attr."+t,n)):null==n?(e.local?ge:ye)(e):(e.local?be:we)(e,o,n))},attrTween:function(t,n){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(null==n)return this.tween(e,null);if("function"!=typeof n)throw new Error;var o=q(t);return this.tween(e,(o.local?Ae:Ce)(o,n))},style:function(t,n,e){var o="transform"==(t+="")?An:me;return null==n?this.styleTween(t,function(t,n){var e,o,i;return function(){var r=J(this,t),a=(this.style.removeProperty(t),J(this,t));return r===a?null:r===e&&a===o?i:i=n(e=r,o=a)}}(t,o)).on("end.style."+t,Me(t)):"function"==typeof n?this.styleTween(t,function(t,n,e){var o,i,r;return function(){var a=J(this,t),u=e(this),l=u+"";return null==u&&(this.style.removeProperty(t),l=u=J(this,t)),a===l?null:a===o&&l===i?r:(i=l,r=n(o=a,u))}}(t,o,In(this,"style."+t,n))).each(function(t,n){var e,o,i,r,a="style."+n,u="end."+a;return function(){var l=fn(this,t),s=l.on,p=null==l.value[a]?r||(r=Me(n)):void 0;s===e&&i===p||(o=(e=s).copy()).on(u,i=p),l.on=o}}(this._id,t)):this.styleTween(t,function(t,n,e){var o,i,r=e+"";return function(){var a=J(this,t);return a===r?null:a===o?i:i=n(o=a,e)}}(t,o,n),e).on("end.style."+t,null)},styleTween:function(t,n,e){var o="style."+(t+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(null==n)return this.tween(o,null);if("function"!=typeof n)throw new Error;return this.tween(o,function(t,n,e){var o,i;function r(){var r=n.apply(this,arguments);return r!==i&&(o=(i=r)&&function(t,n,e){return function(o){this.style.setProperty(t,n.call(this,o),e)}}(t,r,e)),o}return r._value=n,r}(t,n,null==e?"":e))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var n=t(this);this.textContent=null==n?"":n}}(In(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;return this.tween(n,function(t){var n,e;function o(){var o=t.apply(this,arguments);return o!==e&&(n=(e=o)&&function(t){return function(n){this.textContent=t.call(this,n)}}(o)),n}return o._value=t,o}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var n=this.parentNode;for(var e in this.__transition)if(+e!==t)return;n&&n.removeChild(this)}}(this._id))},tween:function(t,n){var e=this._id;if(t+="",arguments.length<2){for(var o,i=vn(this.node(),e).tween,r=0,a=i.length;r<a;++r)if((o=i[r]).name===t)return o.value;return null}return this.each((null==n?Sn:kn)(e,t,n))},delay:function(t){var n=this._id;return arguments.length?this.each(("function"==typeof t?Se:ke)(n,t)):vn(this.node(),n).delay},duration:function(t){var n=this._id;return arguments.length?this.each(("function"==typeof t?Ie:Pe)(n,t)):vn(this.node(),n).duration},ease:function(t){var n=this._id;return arguments.length?this.each(function(t,n){if("function"!=typeof n)throw new Error;return function(){fn(this,t).ease=n}}(n,t)):vn(this.node(),n).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,n){return function(){var e=n.apply(this,arguments);if("function"!=typeof e)throw new Error;fn(this,t).ease=e}}(this._id,t))},end:function(){var t,n,e=this,o=e._id,i=e.size();return new Promise((function(r,a){var u={value:a},l={value:function(){0==--i&&r()}};e.each((function(){var e=fn(this,o),i=e.on;i!==t&&((n=(t=i).copy())._.cancel.push(u),n._.interrupt.push(u),n._.end.push(l)),e.on=n})),0===i&&r()}))},[Symbol.iterator]:Fe[Symbol.iterator]};var Be={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function $e(t,n){for(var e;!(e=t.__transition)||!(e=e[n]);)if(!(t=t.parentNode))throw new Error(`transition ${n} not found`);return e}Et.prototype.interrupt=function(t){return this.each((function(){mn(this,t)}))},Et.prototype.transition=function(t){var n,e;t instanceof Ee?(n=t._id,t=t._name):(n=Ne(),(e=Be).time=Vt(),t=null==t?null:t+"");for(var o=this._groups,i=o.length,r=0;r<i;++r)for(var a,u=o[r],l=u.length,s=0;s<l;++s)(a=u[s])&&hn(a,t,n,s,u,e||$e(a,n));return new Ee(o,this._parents,t,n)};const{abs:ze,max:Le,min:Oe}=Math;function qe(t){return{type:t}}function De(t){return"string"==typeof t?new Mt([[document.querySelector(t)]],[document.documentElement]):new Mt([[t]],Tt)}["w","e"].map(qe),["n","s"].map(qe),["n","w","e","s","nw","ne","sw","se"].map(qe);const Ue={capture:!0,passive:!1};function Xe(t){t.preventDefault(),t.stopImmediatePropagation()}function Ye(t){return((t=Math.exp(t))+1/t)/2}const He=function t(n,e,o){function i(t,i){var r,a,u=t[0],l=t[1],s=t[2],p=i[0],c=i[1],h=i[2],d=p-u,f=c-l,v=d*d+f*f;if(v<1e-12)a=Math.log(h/s)/n,r=function(t){return[u+t*d,l+t*f,s*Math.exp(n*t*a)]};else{var m=Math.sqrt(v),y=(h*h-s*s+o*v)/(2*s*e*m),g=(h*h-s*s-o*v)/(2*h*e*m),w=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(g*g+1)-g);a=(b-w)/n,r=function(t){var o,i=t*a,r=Ye(w),p=s/(e*m)*(r*(o=n*i+w,((o=Math.exp(2*o))-1)/(o+1))-function(t){return((t=Math.exp(t))-1/t)/2}(w));return[u+p*d,l+p*f,s*r/Ye(n*i+w)]}}return r.duration=1e3*a*n/Math.SQRT2,r}return i.rho=function(n){var e=Math.max(.001,+n),o=e*e;return t(e,o,o*o)},i}(Math.SQRT2,2,4);function je(t,n){if(t=function(t){let n;for(;n=t.sourceEvent;)t=n;return t}(t),void 0===n&&(n=t.currentTarget),n){var e=n.ownerSVGElement||n;if(e.createSVGPoint){var o=e.createSVGPoint();return o.x=t.clientX,o.y=t.clientY,[(o=o.matrixTransform(n.getScreenCTM().inverse())).x,o.y]}if(n.getBoundingClientRect){var i=n.getBoundingClientRect();return[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop]}}return[t.pageX,t.pageY]}const Qe=t=>()=>t;function We(t,{sourceEvent:n,target:e,transform:o,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:i}})}function Ge(t,n,e){this.k=t,this.x=n,this.y=e}Ge.prototype={constructor:Ge,scale:function(t){return 1===t?this:new Ge(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new Ge(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ve=new Ge(1,0,0);function Je(t){t.stopImmediatePropagation()}function Ke(t){t.preventDefault(),t.stopImmediatePropagation()}function Ze(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function to(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function no(){return this.__zoom||Ve}function eo(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function oo(){return navigator.maxTouchPoints||"ontouchstart"in this}function io(t,n,e){var o=t.invertX(n[0][0])-e[0][0],i=t.invertX(n[1][0])-e[1][0],r=t.invertY(n[0][1])-e[0][1],a=t.invertY(n[1][1])-e[1][1];return t.translate(i>o?(o+i)/2:Math.min(0,o)||Math.max(0,i),a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a))}Ge.prototype;var ro=function(t,n,e,o){return new(e||(e=Promise))((function(i,r){function a(t){try{l(o.next(t))}catch(t){r(t)}}function u(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}l((o=o.apply(t,n||[])).next())}))},ao=function(t,n){var e,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(a=0)),a;)try{if(e=1,o&&(i=2&u[0]?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,o=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=n.call(t,a)}catch(t){u=[6,t],o=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}},uo=200,lo=100,so=200,po=function(){function t(t){var n=this;this.importNodes=[],this.productionNodes=[],this.exportNodes=[],this.importConnections=[],this.productionConnections=[],this.exportConnections=[],this.TableHandler=t,console.log("Visualization constructor"),this.getImportNodes(),this.getProduction(),this.getExportNodes(),this.getImportConnection(),console.log(this),this.getPosition().then((function(){n.positionImportNodes(),n.positionExportNodes(),n.createVisualization()}))}return t.prototype.createVisualization=function(){var t=this,n=De("#graph");n.selectAll("*").remove(),n.attr("width"),n.attr("height");var e=n.append("g"),o=function(){var t,n,e,o=Ze,i=to,r=io,a=eo,u=oo,l=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],p=250,c=He,h=Lt("start","zoom","end"),d=500,f=150,v=0,m=10;function y(t){t.property("__zoom",no).on("wheel.zoom",C,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",k).filter(u).on("touchstart.zoom",I).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",T).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(t,n){return(n=Math.max(l[0],Math.min(l[1],n)))===t.k?t:new Ge(n,t.x,t.y)}function w(t,n,e){var o=n[0]-e[0]*t.k,i=n[1]-e[1]*t.k;return o===t.x&&i===t.y?t:new Ge(t.k,o,i)}function b(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function x(t,n,e,o){t.on("start.zoom",(function(){_(this,arguments).event(o).start()})).on("interrupt.zoom end.zoom",(function(){_(this,arguments).event(o).end()})).tween("zoom",(function(){var t=this,r=arguments,a=_(t,r).event(o),u=i.apply(t,r),l=null==e?b(u):"function"==typeof e?e.apply(t,r):e,s=Math.max(u[1][0]-u[0][0],u[1][1]-u[0][1]),p=t.__zoom,h="function"==typeof n?n.apply(t,r):n,d=c(p.invert(l).concat(s/p.k),h.invert(l).concat(s/h.k));return function(t){if(1===t)t=h;else{var n=d(t),e=s/n[2];t=new Ge(e,l[0]-n[0]*e,l[1]-n[1]*e)}a.zoom(null,t)}}))}function _(t,n,e){return!e&&t.__zooming||new A(t,n)}function A(t,n){this.that=t,this.args=n,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,n),this.taps=0}function C(t,...n){if(o.apply(this,arguments)){var e=_(this,n).event(t),i=this.__zoom,u=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,a.apply(this,arguments)))),p=je(t);if(e.wheel)e.mouse[0][0]===p[0]&&e.mouse[0][1]===p[1]||(e.mouse[1]=i.invert(e.mouse[0]=p)),clearTimeout(e.wheel);else{if(i.k===u)return;e.mouse=[p,i.invert(p)],mn(this),e.start()}Ke(t),e.wheel=setTimeout((function(){e.wheel=null,e.end()}),f),e.zoom("mouse",r(w(g(i,u),e.mouse[0],e.mouse[1]),e.extent,s))}}function S(t,...n){if(!e&&o.apply(this,arguments)){var i=t.currentTarget,a=_(this,n,!0).event(t),u=De(t.view).on("mousemove.zoom",(function(t){if(Ke(t),!a.moved){var n=t.clientX-p,e=t.clientY-c;a.moved=n*n+e*e>v}a.event(t).zoom("mouse",r(w(a.that.__zoom,a.mouse[0]=je(t,i),a.mouse[1]),a.extent,s))}),!0).on("mouseup.zoom",(function(t){u.on("mousemove.zoom mouseup.zoom",null),function(t,n){var e=t.document.documentElement,o=De(t).on("dragstart.drag",null);n&&(o.on("click.drag",Xe,Ue),setTimeout((function(){o.on("click.drag",null)}),0)),"onselectstart"in e?o.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}(t.view,a.moved),Ke(t),a.event(t).end()}),!0),l=je(t,i),p=t.clientX,c=t.clientY;!function(t){var n=t.document.documentElement,e=De(t).on("dragstart.drag",Xe,Ue);"onselectstart"in n?e.on("selectstart.drag",Xe,Ue):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}(t.view),Je(t),a.mouse=[l,this.__zoom.invert(l)],mn(this),a.start()}}function k(t,...n){if(o.apply(this,arguments)){var e=this.__zoom,a=je(t.changedTouches?t.changedTouches[0]:t,this),u=e.invert(a),l=e.k*(t.shiftKey?.5:2),c=r(w(g(e,l),a,u),i.apply(this,n),s);Ke(t),p>0?De(this).transition().duration(p).call(x,c,a,t):De(this).call(y.transform,c,a,t)}}function I(e,...i){if(o.apply(this,arguments)){var r,a,u,l,s=e.touches,p=s.length,c=_(this,i,e.changedTouches.length===p).event(e);for(Je(e),a=0;a<p;++a)l=[l=je(u=s[a],this),this.__zoom.invert(l),u.identifier],c.touch0?c.touch1||c.touch0[2]===l[2]||(c.touch1=l,c.taps=0):(c.touch0=l,r=!0,c.taps=1+!!t);t&&(t=clearTimeout(t)),r&&(c.taps<2&&(n=l[0],t=setTimeout((function(){t=null}),d)),mn(this),c.start())}}function P(t,...n){if(this.__zooming){var e,o,i,a,u=_(this,n).event(t),l=t.changedTouches,p=l.length;for(Ke(t),e=0;e<p;++e)i=je(o=l[e],this),u.touch0&&u.touch0[2]===o.identifier?u.touch0[0]=i:u.touch1&&u.touch1[2]===o.identifier&&(u.touch1[0]=i);if(o=u.that.__zoom,u.touch1){var c=u.touch0[0],h=u.touch0[1],d=u.touch1[0],f=u.touch1[1],v=(v=d[0]-c[0])*v+(v=d[1]-c[1])*v,m=(m=f[0]-h[0])*m+(m=f[1]-h[1])*m;o=g(o,Math.sqrt(v/m)),i=[(c[0]+d[0])/2,(c[1]+d[1])/2],a=[(h[0]+f[0])/2,(h[1]+f[1])/2]}else{if(!u.touch0)return;i=u.touch0[0],a=u.touch0[1]}u.zoom("touch",r(w(o,i,a),u.extent,s))}}function T(t,...o){if(this.__zooming){var i,r,a=_(this,o).event(t),u=t.changedTouches,l=u.length;for(Je(t),e&&clearTimeout(e),e=setTimeout((function(){e=null}),d),i=0;i<l;++i)r=u[i],a.touch0&&a.touch0[2]===r.identifier?delete a.touch0:a.touch1&&a.touch1[2]===r.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(r=je(r,this),Math.hypot(n[0]-r[0],n[1]-r[1])<m)){var s=De(this).on("dblclick.zoom");s&&s.apply(this,arguments)}}}return y.transform=function(t,n,e,o){var i=t.selection?t.selection():t;i.property("__zoom",no),t!==i?x(t,n,e,o):i.interrupt().each((function(){_(this,arguments).event(o).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()}))},y.scaleBy=function(t,n,e,o){y.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof n?n.apply(this,arguments):n)}),e,o)},y.scaleTo=function(t,n,e,o){y.transform(t,(function(){var t=i.apply(this,arguments),o=this.__zoom,a=null==e?b(t):"function"==typeof e?e.apply(this,arguments):e,u=o.invert(a),l="function"==typeof n?n.apply(this,arguments):n;return r(w(g(o,l),a,u),t,s)}),e,o)},y.translateBy=function(t,n,e,o){y.transform(t,(function(){return r(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof e?e.apply(this,arguments):e),i.apply(this,arguments),s)}),null,o)},y.translateTo=function(t,n,e,o,a){y.transform(t,(function(){var t=i.apply(this,arguments),a=this.__zoom,u=null==o?b(t):"function"==typeof o?o.apply(this,arguments):o;return r(Ve.translate(u[0],u[1]).scale(a.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof e?-e.apply(this,arguments):-e),t,s)}),o,a)},A.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,n){return this.mouse&&"mouse"!==t&&(this.mouse[1]=n.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var n=De(this.that).datum();h.call(t,this.that,new We(t,{sourceEvent:this.sourceEvent,target:y,type:t,transform:this.that.__zoom,dispatch:h}),n)}},y.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:Qe(+t),y):a},y.filter=function(t){return arguments.length?(o="function"==typeof t?t:Qe(!!t),y):o},y.touchable=function(t){return arguments.length?(u="function"==typeof t?t:Qe(!!t),y):u},y.extent=function(t){return arguments.length?(i="function"==typeof t?t:Qe([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),y):i},y.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],y):[l[0],l[1]]},y.translateExtent=function(t){return arguments.length?(s[0][0]=+t[0][0],s[1][0]=+t[1][0],s[0][1]=+t[0][1],s[1][1]=+t[1][1],y):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},y.constrain=function(t){return arguments.length?(r=t,y):r},y.duration=function(t){return arguments.length?(p=+t,y):p},y.interpolate=function(t){return arguments.length?(c=t,y):c},y.on=function(){var t=h.on.apply(h,arguments);return t===h?y:t},y.clickDistance=function(t){return arguments.length?(v=(t=+t)*t,y):Math.sqrt(v)},y.tapDistance=function(t){return arguments.length?(m=+t,y):m},y}().scaleExtent([.5,5]).on("zoom",(function(t){e.attr("transform",t.transform)}));n.call(o),n.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",30).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#999");var i=e.append("g").attr("class","links").selectAll("line").data(this.importConnections).enter().append("line").attr("stroke","blue").attr("stroke-width",2).attr("marker-end","url(#arrow)"),r=e.append("g").attr("class","links").selectAll("line").data(this.productionConnections).enter().append("line").attr("stroke","green").attr("stroke-width",2).attr("marker-end","url(#arrow)"),a=e.append("g").attr("class","links").selectAll("line").data(this.exportConnections).enter().append("line").attr("stroke","red").attr("stroke-width",2).attr("marker-end","url(#arrow)"),u=e.append("g").attr("class","nodes").selectAll("g").data(this.importNodes).enter().append("g").attr("transform",(function(t){return"translate(".concat(t.X,", ").concat(t.Y,")")})),l=e.append("g").attr("class","nodes").selectAll("g").data(this.productionNodes).enter().append("g").attr("transform",(function(t){return"translate(".concat(t.X,", ").concat(t.Y,")")})),s=e.append("g").attr("class","nodes").selectAll("g").data(this.exportNodes).enter().append("g").attr("transform",(function(t){return"translate(".concat(t.X,", ").concat(t.Y,")")}));u.append("circle").attr("r",40).attr("fill","blue"),l.append("circle").attr("r",40).attr("fill","green"),s.append("circle").attr("r",40).attr("fill","red"),u.append("text").attr("x",45).attr("y",-20).attr("font-size",20).text((function(t){return t.product})),l.append("text").attr("x",45).attr("y",-20).attr("font-size",20).text((function(t){return t.product})),s.append("text").attr("x",45).attr("y",-20).attr("font-size",20).text((function(t){return t.product})),i.attr("x1",(function(n){return t.importNodes[n.sourceId].X})).attr("y1",(function(n){return t.importNodes[n.sourceId].Y})).attr("x2",(function(n){return t.productionNodes[n.targetId].X})).attr("y2",(function(n){return t.productionNodes[n.targetId].Y})),r.attr("x1",(function(n){return t.productionNodes[n.sourceId].X})).attr("y1",(function(n){return t.productionNodes[n.sourceId].Y})).attr("x2",(function(n){return t.productionNodes[n.targetId].X})).attr("y2",(function(n){return t.productionNodes[n.targetId].Y})),a.attr("x1",(function(n){return t.productionNodes[n.sourceId].X})).attr("y1",(function(n){return t.productionNodes[n.sourceId].Y})).attr("x2",(function(n){return t.exportNodes[n.targetId].X})).attr("y2",(function(n){return t.exportNodes[n.targetId].Y})),e.selectAll(".nodes g").nodes().reduce((function(t,n){var e=n.getBBox();return{x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),width:Math.max(t.width,e.width+(e.x-t.x)),height:Math.max(t.height,e.height+(e.y-t.y))}}),{x:1/0,y:1/0,width:0,height:0})},t.prototype.getImportConnection=function(){for(var t=0,n=0;n<this.TableHandler.productionTableRows.length;n++)for(var e=this.TableHandler.productionTableRows[n],o=0;o<e.imports.length;o++){var i=e.imports[o];this.importConnections.push(new w(t,i.index,n,i.amount,i.product)),t++}},t.prototype.getProduction=function(){for(var t,n=0;n<this.TableHandler.productionTableRows.length;n++){var e=this.TableHandler.productionTableRows[n],o=null===(t=e.recipe)||void 0===t?void 0:t.building;o&&this.productionNodes.push(new y(n,e.product,e.quantity,o.name,o.id));for(var i=0;i<e.productionImports.length;i++){var r=e.productionImports[i];this.productionConnections.push(new w(n,r.index,n,r.amount,r.product))}}},t.prototype.getPosition=function(){return ro(this,void 0,void 0,(function(){var t,n,e,o=this;return ao(this,(function(i){switch(i.label){case 0:return t=new Map,n=function(e,i){return ro(o,void 0,void 0,(function(){var o,r,a,u,l;return ao(this,(function(s){switch(s.label){case 0:return t.has(i)||t.set(i,[]),(o=this.productionNodes[e]).Y?[2]:(r=200*((null===(u=t.get(i))||void 0===u?void 0:u.length)||0)+100,null===(l=t.get(i))||void 0===l||l.push(r),o.X=so+400*i,o.Y=r,a=this.productionConnections.filter((function(t){return t.sourceId===e})),[4,Promise.all(a.map((function(t){return n(t.targetId,i+1)})))]);case 1:return s.sent(),[2]}}))}))},e=this.productionNodes.filter((function(t){return!o.productionConnections.some((function(n){return n.targetId===t.id}))})),[4,Promise.all(e.map((function(t){return n(t.id,0)})))];case 1:return i.sent(),[2]}}))}))},t.prototype.getImportNodes=function(){for(var t=0;t<this.TableHandler.importsTableRows.length;t++){var n=this.TableHandler.importsTableRows[t];""!==n.product&&n.quantity>0&&this.importNodes.push(new m(t,n.product,n.quantity))}},t.prototype.getExportNodes=function(){for(var t,n,e,o=0,i=0;i<this.TableHandler.productionTableRows.length;i++){var r=this.TableHandler.productionTableRows[i];r.exportPerMin>0&&(this.exportNodes.push(new g(o,r.product,r.exportPerMin)),this.exportConnections.push(new w(o,i,this.exportNodes.length-1,r.exportPerMin,r.product)),o++),(null===(t=r.extraCells)||void 0===t?void 0:t.ExportPerMin)>0&&(this.exportNodes.push(new g(o,r.product,null===(n=r.extraCells)||void 0===n?void 0:n.ExportPerMin)),this.exportConnections.push(new w(o,i,this.exportNodes.length-1,null===(e=r.extraCells)||void 0===e?void 0:e.ExportPerMin,r.product)),o++)}},t.prototype.positionImportNodes=function(){for(var t=this,n=function(n){var o=e.importConnections.filter((function(t){return t.sourceId===n}));if(o&&o.length>1){var i=o.length,r=o[Math.floor(i/2)],a=e.productionNodes[r.targetId].X-uo,u=e.productionNodes[r.targetId].Y;a>so&&(u-=lo),e.importNodes[n].X=a,e.importNodes[n].Y=u}else if(o&&1===o.length){var l=e.importNodes.filter((function(n){return n.X===t.productionNodes[o[0].targetId].X-uo&&n.Y===t.productionNodes[o[0].targetId].Y}));a=e.productionNodes[o[0].targetId].X-uo,u=e.productionNodes[o[0].targetId].Y,a>so&&(u-=lo),l.length>0?(e.importNodes[n].X=a,e.importNodes[n].Y=u+50,l[0].Y=u-50):(e.importNodes[n].X=a,e.importNodes[n].Y=u)}},e=this,o=0;o<this.importNodes.length;o++)n(o)},t.prototype.positionExportNodes=function(){for(var t=this,n=function(n){var o=e.exportConnections.filter((function(t){return t.sourceId===n}));if(console.log(o),o&&o.length>1){var i=o.length,r=o[Math.floor(i/2)],a=e.productionNodes[r.sourceId].X,u=e.productionNodes[r.sourceId].Y;a>so&&(u-=lo),e.exportNodes[n].X=a,e.exportNodes[n].Y=u}else if(o&&1===o.length){var l=e.exportNodes.filter((function(n){return n.X===t.productionNodes[o[0].sourceId].X+uo&&n.Y===t.productionNodes[o[0].sourceId].Y}));a=e.productionNodes[o[0].sourceId].X,u=e.productionNodes[o[0].sourceId].Y,a>=so&&(u-=lo),l.length>0?(e.exportNodes[n].X=a+uo,e.exportNodes[n].Y=u,l[0].X=a-uo):(e.exportNodes[n].X=a,e.exportNodes[n].Y=u)}},e=this,o=0;o<this.exportNodes.length;o++)n(o)},t}(),co=function(){function t(){}return t.prepareSaveData=function(t,n,e){return{productionTableRows:t,powerTableRows:n,importsTableRows:e}},t.saveProductionLine=function(t){var e=this;try{var o=new URL(window.location.href),i=parseInt(o.searchParams.get("id"));n.saveData(t,i).then((function(t){t.success?e.showSuccessMessage("Data successfully saved."):e.showErrorMessage("An error occurred while saving the data. Please try again.")})).catch((function(t){e.showErrorMessage("An error occurred while saving the data. Please try again.")}))}catch(t){this.showErrorMessage("An error occurred while saving the data. Please try again.")}},t.showSuccessMessage=function(t){this.showMessage("saveSuccessAlert",t)},t.showErrorMessage=function(t){this.showMessage("saveErrorAlert",t)},t.showMessage=function(t,n){var e=document.getElementById(t);e&&(e.textContent=n,e.classList.add("d-none"),e.classList.remove("show"),e.offsetWidth,e.classList.remove("d-none"),e.classList.add("show"),setTimeout((function(){e.classList.remove("show"),setTimeout((function(){e.classList.add("d-none")}),150)}),5e3))},t}(),ho=function(t,n,e,o){return new(e||(e=Promise))((function(i,r){function a(t){try{l(o.next(t))}catch(t){r(t)}}function u(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}l((o=o.apply(t,n||[])).next())}))},fo=function(t,n){var e,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(a=0)),a;)try{if(e=1,o&&(i=2&u[0]?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,o=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=n.call(t,a)}catch(t){u=[6,t],o=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}},vo=function(){function n(){var n=this;this.settings=new v,this.importsTableRows=this.readTable("imports",t),this.productionTableRows=this.readTable("recipes",a),this.powerTableRows=this.readTable("power",u),this.addEventListeners(),console.log("TableHandler initialized"),$(document).on("keydown",(function(t){console.log(t.key),"v"===t.key&&t.ctrlKey&&(t.preventDefault(),n.showVisualization()),"s"===t.key&&t.ctrlKey&&(t.preventDefault(),co.saveProductionLine(co.prepareSaveData(n.productionTableRows,n.powerTableRows,n.importsTableRows)))}))}return n.prototype.readTable=function(t,n){var o,i=$("#".concat(t," tbody tr")),r=[],a=0;"power"===t&&(a=1);for(var u,l=function(a){var l=i[a],s=$(l).find("input, select"),p=[];if(s.each((function(t,n){"number"===$(n).attr("type")?p.push(Number($(n).val())):p.push($(n).val())})),"recipes"===t&&(null===(o=i[a+1])||void 0===o?void 0:o.classList.contains("extra-output"))){var c=i[a+1],h=$(c).find("input, select").map((function(t,n){return $(n).val()})).get(),d=new e(h[0],Number(h[1]),Number(h[2]));p.push(!0,d),a++}r.push(new(n.bind.apply(n,function(t,n,e){if(e||2===arguments.length)for(var o,i=0,r=n.length;i<r;i++)!o&&i in n||(o||(o=Array.prototype.slice.call(n,0,i)),o[i]=n[i]);return t.concat(o||Array.prototype.slice.call(n))}([void 0],p,!1)))),u=a},s=0;s<i.length-a;s++)l(s),s=u;return r},n.prototype.addEventListeners=function(){var t=this;["imports","recipes","power"].forEach((function(n){$("#".concat(n," tbody")).find("input, select").each((function(e,o){$(o).on("change",(function(e){t.handleInputChange(e,n)}))}))}))},n.prototype.addSpecificEventListener=function(t){var n=this;$("#".concat(t," tbody")).find("input, select").each((function(e,o){$(o).on("change",(function(e){n.handleInputChange(e,t)}))}))},n.prototype.handleInputChange=function(t,n){return ho(this,void 0,void 0,(function(){var e,o,i,r,a,u;return fo(this,(function(l){switch(l.label){case 0:if(e=$(t.target),o=e.closest("tr").index(),i=e.closest("tr").prevAll(".extra-output").length,r=e.closest("td").index(),a=e.val(),this.checkIfLastRow(e,n)&&this.checkIfSelect(e)&&this.addNewRow(n),!((u=this.getRowByTableIdAndIndex(n,o-i))&&r>=0))return[3,7];switch(this.updateRowData(u,r,a),n){case"imports":return[3,1];case"recipes":return[3,2];case"power":return[3,4]}return[3,6];case 1:case 6:return[3,7];case 2:return[4,this.HandleProductionTable(u,o,a,n,e)];case 3:case 5:return l.sent(),[3,7];case 4:return[4,this.HandlePowerTable(u,o,a,n,e)];case 7:return[2]}}))}))},n.prototype.getRowByTableIdAndIndex=function(t,n){switch(t){case"imports":return this.importsTableRows[n];case"recipes":return this.productionTableRows[n];case"power":return this.powerTableRows[n];default:return null}},n.prototype.updateRowData=function(t,n,e){t[Object.keys(t)[n]]=e},n.prototype.updateRowInTable=function(t,n,e){var o=$("#".concat(t," tbody tr")),i=$(o[n]);i.find("input, select").each((function(t,n){var o,i=Object.keys(e)[t];o=e.recipe&&e.recipe.hasOwnProperty(i)?e.recipe[i]:e[i],$(n).val(o)})),"recipes"===t&&r.handleDoubleExport(e,i)},n.prototype.addNewRow=function(n){var e,o=this,i=(e="power"===n?$("#".concat(n," tbody tr:nth-last-child(2)")):$("#".concat(n," tbody tr:last"))).clone();switch(i.find('input[type="number"]').val(0),i.find('input[type="text"]').val(""),i.find('input[name="power_clock_speed[]"]').val(100),i.find("select").prop("selectedIndex",0),i.insertAfter(e),i.find("input, select").each((function(t,e){$(e).on("change",(function(t){o.handleInputChange(t,n)}))})),n){case"imports":this.importsTableRows.push(new t);break;case"recipes":this.productionTableRows.push(new a);break;case"power":this.powerTableRows.push(new u)}},n.prototype.checkIfLastRow=function(t,n){return"power"===n?t.closest("tr").is(":nth-last-child(2)"):t.closest("tr").is(":last-child")},n.prototype.checkIfSelect=function(t){return t.is("select")},n.prototype.UpdateOnIndex=function(t){for(var n=0;n<t.length;n++){var e=t[n],o=(this.productionTableRows[e],this.productionTableRows.slice(0,e).filter((function(t){return t.doubleExport})).length),i=this.productionTableRows[e];this.updateRowInTable("recipes",e+o,i)}},n.prototype.HandlePowerTable=function(t,n,e,o,i){return ho(this,void 0,void 0,(function(){return fo(this,(function(r){switch(r.label){case 0:return this.checkIfSelect(i)?[4,h.updateBuilding(t,e)]:[3,2];case 1:return r.sent(),[3,3];case 2:t.Consumption=h.calculateSingleConsumption(t),r.label=3;case 3:return this.updateRowInTable(o,n,t),h.updateTotalConsumption(this.powerTableRows),[2]}}))}))},n.prototype.HandleProductionTable=function(t,n,e,o,i){return ho(this,void 0,void 0,(function(){var a;return fo(this,(function(u){switch(u.label){case 0:return[4,r.calculateProductionExport(t)];case 1:return u.sent(),this.checkIfSelect(i)?[4,r.updateRecipe(t,e)]:[3,3];case 2:u.sent(),u.label=3;case 3:return this.updateRowInTable(o,n,t),this.settings.autoImportExport&&(a=f.calculateImports(this.productionTableRows),this.importsTableRows=a.importsTableRows,this.UpdateOnIndex(a.indexes)),this.settings.autoPowerMachine&&(this.powerTableRows=h.calculateBuildings(this.productionTableRows,this.powerTableRows),this.addSpecificEventListener("power")),console.log(this),[2]}}))}))},n.prototype.saveData=function(n,e,o){this.productionTableRows=(n.pop(),n),this.powerTableRows=(e.pop(),e),this.importsTableRows=(o.pop(),o),this.generateTables(),this.powerTableRows.push(new u),this.productionTableRows.push(new a),this.importsTableRows.push(new t)},n.prototype.generateTables=function(){$("#power tbody").html(c.generatePowerTable(this.powerTableRows,l,h.calculateTotalConsumption(this.powerTableRows))),$("#imports tbody").html(c.generateImportsTableRows(this.importsTableRows)),$("#recipes tbody").html(c.generateProductionTableRows(this.productionTableRows)),this.addEventListeners()},n.prototype.showVisualization=function(){var t=f.calculateImports(this.productionTableRows);this.importsTableRows=t.importsTableRows,new po(this)},n}(),mo=function(){function t(){}return t.importData=function(t){return n=this,e=void 0,i=function(){var n,e,o=this;return function(t,n){var e,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(l){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(a=0)),a;)try{if(e=1,o&&(i=2&u[0]?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,o=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=n.call(t,a)}catch(t){u=[6,t],o=0}finally{e=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}(this,(function(i){return this.checkIfFileIsSelected()&&this.checkIfFileIsJson()?(n=$("#importFile").prop("files")[0],(e=new FileReader).readAsText(n),e.onload=function(n){var e,i=JSON.parse(null===(e=n.target)||void 0===e?void 0:e.result);i.productionTable&&i.powerTable&&i.importTable?(t.saveData(i.productionTable,i.powerTable,i.importTable),o.showSuccessMessage("Data successfully imported.")):o.showErrorMessage("The selected file does not contain the required data.")},[2]):[2]}))},new((o=void 0)||(o=Promise))((function(t,r){function a(t){try{l(i.next(t))}catch(t){r(t)}}function u(t){try{l(i.throw(t))}catch(t){r(t)}}function l(n){var e;n.done?t(n.value):(e=n.value,e instanceof o?e:new o((function(t){t(e)}))).then(a,u)}l((i=i.apply(n,e||[])).next())}));var n,e,o,i},t.exportData=function(t){var n=t.productionTableRows,e=t.importsTableRows,o={productionTable:n,powerTable:t.powerTableRows,importTable:e},i=(new TextEncoder).encode(JSON.stringify(o)),r=new Blob([i],{type:"application/json"}),a=URL.createObjectURL(r),u=document.createElement("a");u.href=a,u.download=this.generateFileName(),u.click(),URL.revokeObjectURL(a),this.showSuccessMessage("Data successfully exported.")},t.checkIfFileIsSelected=function(){var t,n=document.getElementById("importFile");if(!(null===(t=n.files)||void 0===t?void 0:t.length)){n.classList.add("is-invalid");var e=n.nextElementSibling;return e&&e.classList.add("d-block"),!1}n.classList.remove("is-invalid");var o=n.nextElementSibling;return o&&o.classList.remove("d-block"),!0},t.checkIfFileIsJson=function(){var t,n=document.getElementById("importFile"),e=null===(t=n.files)||void 0===t?void 0:t[0];if(e&&"application/json"!==e.type){n.classList.add("is-invalid");var o=n.nextElementSibling;return o&&(o.textContent="Please select a valid JSON file.",o.classList.add("d-block")),!1}return!0},t.showMessage=function(t,n){var e=document.getElementById(t);e&&(e.textContent=n,e.classList.add("d-none"),e.classList.remove("show"),e.offsetWidth,e.classList.remove("d-none"),e.classList.add("show"),setTimeout((function(){e.classList.remove("show"),setTimeout((function(){e.classList.add("d-none")}),150)}),5e3))},t.showSuccessMessage=function(t,n){void 0===n&&(n=1),1!==n||this.showMessage("successAlert",t)},t.showErrorMessage=function(t,n){void 0===n&&(n=1),1!==n||this.showMessage("errorAlert",t)},t.generateFileName=function(){var t=Intl.DateTimeFormat().resolvedOptions().timeZone,n=(new Date).toLocaleString("en-GB",{timeZone:t}).replace(/[\/\s,:]/g,"_"),e=$("#productionLineName").text().replace("Production Line - ","");return e=e.replace(/\s/g,"_"),"".concat(e,"_data_").concat(n,".json")},t}(),yo=new vo,go=$("#save_button");go.on("click",(function(t){t.shiftKey&&(t.preventDefault(),co.saveProductionLine(co.prepareSaveData(yo.productionTableRows,yo.powerTableRows,yo.importsTableRows)),go.tooltip("hide"),go.blur())}));var wo=$("#exportButton"),bo=$("#importButton");return wo.on("click",(function(){mo.exportData(yo)})),bo.on("click",(function(t){t.preventDefault(),mo.importData(yo)})),{}})()));