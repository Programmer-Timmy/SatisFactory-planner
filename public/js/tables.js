(()=>{"use strict";var t=function(t,e){void 0===t&&(t=""),void 0===e&&(e=0),this.itemId=t,this.quantity=e},e=function(t,e,n,r,o,i,a){void 0===t&&(t=""),void 0===e&&(e=0),void 0===n&&(n=""),void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=!1),void 0===a&&(a=null),this.recipeId=t,this.quantity=e,this.product=n,this.Usage=r,this.exportPerMin=o,this.doubleExport=i,this.extraCells=a},n=function(t,e,n,r,o){void 0===t&&(t=""),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=!0),this.buildingId=t,this.quantity=e,this.clockSpeed=n,this.Consumption=r,this.userRow=o},r=function(){function t(){}return t.getRecipe=function(t){return new Promise((function(e,n){$.ajax({type:"GET",url:"getRecipe",data:{id:t},dataType:"json",success:function(t){try{e(t)}catch(t){n(t)}},error:function(t,e,r){n(r)}})}))},t}(),o=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e=0),void 0===n&&(n=0),this.Product=t,this.Usage=e,this.ExportPerMin=n},i=function(){function t(){}return t.calculateProductionExport=function(t){t.exportPerMin=t.quantity-t.Usage},t.updateRecipe=function(t,e,n,i){return a=this,c=void 0,u=function(){var e;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(n){switch(n.label){case 0:return e=i,[4,r.getRecipe(+e).then((function(e){console.log(e);var n=e;if(t.product=n.itemName,t.doubleExport=null!==n.secondItemName,t.doubleExport){var r=+n.export_amount_per_min,i=+n.export_amount_per_min2/r,a=t.quantity,c=new o(n.secondItemName,0,a*i);t.extraCells=c}}))];case 1:return n.sent(),[2,t]}}))},new((s=void 0)||(s=Promise))((function(t,e){function n(t){try{o(u.next(t))}catch(t){e(t)}}function r(t){try{o(u.throw(t))}catch(t){e(t)}}function o(e){var o;e.done?t(e.value):(o=e.value,o instanceof s?o:new s((function(t){t(o)}))).then(n,r)}o((u=u.apply(a,c||[])).next())}));var a,c,s,u},t}(),a=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},c=new(function(){function r(){this.importsTableRows=this.readTable("imports",t),this.productionTableRows=this.readTable("recipes",e),this.powerTableRows=this.readTable("power",n),this.addEventListeners()}return r.prototype.readTable=function(t,e){for(var n,r=$("#".concat(t," tbody tr")),i=[],c=0;c<r.length;c++){for(var s=r[c],u=$(s).find("input, select"),l=[],p=0;p<u.length;p++){var d=u[p];l.push($(d).val())}if("recipes"===t&&(null===(n=r[c+1])||void 0===n?void 0:n.classList.contains("extra-output"))){var f=r[c+1],h=$(f).find("input, select").map((function(t,e){return $(e).val()})).get(),v=new o(h[0],Number(h[1]),Number(h[2]));l.push(!0,v),c++}i.push(new(e.bind.apply(e,a([void 0],l,!1))))}return i},r.prototype.addEventListeners=function(){var t=this;["imports","recipes","power"].forEach((function(e){$("#".concat(e," tbody")).find("input, select").each((function(n,r){$(r).on("change",(function(n){console.log("Event triggered:",n),t.handleInputChange(n,e)}))}))}))},r.prototype.handleInputChange=function(t,e){return n=this,r=void 0,a=function(){var n,r,o,a,c;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(s){switch(s.label){case 0:if(n=$(t.target),r=n.closest("tr").index(),o=n.closest("td").index(),a=n.val(),this.checkIfLastRow(n)&&this.checkIfSelect(n)&&this.addNewRow(e),c=this.getRowByTableIdAndIndex(e,r),console.log("Row:",c),!(c&&o>=0))return[3,7];switch(this.updateRowData(c,o,a),e){case"imports":return[3,1];case"recipes":return[3,2];case"power":return[3,5]}return[3,6];case 1:return[3,7];case 2:return i.calculateProductionExport(c),this.checkIfSelect(n)?[4,i.updateRecipe(c,e,r,a)]:[3,4];case 3:s.sent(),s.label=4;case 4:return this.updateRowInTable(e,r,c),[3,7];case 5:case 6:return[3,7];case 7:return[2]}}))},new((o=void 0)||(o=Promise))((function(t,e){function i(t){try{s(a.next(t))}catch(t){e(t)}}function c(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(i,c)}s((a=a.apply(n,r||[])).next())}));var n,r,o,a},r.prototype.getRowByTableIdAndIndex=function(t,e){switch(t){case"imports":return this.importsTableRows[e];case"recipes":return this.productionTableRows[e];case"power":return this.powerTableRows[e];default:return null}},r.prototype.updateRowData=function(t,e,n){t[Object.keys(t)[e]]=n},r.prototype.updateRowInTable=function(t,e,n){var r=$("#".concat(t," tbody tr")),o=$(r[e]);o.find("input, select").each((function(t,e){var r=Object.keys(n)[t];$(e).val(n[r])})),n.doubleExport?(o.find("td:first").attr("rowspan",2),o.find("td:nth-child(2)").attr("rowspan",2),o.find("td:first select").css("height","78px"),o.find("td:nth-child(2) input").css("height","78px"),$('<tr class="extra-output">\n                <td class="m-0 p-0"><input type="text" name="product" value="'.concat(n.extraCells.Product,'" class="form-control rounded-0" readonly></td>\n                <td class="m-0 p-0"><input type="number" name="usage" value="').concat(n.extraCells.Usage,'" class="form-control rounded-0" readonly step="any"></td>\n                <td class="m-0 p-0"><input type="number" name="exportPerMin" value="').concat(n.extraCells.ExportPerMin,'" class="form-control rounded-0" readonly step="any"></td>\n            </tr>')).insertAfter(o)):(o.next(".extra-output").remove(),o.find("td:first").attr("rowspan",1),o.find("td:nth-child(2)").attr("rowspan",1),o.find("td:first select").css("height",""),o.find("td:nth-child(2) input").css("height",""))},r.prototype.addNewRow=function(r){var o=this,i=$("#".concat(r," tbody tr:last")),a=i.clone();switch(a.find("input").val(""),a.find("select").prop("selectedIndex",0),a.insertAfter(i),a.find("input, select").each((function(t,e){$(e).on("change",(function(t){console.log("Event triggered:",t),o.handleInputChange(t,r)}))})),r){case"imports":this.importsTableRows.push(new t);break;case"recipes":this.productionTableRows.push(new e);break;case"power":this.powerTableRows.push(new n)}},r.prototype.checkIfLastRow=function(t){return t.closest("tr").is(":last-child")},r.prototype.checkIfSelect=function(t){return t.is("select")},r}());console.log(c)})();