!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tables=t():e.tables=t()}(this,(()=>(()=>{"use strict";var e,t,o,n={},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var o=i[e]={exports:{}};return n[e].call(o.exports,o,o.exports,a),o.exports}a.m=n,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(o,n){if(1&n&&(o=this(o)),8&n)return o;if("object"==typeof o&&o){if(4&n&&o.__esModule)return o;if(16&n&&"function"==typeof o.then)return o}var i=Object.create(null);a.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var l=2&n&&o;"object"==typeof l&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach((e=>s[e]=()=>o[e]));return s.default=()=>o,a.d(i,s),i},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,o)=>(a.f[o](e,t),t)),[])),a.u=e=>e+".chunk.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o={},a.l=(e,t,n,i)=>{if(o[e])o[e].push(t);else{var s,l;if(void 0!==n)for(var r=document.getElementsByTagName("script"),p=0;p<r.length;p++){var c=r[p];if(c.getAttribute("src")==e){s=c;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.src=e),o[e]=[t];var u=(t,n)=>{s.onerror=s.onload=null,clearTimeout(d);var i=o[e];if(delete o[e],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(n))),t)return t(n)},d=setTimeout(u.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=u.bind(null,s.onerror),s.onload=u.bind(null,s.onload),l&&document.head.appendChild(s)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=o[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={796:0};a.f.j=(t,o)=>{var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var i=new Promise(((o,i)=>n=e[t]=[o,i]));o.push(n[2]=i);var s=a.p+a.u(t),l=new Error;a.l(s,(o=>{if(a.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;l.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",l.name="ChunkLoadError",l.type=i,l.request=s,n[1](l)}}),"chunk-"+t,t)}};var t=(t,o)=>{var n,i,[s,l,r]=o,p=0;if(s.some((t=>0!==e[t]))){for(n in l)a.o(l,n)&&(a.m[n]=l[n]);r&&r(a)}for(t&&t(o);p<s.length;p++)i=s[p],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0},o=this.webpackChunk=this.webpackChunk||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();class s{itemId;quantity;product;constructor(e=0,t=0,o=""){this.itemId=e,this.quantity=t,this.product=o}static async create(e=0,t=0,o=""){return new s(e,t,o)}}class l{static gameSaveId=Number($("#gameSaveId").val())??0;static url=new URL(window.location.href);static productionLineId=parseInt(this.url.searchParams.get("id"));static getRecipe(e){return new Promise((function(t,o){$.ajax({type:"GET",url:"/getRecipe",data:{id:e},headers:{"X-CSRF-Token":l._getCsrfToken()},dataType:"json",success:function(e){try{t(e)}catch(e){o(e)}},error:function(e,t,n){o(n)}})}))}static getBuilding(e){return new Promise((function(t,o){$.ajax({type:"GET",url:"/getBuilding",data:{id:e},headers:{"X-CSRF-Token":l._getCsrfToken()},dataType:"json",success:function(e){try{t(e)}catch(e){o(e)}},error:function(e,t,n){o(n)}})}))}static async saveData(e,t){return new Promise(((o,n)=>{$.ajax({type:"POST",url:"/saveProductionLine",data:{gameSaveId:this.gameSaveId,data:JSON.stringify(e),id:t},headers:{"X-CSRF-Token":l._getCsrfToken()},success:function(e){o(JSON.parse(e))},error:function(e,t,o){n(o)}})}))}static saveSettings(e,t,o,n){$.ajax({type:"POST",url:"/updateProductionLineSettings",headers:{"X-CSRF-Token":l._getCsrfToken()},data:{gameSaveId:this.gameSaveId,productionLineId:e,autoImportExport:t,autoPowerMachine:o,autoSave:n}})}static _getCsrfToken(){const e=$('meta[name="csrf-token"]');if(0===e.length||void 0===e.attr("content"))throw new Error("CSRF token not found");return e.attr("content")}}class r{Product;Usage;ExportPerMin;Quantity;constructor(e="",t=0,o=0,n=0){this.Product=e,this.Usage=t,this.ExportPerMin=o,this.Quantity=n}}class p{static async calculateProductionExport(e){if(e.exportPerMin=e.quantity-e.Usage,e.doubleExport&&null!==e.recipe){const t=this.calculateSecondExportPerMin(e);void 0!==t&&(e.extraCells.Quantity=t,e.extraCells.ExportPerMin=t)}}static async updateRecipe(e,t){await this.saveRecipe(t,e);const o=e.recipe;if(null!==o&&(e.recipeId=o.id,e.product=o.itemName,e.doubleExport=null!==o.secondItemName,e.doubleExport)){const t=+o.export_amount_per_min,n=+o.export_amount_per_min2/t,i=e.quantity;e.extraCells=new r(o.secondItemName,0,i*n)}}static async saveRecipe(e,t){t.recipe=await l.getRecipe(+e)}static handleDoubleExport(e,t){if(e.doubleExport&&null!==e.extraCells)if(t.next(".extra-output").length){const o=t.next(".extra-output"),n=o.find('input[name="production_usage2[]"]'),i=o.find('input[name="production_export2[]"]');n.val(e.extraCells.Usage),i.val(e.extraCells.ExportPerMin)}else{t.find("td:nth-child(2)").attr("rowspan",2),t.find("td:nth-child(3)").attr("rowspan",2),t.find("td:nth-child(2) .search-input").css("height","78px"),t.find("td:nth-child(3) input").css("height","78px");const o=t.find(".delete-production-row");o.parent().attr("rowspan",2),o.css("height","78px"),$(`\n                    <tr class="extra-output">\n                        <td class="m-0 p-0">\n                            <input type="text" name="product" value="${e.extraCells.Product}" class="form-control rounded-0" readonly>\n                        </td>\n                        <td class="m-0 p-0">\n                            <input type="number" name="production_usage2[]" value="${e.extraCells.Usage}" class="form-control rounded-0" readonly step="any">\n                        </td>\n                        <td class="m-0 p-0">\n                            <input type="number" name="production_export2[]" value="${e.extraCells.ExportPerMin}" class="form-control rounded-0" readonly step="any">\n                        </td>\n                    </tr>\n                `).insertAfter(t)}else if(t.next(".extra-output").length){t.next(".extra-output").remove(),t.find("td:nth-child(2)").removeAttr("rowspan"),t.find("td:nth-child(3)").removeAttr("rowspan"),t.find("td:nth-child(2) .search-input").css("height",""),t.find("td:nth-child(3) input").css("height","");const e=t.find(".delete-production-row");e.parent().removeAttr("rowspan"),e.css("height","39px")}}static calculateSecondExportPerMin(e){if(null===e.recipe)return;const t=e.recipe.export_amount_per_min2,o=e.recipe.export_amount_per_min;if(null===t||null===o)return;const n=t/o;return e.quantity*n}}const c={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let u;const d=new Uint8Array(16),h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));const m=function(e,t,o){if(c.randomUUID&&!t&&!e)return c.randomUUID();const n=(e=e||{}).random??e.rng?.()??function(){if(!u){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");u=crypto.getRandomValues.bind(crypto)}return u(d)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((o=o||0)<0||o+16>t.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[o+e]=n[e];return t}return function(e,t=0){return(h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]).toLowerCase()}(n)};class v{row_id;recipeId;quantity;product;Usage;exportPerMin;doubleExport;extraCells;recipe;imports;productionImports;recipeSetting=null;constructor(e=m(),t="",o=0,n="",i=0,a=0,s=!1,l=null){this.row_id=e,this.recipeId=+t,this.quantity=o,this.product=n,this.Usage=i,this.exportPerMin=a,this.doubleExport=s,this.extraCells=l,this.recipe=null,this.imports=[],this.productionImports=[]}static async create(e=0,t="",o=0,n="",i=0,a=0,s=!1,r=null,c=[]){const u=new v(e,t,o,n,i,a,s,r);return null==u.recipe&&(u.recipe=c.find((e=>e.id===+t))||null,null==u.recipe&&t&&(u.recipe=await l.getRecipe(+t),u.recipe&&!c.find((e=>e.id===u.recipe?.id))&&c.push(u.recipe))),null!==u.extraCells&&(u.extraCells.Quantity=p.calculateSecondExportPerMin(u)),u}async getRecipe(e){this.recipe=await l.getRecipe(+e)}saveDoubleExportQuantity(){this.doubleExport&&null!==this.extraCells&&(this.extraCells.Quantity=p.calculateSecondExportPerMin(this))}}class g{buildingId;quantity;clockSpeed;Consumption;userRow;building;constructor(e=NaN,t=0,o=100,n=0,i=!0,a=null){this.buildingId=e,this.quantity=t,this.clockSpeed=o,this.Consumption=n,this.userRow=i,this.building=a}static async create(e=NaN,t=0,o=100,n=0,i=!0,a=null,s=[]){if("string"==typeof i)switch(i.toLowerCase()){case"0":case"false":i=!1;break;default:i=!0}const r=new g(e,t,o,n,i,a);if(!a&&e&&(r.building=s.find((t=>t.id===+e))||null,!r.building)){const t=await l.getBuilding(e);t&&!s.find((e=>e.id===t.id))&&s.push(t),r.building=t}return r}}const w='\n<option value="" disabled>Select a building</option>\n<option value="16">Assembler</option>\n<option value="247">AWESOME Sink</option>\n<option value="17">Blender</option>\n<option value="19">Constructor</option>\n<option value="6">Converter</option>\n<option value="13">Foundry</option>\n<option value="246">Hypertube Entrance</option>\n<option value="21">Main Portal</option>\n<option value="15">Manufacturer</option>\n<option value="10">Miner Mk.1</option>\n<option value="9">Miner Mk.2</option>\n<option value="11">Miner Mk.3</option>\n<option value="8">Oil Extractor</option>\n<option value="14">Packager</option>\n<option value="7">Particle Accelerator</option>\n<option value="249">Pipeline Pump Mk.1</option>\n<option value="248">Pipeline Pump Mk.2</option>\n<option value="5">Quantum Encoder</option>\n<option value="12">Refinery</option>\n<option value="22">Satellite Portal</option>\n<option value="18">Smelter</option>\n<option value="250">Valve</option>\n<option value="4">Water Extractor</option>\n',b='\n    <option value="" disabled>Select a recipe</option>\n    <option value="259">Actual Snow</option>\n    <option value="116">Adaptive Control Unit</option>\n    <option value="14">AI Expansion Server</option>\n    <option value="110">AI Limiter</option>\n    <option value="95">Alclad Aluminum Sheet</option>\n    <option value="245">Alien DNA Capsule</option>\n    <option value="242">Alien Power Matrix</option>\n    <option value="133">Alternate: Adhered Iron Plate</option>\n    <option value="177">Alternate: Alclad Casing</option>\n    <option value="182">Alternate: Aluminum Beam</option>\n    <option value="183">Alternate: Aluminum Rod</option>\n    <option value="105">Alternate: Automated Speed Wiring</option>\n    <option value="189">Alternate: Basic Iron Ingot</option>\n    <option value="49">Alternate: Biocoal</option>\n    <option value="132">Alternate: Bolted Frame</option>\n    <option value="208">Alternate: Bolted Iron Plate</option>\n    <option value="204">Alternate: Cast Screw</option>\n    <option value="227">Alternate: Caterium Circuit Board</option>\n    <option value="226">Alternate: Caterium Computer</option>\n    <option value="194">Alternate: Caterium Wire</option>\n    <option value="48">Alternate: Charcoal</option>\n    <option value="202">Alternate: Cheap Silica</option>\n    <option value="176">Alternate: Classic Battery</option>\n    <option value="62">Alternate: Cloudy Diamonds</option>\n    <option value="131">Alternate: Coated Cable</option>\n    <option value="130">Alternate: Coated Iron Canister</option>\n    <option value="129">Alternate: Coated Iron Plate</option>\n    <option value="128">Alternate: Coke Steel Ingot</option>\n    <option value="50">Alternate: Compacted Coal</option>\n    <option value="215">Alternate: Compacted Steel Ingot</option>\n    <option value="175">Alternate: Cooling Device</option>\n    <option value="127">Alternate: Copper Alloy Ingot</option>\n    <option value="122">Alternate: Copper Rotor</option>\n    <option value="225">Alternate: Crystal Computer</option>\n    <option value="64">Alternate: Dark Matter Crystallization</option>\n    <option value="63">Alternate: Dark Matter Trap</option>\n    <option value="8">Alternate: Dark-Ion Fuel</option>\n    <option value="174">Alternate: Diluted Fuel</option>\n    <option value="121">Alternate: Diluted Packaged Fuel</option>\n    <option value="185">Alternate: Distilled Silica</option>\n    <option value="173">Alternate: Electric Motor</option>\n    <option value="120">Alternate: Electrode Aluminum Scrap</option>\n    <option value="119">Alternate: Electrode Circuit Board</option>\n    <option value="222">Alternate: Electromagnetic Connection Rod</option>\n    <option value="206">Alternate: Encased Industrial Pipe</option>\n    <option value="172">Alternate: Fertile Uranium</option>\n    <option value="221">Alternate: Fine Black Powder</option>\n    <option value="224">Alternate: Fine Concrete</option>\n    <option value="118">Alternate: Flexible Framework</option>\n    <option value="187">Alternate: Fused Quartz Crystal</option>\n    <option value="210">Alternate: Fused Quickwire</option>\n    <option value="117">Alternate: Fused Wire</option>\n    <option value="220">Alternate: Heat Exchanger</option>\n    <option value="171">Alternate: Heat-Fused Frame</option>\n    <option value="219">Alternate: Heavy Encased Frame</option>\n    <option value="112">Alternate: Heavy Flexible Frame</option>\n    <option value="111">Alternate: Heavy Oil Residue</option>\n    <option value="196">Alternate: Infused Uranium Cell</option>\n    <option value="170">Alternate: Instant Plutonium Cell</option>\n    <option value="169">Alternate: Instant Scrap</option>\n    <option value="230">Alternate: Insulated Cable</option>\n    <option value="223">Alternate: Insulated Crystal Oscillator</option>\n    <option value="217">Alternate: Iron Alloy Ingot</option>\n    <option value="179">Alternate: Iron Pipe</option>\n    <option value="195">Alternate: Iron Wire</option>\n    <option value="193">Alternate: Leached Caterium Ingot</option>\n    <option value="191">Alternate: Leached Copper Ingot</option>\n    <option value="188">Alternate: Leached Iron ingot</option>\n    <option value="181">Alternate: Molded Beam</option>\n    <option value="178">Alternate: Molded Steel Pipe</option>\n    <option value="4">Alternate: Nitro Rocket Fuel</option>\n    <option value="163">Alternate: OC Supercomputer</option>\n    <option value="61">Alternate: Oil-Based Diamonds</option>\n    <option value="60">Alternate: Petroleum Diamonds</option>\n    <option value="59">Alternate: Pink Diamonds</option>\n    <option value="184">Alternate: Plastic AI Limiter</option>\n    <option value="104">Alternate: Plastic Smart Plating</option>\n    <option value="162">Alternate: Plutonium Fuel Unit</option>\n    <option value="248">Alternate: Polyester Fabric</option>\n    <option value="103">Alternate: Polymer Resin</option>\n    <option value="93">Alternate: Pure Aluminum Ingot</option>\n    <option value="92">Alternate: Pure Caterium Ingot</option>\n    <option value="91">Alternate: Pure Copper Ingot</option>\n    <option value="90">Alternate: Pure Iron Ingot</option>\n    <option value="88">Alternate: Pure Quartz Crystal</option>\n    <option value="186">Alternate: Quartz Purification</option>\n    <option value="229">Alternate: Quickwire Cable</option>\n    <option value="201">Alternate: Quickwire Stator</option>\n    <option value="209">Alternate: Radio Connection Unit</option>\n    <option value="161">Alternate: Radio Control System</option>\n    <option value="211">Alternate: Recycled Plastic</option>\n    <option value="87">Alternate: Recycled Rubber</option>\n    <option value="213">Alternate: Rigor Motor</option>\n    <option value="86">Alternate: Rubber Concrete</option>\n    <option value="228">Alternate: Silicon Circuit Board</option>\n    <option value="218">Alternate: Silicon High-Speed Connector</option>\n    <option value="160">Alternate: Sloppy Alumina</option>\n    <option value="216">Alternate: Solid Steel Ingot</option>\n    <option value="85">Alternate: Steamed Copper Sheet</option>\n    <option value="72">Alternate: Steel Canister</option>\n    <option value="180">Alternate: Steel Cast Plate</option>\n    <option value="67">Alternate: Steel Rod</option>\n    <option value="205">Alternate: Steel Rotor</option>\n    <option value="203">Alternate: Steel Screw</option>\n    <option value="214">Alternate: Steeled Frame</option>\n    <option value="207">Alternate: Stitched Iron Plate</option>\n    <option value="156">Alternate: Super-State Computer</option>\n    <option value="192">Alternate: Tempered Caterium Ingot</option>\n    <option value="190">Alternate: Tempered Copper Ingot</option>\n    <option value="145">Alternate: Turbo Blend Fuel</option>\n    <option value="18">Alternate: Turbo Diamonds</option>\n    <option value="198">Alternate: Turbo Electric Motor</option>\n    <option value="66">Alternate: Turbo Heavy Fuel</option>\n    <option value="134">Alternate: Turbo Pressure Motor</option>\n    <option value="212">Alternate: Uranium Fuel Unit</option>\n    <option value="65">Alternate: Wet Concrete</option>\n    <option value="96">Alumina Solution</option>\n    <option value="94">Aluminum Casing</option>\n    <option value="99">Aluminum Ingot</option>\n    <option value="97">Aluminum Scrap</option>\n    <option value="153">Assembly Director System</option>\n    <option value="109">Automated Wiring</option>\n    <option value="234">Ballistic Warp Drive</option>\n    <option value="148">Battery</option>\n    <option value="28">Bauxite (Caterium)</option>\n    <option value="29">Bauxite (Copper)</option>\n    <option value="25">Biochemical Sculptor</option>\n    <option value="240">Biomass (Mycelia)</option>\n    <option value="246">Biomass (Alien Protein)</option>\n    <option value="263">Biomass (Leaves)</option>\n    <option value="264">Biomass (Wood)</option>\n    <option value="241">Black Powder</option>\n    <option value="256">Blue FICSMAS Ornament</option>\n    <option value="268">Cable</option>\n    <option value="262">Candy Cane</option>\n    <option value="197">Caterium Ingot</option>\n    <option value="30">Caterium Ore (Copper)</option>\n    <option value="31">Caterium Ore (Quartz)</option>\n    <option value="51">Circuit Board</option>\n    <option value="32">Coal (Iron)</option>\n    <option value="33">Coal (Limestone)</option>\n    <option value="113">Computer</option>\n    <option value="266">Concrete</option>\n    <option value="147">Cooling System</option>\n    <option value="257">Copper FICSMAS Ornament</option>\n    <option value="270">Copper Ingot</option>\n    <option value="34">Copper Ore (Quartz)</option>\n    <option value="35">Copper Ore (Sulfur)</option>\n    <option value="139">Copper Powder</option>\n    <option value="125">Copper Sheet</option>\n    <option value="101">Crystal Oscillator</option>\n    <option value="11">Dark Matter Crystal</option>\n    <option value="9">Dark Matter Residue</option>\n    <option value="23">Diamonds</option>\n    <option value="157">Electromagnetic Control Rod</option>\n    <option value="73">Empty Canister</option>\n    <option value="166">Empty Fluid Tank</option>\n    <option value="106">Encased Industrial Beam</option>\n    <option value="135">Encased Plutonium Cell</option>\n    <option value="146">Encased Uranium Cell</option>\n    <option value="10">Excited Photonic Matter</option>\n    <option value="249">Fabric</option>\n    <option value="21">Ficsite Ingot (Iron)</option>\n    <option value="26">Ficsite Ingot (Aluminum)</option>\n    <option value="27">Ficsite Ingot (Caterium)</option>\n    <option value="20">Ficsite Trigon</option>\n    <option value="261">FICSMAS Bow</option>\n    <option value="253">FICSMAS Decoration</option>\n    <option value="254">FICSMAS Ornament Bundle</option>\n    <option value="260">FICSMAS Tree Branch</option>\n    <option value="252">FICSMAS Wonder Star</option>\n    <option value="231">Ficsonium</option>\n    <option value="232">Ficsonium Fuel Rod</option>\n    <option value="52">Fuel</option>\n    <option value="165">Fused Modular Frame</option>\n    <option value="247">Gas Filter</option>\n    <option value="244">Hatcher Protein</option>\n    <option value="164">Heat Sink</option>\n    <option value="114">Heavy Modular Frame</option>\n    <option value="154">High-Speed Connector</option>\n    <option value="238">Hog Protein</option>\n    <option value="235">Iodine-Infused Filter</option>\n    <option value="15">Ionized Fuel</option>\n    <option value="258">Iron FICSMAS Ornament</option>\n    <option value="3">Iron Ingot</option>\n    <option value="36">Iron Ore (Limestone)</option>\n    <option value="1">Iron Plate</option>\n    <option value="2">Iron Rod</option>\n    <option value="37">Limestone (Sulfur)</option>\n    <option value="75">Liquid Biofuel</option>\n    <option value="159">Magnetic Field Generator</option>\n    <option value="115">Modular Engine</option>\n    <option value="123">Modular Frame</option>\n    <option value="107">Motor</option>\n    <option value="13">Neural-Quantum Processor</option>\n    <option value="137">Nitric Acid</option>\n    <option value="38">Nitrogen Gas (Bauxite)</option>\n    <option value="39">Nitrogen Gas (Caterium)</option>\n    <option value="138">Non-Fissile Uranium</option>\n    <option value="143">Nuclear Pasta</option>\n    <option value="98">Packaged Alumina Solution</option>\n    <option value="74">Packaged Fuel</option>\n    <option value="78">Packaged Heavy Oil Residue</option>\n    <option value="16">Packaged Ionized Fuel</option>\n    <option value="76">Packaged Liquid Biofuel</option>\n    <option value="142">Packaged Nitric Acid</option>\n    <option value="167">Packaged Nitrogen Gas</option>\n    <option value="77">Packaged Oil</option>\n    <option value="6">Packaged Rocket Fuel</option>\n    <option value="152">Packaged Sulfuric Acid</option>\n    <option value="46">Packaged Turbofuel</option>\n    <option value="79">Packaged Water</option>\n    <option value="53">Petroleum Coke</option>\n    <option value="54">Plastic</option>\n    <option value="141">Plutonium Fuel Rod</option>\n    <option value="140">Plutonium Pellet</option>\n    <option value="136">Pressure Conversion Cube</option>\n    <option value="89">Quartz Crystal</option>\n    <option value="236">Quickwire</option>\n    <option value="150">Radio Control Unit</option>\n    <option value="40">Raw Quartz (Bauxite)</option>\n    <option value="41">Raw Quartz (Coal)</option>\n    <option value="24">Reanimated SAM</option>\n    <option value="255">Red FICSMAS Ornament</option>\n    <option value="265">Reinforced Iron Plate</option>\n    <option value="56">Residual Fuel</option>\n    <option value="57">Residual Plastic</option>\n    <option value="58">Residual Rubber</option>\n    <option value="5">Rocket Fuel</option>\n    <option value="124">Rotor</option>\n    <option value="55">Rubber</option>\n    <option value="19">SAM Fluctuator</option>\n    <option value="267">Screw</option>\n    <option value="100">Silica</option>\n    <option value="233">Singularity Cell</option>\n    <option value="126">Smart Plating</option>\n    <option value="251">Smokeless Powder</option>\n    <option value="237">Solid Biofuel</option>\n    <option value="239">Spitter Protein</option>\n    <option value="108">Stator</option>\n    <option value="68">Steel Beam</option>\n    <option value="70">Steel Ingot</option>\n    <option value="69">Steel Pipe</option>\n    <option value="243">Stinger Protein</option>\n    <option value="42">Sulfur (Coal)</option>\n    <option value="43">Sulfur (Iron)</option>\n    <option value="151">Sulfuric Acid</option>\n    <option value="149">Supercomputer</option>\n    <option value="12">Superposition Oscillator</option>\n    <option value="250">Synthetic Power Shard</option>\n    <option value="200">Thermal Propulsion Rocket</option>\n    <option value="22">Time Crystal</option>\n    <option value="199">Turbo Motor</option>\n    <option value="45">Turbofuel</option>\n    <option value="102">Unpackage Alumina Solution</option>\n    <option value="81">Unpackage Fuel</option>\n    <option value="83">Unpackage Heavy Oil Residue</option>\n    <option value="17">Unpackage Ionized Fuel</option>\n    <option value="80">Unpackage Liquid Biofuel</option>\n    <option value="144">Unpackage Nitric Acid</option>\n    <option value="168">Unpackage Nitrogen Gas</option>\n    <option value="82">Unpackage Oil</option>\n    <option value="7">Unpackage Rocket Fuel</option>\n    <option value="155">Unpackage Sulfuric Acid</option>\n    <option value="47">Unpackage Turbofuel</option>\n    <option value="84">Unpackage Water</option>\n    <option value="158">Uranium Fuel Rod</option>\n    <option value="44">Uranium Ore (Bauxite)</option>\n    <option value="71">Versatile Framework</option>\n    <option value="269">Wire</option>\n';class f{static generatePowerTable(e,t,o){return e.map(((e,o)=>`\n      <tr>\n        <td class="m-0 p-0 w-50">\n          <select class="form-control rounded-0" name="power_building_id[]" min="0">\n            ${t.replace(`<option value="${e.buildingId}">`,`<option value="${e.buildingId}" selected>`)}\n          </select>\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="${e.quantity}" class="form-control rounded-0" name="power_amount[]" min="0" step="any" data-index="${o}" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="${e.clockSpeed}" class="form-control rounded-0" name="power_clock_speed[]" min="1" max="250" step="any" data-index="${o}" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="${e.Consumption}" class="form-control rounded-0" disabled name="power_Consumption[]" min="0" step="any">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="hidden" value="${e.userRow?1:0}" class="form-control rounded-0" readonly name="user[]" min="0">\n        </td>\n      </tr>\n    `)).join("")+`\n      <tr>\n        <td class="m-0 p-0 w-50">\n          <select class="form-control rounded-0" name="power_building_id[]" min="0">\n            ${t.replace(/<option /,"<option selected ")} \x3c!-- Selects the first option --\x3e\n          </select>\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="0" class="form-control rounded-0" name="power_amount[]" min="0" step="any" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="100" class="form-control rounded-0" name="power_clock_speed[]" min="1" max="250" step="any" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="0" class="form-control rounded-0" readonly name="power_Consumption[]" min="0" step="any">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="hidden" value="1" class="form-control rounded-0" readonly name="user[]" min="0">\n        </td>\n      </tr>\n    `+`\n      <tr>\n        <td colspan="1" class="table-dark">\n          Total:\n        </td>\n        <td colspan="2"></td>\n        <td class="w-25 m-0 p-0">\n          <input type="number" name="total_consumption" readonly class="form-control rounded-0" id="totalConsumption" value="${o}">\n        </td>\n      </tr>\n    `}static generateImportsTableRows(e){return e.map((e=>{const t=Number(e.quantity)%1==0?e.quantity.toFixed(0):e.quantity.toFixed(5);return`\n            <tr>\n                <td class="m-0 p-0 w-75">\n                    <select name="imports_item_id[]" class="form-control rounded-0">\n                        ${'\n<option value="" disabled>Select an item</option>\n<option value="111">Actual Snow</option>\n<option value="82">Adaptive Control Unit</option>\n<option value="48">AI Expansion Server</option>\n<option value="79">AI Limiter</option>\n<option value="45">Alclad Aluminum Sheet</option>\n<option value="102">Alien DNA Capsule</option>\n<option value="100">Alien Protein</option>\n<option value="72">Alumina Solution</option>\n<option value="71">Aluminum Casing</option>\n<option value="7">Aluminum Ingot</option>\n<option value="70">Aluminum Scrap</option>\n<option value="56">Assembly Director System</option>\n<option value="77">Automated Wiring</option>\n<option value="98">Ballistic Warp Drive</option>\n<option value="8">Battery</option>\n<option value="128">Bauxite</option>\n<option value="55">Biochemical Sculptor</option>\n<option value="137">Biomass</option>\n<option value="95">Black Powder</option>\n<option value="117">Blue FICSMAS Ornament</option>\n<option value="101">Blue Power Slug</option>\n<option value="20">Cable</option>\n<option value="110">Candy Cane</option>\n<option value="57">Caterium Ingot</option>\n<option value="129">Caterium Ore</option>\n<option value="59">Circuit Board</option>\n<option value="123">Coal</option>\n<option value="14">Compacted Coal</option>\n<option value="73">Computer</option>\n<option value="3">Concrete</option>\n<option value="37">Cooling System</option>\n<option value="113">Copper FICSMAS Ornament</option>\n<option value="69">Copper Ingot</option>\n<option value="130">Copper Ore</option>\n<option value="88">Copper Powder</option>\n<option value="26">Copper Sheet</option>\n<option value="134">Crude Oil</option>\n<option value="32">Crystal Oscillator</option>\n<option value="34">Dark Matter Crystal</option>\n<option value="41">Dark Matter Residue</option>\n<option value="44">Diamonds</option>\n<option value="93">Dissolved Silica</option>\n<option value="90">Electromagnetic Control Rod</option>\n<option value="58">Empty Canister</option>\n<option value="31">Empty Fluid Tank</option>\n<option value="61">Encased Industrial Beam</option>\n<option value="84">Encased Plutonium Cell</option>\n<option value="92">Encased Uranium Cell</option>\n<option value="43">Excited Photonic Matter</option>\n<option value="146">Fabric</option>\n<option value="54">Ficsite Ingot</option>\n<option value="38">Ficsite Trigon</option>\n<option value="112">FICSMAS Bow</option>\n<option value="109">FICSMAS Decoration</option>\n<option value="118">FICSMAS Gift</option>\n<option value="108">FICSMAS Ornament Bundle</option>\n<option value="115">FICSMAS Tree Branch</option>\n<option value="107">FICSMAS Wonder Star</option>\n<option value="96">Ficsonium</option>\n<option value="121">Ficsonium Fuel Rod</option>\n<option value="24">Fuel</option>\n<option value="52">Fused Modular Frame</option>\n<option value="99">Gas Filter</option>\n<option value="150">Hatcher Remains</option>\n<option value="89">Heat Sink</option>\n<option value="74">Heavy Modular Frame</option>\n<option value="64">Heavy Oil Residue</option>\n<option value="76">High-Speed Connector</option>\n<option value="147">Hog Remains</option>\n<option value="13">Iodine-Infused Filter</option>\n<option value="35">Ionized Fuel</option>\n<option value="114">Iron FICSMAS Ornament</option>\n<option value="21">Iron Ingot</option>\n<option value="122">Iron Ore</option>\n<option value="5">Iron Plate</option>\n<option value="18">Iron Rod</option>\n<option value="138">Leaves</option>\n<option value="132">Limestone</option>\n<option value="141">Liquid Biofuel</option>\n<option value="49">Magnetic Field Generator</option>\n<option value="103">Mercer Sphere</option>\n<option value="81">Modular Engine</option>\n<option value="27">Modular Frame</option>\n<option value="33">Motor</option>\n<option value="139">Mycelia</option>\n<option value="47">Neural-Quantum Processor</option>\n<option value="29">Nitric Acid</option>\n<option value="125">Nitrogen Gas</option>\n<option value="86">Non-Fissile Uranium</option>\n<option value="91">Nuclear Pasta</option>\n<option value="142">Packaged Alumina Solution</option>\n<option value="9">Packaged Fuel</option>\n<option value="15">Packaged Heavy Oil Residue</option>\n<option value="10">Packaged Ionized Fuel</option>\n<option value="136">Packaged Liquid Biofuel</option>\n<option value="144">Packaged Nitric Acid</option>\n<option value="143">Packaged Nitrogen Gas</option>\n<option value="17">Packaged Oil</option>\n<option value="11">Packaged Rocket Fuel</option>\n<option value="145">Packaged Sulfuric Acid</option>\n<option value="12">Packaged Turbofuel</option>\n<option value="68">Packaged Water</option>\n<option value="16">Petroleum Coke</option>\n<option value="60">Plastic</option>\n<option value="120">Plutonium Fuel Rod</option>\n<option value="85">Plutonium Pellet</option>\n<option value="2">Plutonium Waste</option>\n<option value="63">Polymer Resin</option>\n<option value="83">Pressure Conversion Cube</option>\n<option value="104">Purple Power Slug</option>\n<option value="65">Quartz Crystal</option>\n<option value="80">Quickwire</option>\n<option value="53">Radio Control Unit</option>\n<option value="131">Raw Quartz</option>\n<option value="42">Reanimated SAM</option>\n<option value="116">Red FICSMAS Ornament</option>\n<option value="22">Reinforced Iron Plate</option>\n<option value="25">Rocket Fuel</option>\n<option value="23">Rotor</option>\n<option value="62">Rubber</option>\n<option value="127">SAM</option>\n<option value="50">SAM Fluctuator</option>\n<option value="28">Screw</option>\n<option value="4">Silica</option>\n<option value="97">Singularity Cell</option>\n<option value="75">Smart Plating</option>\n<option value="106">Smokeless Powder</option>\n<option value="135">Solid Biofuel</option>\n<option value="148">Spitter Remains</option>\n<option value="78">Stator</option>\n<option value="6">Steel Beam</option>\n<option value="66">Steel Ingot</option>\n<option value="51">Steel Pipe</option>\n<option value="149">Stinger Remains</option>\n<option value="126">Sulfur</option>\n<option value="87">Sulfuric Acid</option>\n<option value="36">Supercomputer</option>\n<option value="46">Superposition Oscillator</option>\n<option value="94">Thermal Propulsion Rocket</option>\n<option value="40">Time Crystal</option>\n<option value="39">Turbo Motor</option>\n<option value="30">Turbofuel</option>\n<option value="133">Uranium</option>\n<option value="119">Uranium Fuel Rod</option>\n<option value="1">Uranium Waste</option>\n<option value="67">Versatile Framework</option>\n<option value="124">Water</option>\n<option value="19">Wire</option>\n<option value="140">Wood</option>\n<option value="105">Yellow Power Slug</option>\n'.replace(`value="${e.itemId}"`,`value="${e.itemId}" selected`)}\n                    </select>\n                </td>\n                <td class="m-0 p-0 w-25">\n                    <input min="0" type="number" name="imports_ammount[]" class="form-control rounded-0" value="${t}" readonly>\n                </td>\n            </tr>\n        `})).join("")}static generateProductionTableRows(e){return e.map((e=>{let t="",o="",n="";return e.doubleExport&&(t='style="height: 78px"',n='rowspan="2"',o=`\n            <tr class="extra-output">\n                <td class="m-0 p-0">\n                    <input type="text" readonly class="form-control rounded-0 product-name" value="${e.extraCells?.Product}">\n                </td>\n                <td class="m-0 p-0">\n                    <input min="0" type="number" step="any" name="production_usage2[]" value="${e.extraCells?.Usage}" required readonly class="form-control rounded-0 usage-amount">\n                </td>\n                <td class="m-0 p-0">\n                    <input min="0" type="number" step="any" name="production_export2[]" value="${e.extraCells?.Quantity}" required readonly class="form-control rounded-0 export-amount">\n                </td>\n            </tr>\n            `),` <tr>\n          <td class="hidden">\n            <input type="hidden" name="production_id[]" value="${e.row_id}">\n          </td>\n          <td class="m-0 p-0" ${n}>\n            <select name="production_recipe_id[]" class="form-control rounded-0 item-recipe-id recipe" ${t}>\n              ${b.replace(`value="${e.recipeId}"`,`value="${e.recipeId}" selected`)}\n            </select>\n          </td>\n          <td class="m-0 p-0" ${n}>\n            <input min="0" type="number" step="any" name="production_quantity[]" value="${e.quantity}" required class="form-control rounded-0 production-quantity" ${t}>\n          </td>\n          <td class="m-0 p-0">\n            <input type="text" readonly class="form-control rounded-0 product-name" value="${e.product}">\n          </td>\n          <td class="m-0 p-0">\n            <input min="0" type="number" step="any" name="production_usage[]" value="${e.Usage}" required readonly class="form-control rounded-0 usage-amount">\n          </td>\n          <td class="m-0 p-0">\n            <input min="0" type="number" step="any" name="production_export[]" value="${e.exportPerMin}" required readonly class="form-control rounded-0 export-amount">\n          </td>\n        </tr>\n        ${o}\n        `})).join("")+`\n        <tr>\n            <td class="m-0 p-0">\n                <select name="production_recipe_id[]" class="form-control rounded-0 item-recipe-id recipe">\n                    ${b.replace(/<option /,"<option selected ")}\n                </select>\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_quantity[]" required class="form-control rounded-0 production-quantity">\n            </td>\n            <td class="m-0 p-0">\n                <input type="text" readonly class="form-control rounded-0 product-name">\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_usage[]" required readonly class="form-control rounded-0 usage-amount">\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_export[]" required readonly class="form-control rounded-0 export-amount">\n            </td>\n        </tr>\n    `}static createCard(e,t,o,n,i,a,s){return`\n        <div class="card mb-2" id="check-${e}">\n            <div class="card-body p-3">\n                <h5 class="card-title recipeName">${t}</h5>\n                <p class="card-text"><span class="productionAmount">${o}</span> per min - <span class="buildingAmount">${+n.toFixed(5)}</span> <span class="buildingName">${s}</span></p>\n                <div style="display: flex; justify-content: space-between;">\n                    <div>\n                        <input type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="dark" for="build" class="beenBuild"\n                               data-onlabel="<i class='fa-solid fa-check'></i>" data-offlabel="<i class='fa-solid fa-times'></i>"\n                               data-size="sm" data-style="ios" data-theme="dark" ${i?"checked":""}/>\n                        <label for="build">Build</label>\n                    </div>\n                    <div>\n                        \x3c!--                        same checkbox as above--\x3e\n                        <input type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="dark" for="tested" class="beenTested"\n                               data-onlabel="<i class='fa-solid fa-check'></i>" data-offlabel="<i class='fa-solid fa-times'></i>"\n                               data-size="sm" data-style="ios" data-theme="dark" ${a?"checked":""}/>\n                        <label for="tested">Tested</label>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}}class y{static calculateBuildings(e,t){const o=t.filter((e=>1==e.userRow));o.pop();let n=[];for(let t=0;t+1<e.length;t++){const o=e[t],i=o.recipe;if(null!==i){const e=i.building,t=o.recipeSetting?.clockSpeed||100,a=o.recipeSetting?.useSomersloop||!1,s=n.find((o=>o.buildingId===e.id&&o.clockSpeed===t));let l=y.calculateBuildingAmount(i,o),r=0;const p=+y.calculateConsumption(l,t,e.power_used,a);if(l%1!=0&&(r=l%1,l=Math.floor(l)),s?(s.quantity+=l,s.Consumption=+y.calculateConsumption(s.quantity,t,e.power_used,a),s.clockSpeed=t):n.push(new g(e.id,l,t,p,!1,e)),r>0){const t=100*r;if(t<1)continue;const o=+y.calculateConsumption(1,t,e.power_used,a);n.push(new g(e.id,1,+t.toFixed(5),o,!1,e))}}}n=n.concat(o);const i=f.generatePowerTable(n,w,y.calculateTotalConsumption(n));return $("#power tbody").html(i),n.push(new g),n}static calculateBuildingAmount(e,t){const o=t.quantity,n=t.recipeSetting?.clockSpeed||100,i=t.recipeSetting?.useSomersloop||!1;return o/(e.export_amount_per_min*(n/100))/(i?2:1)}static calculateConsumption(e,t,o,n){return+(e*o*Math.pow(1+(n?4:0)/4,2)*Math.pow(t/100,1.321928)).toFixed(5)}static calculateTotalConsumption(e){const t=e.filter((e=>0!==e.Consumption)).reduce(((e,t)=>e+(Number(t.Consumption)||0)),0);return parseFloat(t.toFixed(5))}static calculateSingleConsumption(e){if(null===e.building)return 0;const t=Math.pow(e.clockSpeed/100,1.321928);return+(e.quantity*e.building.power_used*t).toFixed(5)}static async updateBuilding(e,t){e.building=await l.getBuilding(t),e.buildingId=t,e.Consumption=+y.calculateSingleConsumption(e)}static updateTotalConsumption(e){const t=y.calculateTotalConsumption(e);$("#totalConsumption").val(t)}}class C{index;amount;doubleExport;product;constructor(e=0,t=0,o="",n=!1){this.index=e,this.amount=t,this.product=o,this.doubleExport=n}}class S{static calculateImports(e){let t=[],o=this.resetUsage(e);for(let n=0;n+1<e.length;n++){const i=e[n],a=i.recipe?.resources,s=this.calculateProductionRate(i);a&&this.processRequiredItems(a,s,i,e,t,o)}const n=f.generateImportsTableRows(t);return $("#imports tbody").html(n),t.push(new s),{importsTableRows:t,indexes:o}}static resetUsage(e){const t=[];for(const o of e)if(o.productionImports=[],o.imports=[],o.Usage>0&&(t.push(e.indexOf(o)),o.Usage=0,o.exportPerMin=o.quantity),null!==o.extraCells&&o.extraCells.Usage>0){let n=e.indexOf(o);-1===n||t.includes(n)||t.push(n),o.extraCells.Usage=0,o.extraCells.ExportPerMin=o.extraCells.Quantity}return t}static calculateProductionRate(e){return e.recipe?.export_amount_per_min?e.quantity/e.recipe.export_amount_per_min:0}static processRequiredItems(e,t,o,n,i,a){for(const s of e){let e=s.importAmount*t/(o.recipeSetting?.useSomersloop?2:1);const l=n.filter((e=>e.product===s.name)),r=n.filter((e=>null!==e.extraCells&&e.extraCells.Product===s.name));let p=0,c=0;const{totalUsed:u,totalAvailable:d}=this.processProducedRows(l,e,c,p,n,a,o,s.name);c=u,p=d;const{totalUsed:h,totalAvailable:m}=this.processDoubleExportRows(r,e,c,p,n,a,o,s.name);c=h,p=m;const v=e-c;v>0&&this.addToImportsTable(i,s.itemId,v,o,s.name)}}static processProducedRows(e,t,o,n,i,a,s,l){for(const r of e){const e=r.quantity-r.Usage,p=Math.min(e,t-o);if(p<=0)continue;r.Usage+=+p.toFixed(5),r.exportPerMin=+(r.quantity-r.Usage).toFixed(5),o+=p,n+=e;const c=i.indexOf(r);s.productionImports.push(new C(c,p,l)),-1===c||a.includes(c)||a.push(c)}return{totalUsed:o,totalAvailable:n}}static processDoubleExportRows(e,t,o,n,i,a,s,l){for(const r of e){if(null===r.extraCells)continue;const e=r.extraCells.Quantity-r.extraCells.Usage,p=Math.min(e,t-o);if(p<=0)continue;r.extraCells.Usage+=+p.toFixed(5),r.extraCells.ExportPerMin=+(r.extraCells.Quantity-r.extraCells.Usage).toFixed(5),o+=p,n+=e;const c=i.indexOf(r);s.productionImports.push(new C(c,p,l,!0)),-1===c||a.includes(c)||a.push(c)}return{totalUsed:o,totalAvailable:n}}static addToImportsTable(e,t,o,n,i){const a=e.find((e=>e.itemId===t));(o=+o.toFixed(5))<=1e-4||(a?(a.quantity+=o,n.imports.push(new C(e.indexOf(a),o,i))):(e.push(new s(t,o,i)),n.imports.push(new C(e.length-1,o,i))))}}class k{autoImportExport=!0;autoPowerMachine=!0;autoSave=!1;constructor(){this.addEventListeners(),this.applyChanges()}applyChanges(){const e=parseInt($("#productionLineId").val()),t=document.getElementById("auto_import_export"),o=document.getElementById("auto_power_machine");t&&(this.autoImportExport=t.checked),o&&(this.autoPowerMachine=o.checked),l.saveSettings(e,this.autoImportExport,this.autoPowerMachine,this.autoSave)}addEventListeners(){const e=document.getElementById("auto_import_export"),t=document.getElementById("auto_power_machine");e&&e.addEventListener("change",(()=>{$("#auto_import_export").parent().parent().tooltip("hide"),this.applyChanges()})),t&&t.addEventListener("change",(()=>{$("#auto_power_machine").parent().parent().tooltip("hide"),this.applyChanges()}))}}class I{id;product;quantity;X;Y;constructor(e,t,o){this.id=e,this.product=t,this.quantity=o,this.X=0,this.Y=0}}class x{id;product;quantity;building;buildingId;buildingAmount;checklist;X;Y;constructor(e,t,o,n,i,a,s){this.id=e,this.product=t,this.quantity=o,this.building=n,this.buildingId=i,this.buildingAmount=a,this.checklist=s,this.X=0,this.Y=0}}class A{id;product;quantity;X;Y;constructor(e,t,o){this.id=e,this.product=t,this.quantity=o,this.X=0,this.Y=0}}class R{id;sourceId;targetId;quantity;product;constructor(e,t,o,n,i){this.id=e,this.sourceId=t,this.targetId=o,this.quantity=n,this.product=i}}let T;class P{TableHandler;importNodes=[];productionNodes=[];exportNodes=[];importConnections=[];productionConnections=[];exportConnections=[];layout="klay";showExport=!1;showImport=!0;showChecklist=!0;useRoots=!0;cy=null;constructor(e){this.TableHandler=e,this.getterData(),this.createVisualization(),this.addEventListeners()}update(){this.getterData(),this.createVisualization()}async createVisualization(){T||(await this.showLoadingScreen(),await this.loadCytoscapeExtensions());let e=[];this.showImport&&(e.push(...this.importNodes.map((e=>this.addNode("import",e)))),[].push(...this.importNodes.map((e=>`import_${e.id}`))),e.push(...this.importConnections.map((e=>this.addConnection("import",e,"import","production"))))),e.push(...this.productionNodes.map((e=>this.addNode("production",e)))),e.push(...this.productionConnections.map(((e,t)=>({...this.addConnection("production",e,"production","production"),data:{...this.addConnection("production",e,"production","production").data,id:`productionConnection_${t}`}})))),this.showExport&&(e.push(...this.exportNodes.map((e=>this.addNode("export",e)))),e.push(...this.exportConnections.map((e=>this.addConnection("export",e,"production","export")))));const t=T({container:document.getElementById("graph"),elements:e,style:[{selector:"node",style:{label:"data(label)","background-color":"data(color)","text-halign":"center","text-valign":"center",width:200,height:200,color:"black","font-size":25,"text-wrap":"wrap"}},{selector:"node.top-text",style:{"text-margin-y":-60}},{selector:"edge",style:{label:"data(label)","font-size":25,"text-background-color":"white","text-background-opacity":.5,"text-background-padding":"3px","text-background-shape":"roundrectangle",color:"black",width:5,"line-color":"data(color)","target-arrow-color":"#333","target-arrow-shape":"triangle","target-arrow-fill":"filled","curve-style":"bezier","control-point-step-size":40}}],layout:{name:"klay",animate:!0,spacingFactor:2,nodeDimensionsIncludeLabels:!0,avoidOverlap:!0}});t.ready((()=>{t.nodes().forEach((e=>{this.applyQTip(e,e.data("title")),e.on("drag",(()=>{e.qtip("api").visible&&e.qtip("api").hide()})),e.on("mouseout",(()=>{e.qtip("api").hide()}))})),t.edges().forEach((e=>{this.applyQTip(e,e.data("label"))})),t.center(),t.fit()})),this.cy=t}applyQTip(e,t){e.qtip({content:t,position:{my:"top center",at:"bottom center"},style:{classes:"qtip-bootstrap",tip:{width:16,height:8}},show:{event:"mouseover",delay:100},hide:{event:"mouseout"}})}updateNodeColors(){this.cy?this.cy.nodes().forEach((e=>{const t=e.data();if(t.id.startsWith("production")){const o=this.productionNodes.find((e=>`production_${e.id}`===t.id));if(!o)return;e.style("background-color",this.showChecklist?this.getColor(o.checklist):"green")}})):console.error("Cytoscape instance not found!")}getColor(e){return e?e.beenBuild&&e.beenTested?"#28A745":e.beenBuild?"#FFD700":"#A0A0A0":"#A0A0A0"}addNode(e,t){return{data:{id:`${e}_${t.id}`,label:`${t.product}\n${t.quantity}${t.building?`\n\n\n\n${t.building}\n${t.buildingAmount}`:""}`,color:"import"===e?"blue":"export"===e?"red":this.showChecklist?this.getColor(t.checklist):"green",title:`${e.charAt(0).toUpperCase()+e.slice(1)}: ${t.product}<br>Amount: ${t.quantity}${t.building?`<br><hr>Building: ${t.building}<br>Amount of building: ${t.buildingAmount}`:""}`},classes:"production"===e?"top-text":""}}addConnection(e,t,o,n){return{data:{id:`${e}Connection_${t.id}`,source:`${o}_${t.sourceId}`,target:`${n}_${t.targetId}`,label:`${t.product} ${t.quantity}`,color:"import"===e?"blue":"export"===e?"red":"green"}}}getterData(){this.importNodes=[],this.productionNodes=[],this.exportNodes=[],this.importConnections=[],this.productionConnections=[],this.exportConnections=[],this.getImportNodes(),this.getProduction(),this.getExportNodes(),this.getImportConnection()}addEventListeners(){$("#showChecklist").on("change",(e=>{const t=$(e.target);this.showChecklist=t.prop("checked"),this.updateNodeColors()})),$("#export").on("change",(e=>{const t=$(e.target);this.showExport=t.prop("checked"),this.createVisualization()})),$("#import").on("change",(e=>{const t=$(e.target);this.showImport=t.prop("checked"),this.createVisualization()})),$("#refresh").on("click",(()=>{this.createVisualization()})),$("#roots").on("change",(e=>{const t=$(e.target);this.useRoots=t.prop("checked"),this.createVisualization()}))}getImportConnection(){let e=0;for(let t=0;t<this.TableHandler.productionTableRows.length;t++){const o=this.TableHandler.productionTableRows[t];for(let n=0;n<o.imports.length;n++){const i=o.imports[n];this.importConnections.push(new R(e,i.index,t,+i.amount.toFixed(3),i.product)),e++}}}getProduction(){for(let e=0;e<this.TableHandler.productionTableRows.length;e++){const t=this.TableHandler.productionTableRows[e],o=t.recipe?.building,n=(t.quantity,t.recipe),i=this.TableHandler.checklist?.getChecklist().find((e=>e.productionRow.row_id==t.row_id));if(!n)continue;let a=y.calculateBuildingAmount(n,t).toFixed(5);o&&n&&this.productionNodes.push(new x(e,n.name,t.quantity,o.name,o.id,+a,i));for(let o=0;o<t.productionImports.length;o++){const n=t.productionImports[o];this.productionConnections.push(new R(e,n.index,e,+n.amount.toFixed(3),n.product))}}}getImportNodes(){for(let e=0;e<this.TableHandler.importsTableRows.length;e++){const t=this.TableHandler.importsTableRows[e];""!==t.product&&t.quantity>0&&this.importNodes.push(new I(e,t.product,t.quantity))}}getExportNodes(){let e=0;for(let t=0;t<this.TableHandler.productionTableRows.length;t++){const o=this.TableHandler.productionTableRows[t];o.exportPerMin>0&&(this.exportNodes.push(new A(e,o.product,o.exportPerMin)),this.exportConnections.push(new R(e,t,this.exportNodes.length-1,o.exportPerMin,o.product)),e++),o.extraCells?.ExportPerMin>0&&(this.exportNodes.push(new A(e,o.product,o.extraCells?.ExportPerMin)),this.exportConnections.push(new R(e,t,this.exportNodes.length-1,o.extraCells?.ExportPerMin,o.product)),e++)}}async loadCytoscapeExtensions(){const e=e=>{$("#loadingProgressGraph").css("width",e+"%")};e(10),T=(await a.e(165).then(a.bind(a,165))).default,e(40);const{default:t}=await a.e(889).then(a.t.bind(a,889,23));e(70);const{default:o}=await a.e(503).then(a.t.bind(a,503,23));e(90),T.use(t),T.use(o),e(100),await this.hideLoadingScreen()}async hideLoadingScreen(){return new Promise((e=>{const t=$("#loadingScreenGraph"),o=$("#graph");t.css("transition","opacity 0.5s"),t.css("opacity","0"),setTimeout((()=>{t.addClass("d-none"),o.removeClass("hidden-graph"),e()}),500)}))}async showLoadingScreen(){return new Promise((e=>{const t=$("#loadingScreenGraph"),o=$("#graph");$("#loadingProgressGraph").css("width","0%"),t.removeClass("d-none"),t.css("opacity","1"),o.addClass("hidden-graph"),e()}))}}class E{static prepareSaveData(e,t,o,n){return{productionTableRows:this.cloneWithoutCircularReferences(e),powerTableRows:t,importsTableRows:o,checklist:this.cloneWithoutCircularReferences(n?.getChecklist()||[])}}static cloneWithoutCircularReferences(e){return e.map((e=>JSON.parse(JSON.stringify(e,((e,t)=>{if("productionTableRow"!==e&&"tableHandler"!==e)return t})))))}static saveProductionLine(e,t,o=!0){try{const n=parseInt($("#productionLineId").val());return l.saveData(e,n).then((e=>{if(e.success){if(!o)return!0;this.showSuccessMessage("Data successfully saved.");const n=e.data.newAndOldIds;return n.length>0&&this.updateProductionIds(n,t),!0}return this.showErrorMessage("An error occurred while saving the data. Please try again."),!1})).catch((e=>(console.error("Error while saving data:",e),this.showErrorMessage("An error occurred while saving the data. Please try again."),!1)))}catch(e){return console.error("Error while saving data:",e),this.showErrorMessage("An error occurred while saving the data. Please try again."),Promise.resolve(!1)}}static showSuccessMessage(e){this.showMessage("saveSuccessAlert",e)}static showErrorMessage(e){this.showMessage("saveErrorAlert",e)}static showMessage(e,t){const o=document.getElementById(e);o&&(o.textContent=t,o.classList.add("d-none"),o.classList.remove("show"),o.offsetWidth,o.classList.remove("d-none"),o.classList.add("show"),setTimeout((()=>{o.classList.remove("show"),setTimeout((()=>{o.classList.add("d-none")}),150)}),5e3))}static updateProductionIds(e,t){e.forEach((e=>{const o=e.new,n=e.old;$(`#recipes input[type="hidden"][name="production_id[]"][value="${n}"]`).val(o);const i=t.productionTableRows.find((e=>e.row_id===n));i&&(i.row_id=o)}))}}class M{htmlElement=$("#Checklist");canvasBody=this.htmlElement.find(".offcanvas-body");tableHandler;checklist=[];constructor(e){this.tableHandler=e,this.CheckForExistingChecklist(),this.attachEvents()}CheckForExistingChecklist(){const e=this.htmlElement.find("#checkListData").text();e?(JSON.parse(e).forEach(((e,t)=>{const o=e.production_id,n=1===e.been_build,i=1===e.been_tested,a=this.tableHandler.productionTableRows.find((e=>e.row_id==o));a&&this.checklist.push({index:t,productionRow:a,beenBuild:n,beenTested:i})})),this.buildChecklist(),this.generateMissingChecklist()):this.createChecklist()}buildChecklist(){this.checklist.forEach(((e,t)=>{this.createChecklistCard(e.productionRow,t,e.beenBuild,e.beenTested)})),this.initCheckBoxes()}createChecklist(){this.checklist=[],$("#Checklist .offcanvas-body").empty(),this.tableHandler.productionTableRows.forEach(((e,t)=>{this.createChecklistCard(e,t),this.checklist.push({index:t,productionRow:e,beenBuild:!1,beenTested:!1})})),this.initCheckBoxes()}createChecklistCard(e,t,o=!1,n=!1){const i=e.quantity;if(!e.recipe)return;const a=e.recipe?.name||"Unknown",s=e.recipe?.building?.name||"Unknown",l=y.calculateBuildingAmount(e.recipe,e);i<=0||(this.canvasBody.append(f.createCard(t,a,i,l,o,n,s)),this.attachToggleEvents(this.canvasBody.find(".card").last()))}updateCheckList(e){const t=this.checklist.find((t=>t.productionRow.row_id==e.row_id));if(t){const o=t.productionRow;if(!o.recipe)return;const n=o.quantity,i=o.recipe?.name||"Unknown",a=o.recipe?.building?.name||"Unknown",s=y.calculateBuildingAmount(o.recipe,o),l=this.canvasBody.find(`#check-${t.index}`);0===l.length?this.createChecklistCard(e,t.index):$(l).replaceWith(f.createCard(t.index,i,n,s,!1,!1,a)),this.checklist[t.index]={index:t.index,productionRow:e,beenBuild:!1,beenTested:!1}}else this.createChecklistCard(e,this.checklist.length),this.checklist.push({index:this.checklist.length,productionRow:e,beenBuild:!1,beenTested:!1});this.initCheckBoxes()}attachEvents(){const e=$("#Checklist #searchChecklist"),t=$("#Checklist #resetSearchChecklist");e.on("input",(()=>{const t=e.val();this.searchChecklist(t)})),t.on("click",(()=>{e.val(""),this.clearSearch()}))}attachToggleEvents(e){const t=e.find("input[type='checkbox'][for='tested']"),o=e.find("input[type='checkbox'][for='build']");t.on("change",(e=>{const t=$(e.target).closest(".card").attr("id")?.replace("check-","");t&&(this.checklist[+t].beenTested=$(e.target).is(":checked"))})),o.on("change",(e=>{const t=$(e.target).closest(".card").attr("id")?.replace("check-","");t&&(this.checklist[+t].beenBuild=$(e.target).is(":checked"))}))}generateMissingChecklist(){this.tableHandler.productionTableRows.forEach(((e,t)=>{this.checklist.find((t=>t.productionRow.row_id==e.row_id))||(this.createChecklistCard(e,t),this.checklist.push({index:t,productionRow:e,beenBuild:!1,beenTested:!1}))}))}searchChecklist(e){e=e.toLowerCase();const t=$("#Checklist .offcanvas-body");t.find(".alert").remove();const o=t.find(".card");o.each(((t,o)=>{$(o).find(".recipeName").text().toLowerCase().includes(e)?$(o).show():$(o).hide()})),o.toArray().some((e=>$(e).is(":visible")))||t.append("<div class='alert alert-danger'>No results found</div>")}clearSearch(){$("#Checklist .offcanvas-body").find(".card").each(((e,t)=>{$(t).show()}))}getChecklist(){return this.checklist.filter((e=>0!=+e.productionRow.quantity&&e.productionRow.quantity))}setChecklist(e){e?(this.checklist=e,this.canvasBody.empty(),this.buildChecklist()):this.createChecklist()}initCheckBoxes(){this.canvasBody.find("input[type='checkbox']").each(((e,t)=>{$(t).bootstrapToggle()}))}removeChecklist(e){const t=this.canvasBody.find(`#check-${e}`);t.length>0&&t.remove(),this.checklist=this.checklist.filter((t=>t.index!==e)),this.checklist.forEach(((e,t)=>{e.index=t;const o=this.canvasBody.find(`#check-${e.index}`);o.length>0&&o.attr("id",`check-${t}`)})),console.log(this.checklist)}}class B{clockSpeed;useSomersloop;productionTableRow;tableHandler;htmlElement;contextMenu=null;constructor(e,t,o,n=100,i=!1){this.clockSpeed=n,this.useSomersloop=i,this.tableHandler=e,this.productionTableRow=t,this.htmlElement=o,this.addEventListeners()}addEventListeners(){this.htmlElement.find(".open-p-settings").on("click",(e=>{window.getSelection()?.toString()||(this.contextMenu?this.hideSettings():(this.checkIfAnyOpenAndClose(),e.preventDefault(),this.showSettings(e)))})),this.htmlElement.on("contextmenu",(e=>{window.getSelection()?.toString()||(e.preventDefault(),this.contextMenu?this.hideSettings():(this.checkIfAnyOpenAndClose(),this.showSettings(e)))})),$(window).on("resize",(()=>{this.contextMenu&&this.hideSettings()})),$(document).on("click",(e=>{$(e.target).closest(".context-menu").length||$(e.target).closest(".open-p-settings").length||(e.stopPropagation(),this.hideSettings())})),$(document).on("contextmenu",(e=>{$(e.target).closest("tr").length||$(e.target).closest(".context-menu").length||(e.stopPropagation(),this.hideSettings())}))}showSettings(e){const t=this.htmlElement,o=$('<div class="context-menu">');o.css("display","block"),o.css("top",(t?.offset()?.top??0)+(t?.height()??0)*(this.productionTableRow.doubleExport?2:1)+"px"),o.addClass("bg-body p-2 shadow rounded-bottom border border-primary"),o.css("left",t.offset()?.left+"px"),o.css("z-index","9999"),o.css("width",t.width()+"px"),o.css("height","auto"),o.css("position","absolute"),this.showOptions(o),o.appendTo("body"),this.contextMenu=o,this.initCheckBoxes()}showOptions(e){const t=$(`\n        <input type="number" class="form-control" id="maxClockSpeed" step="any" min="0" max="250"  value="${String(this.clockSpeed)}">\n    `),o=$(`\n        <input type="checkbox" class="form-check-input" id="useSomersloop" ${this.useSomersloop?"checked":""}>\n    `),n=$('<div class="context-menu-wrapper">'),i=$('<div class="form-group">').append('<label class="form-check-label me-2" for="useSomersloop">Clock Speed</label>');i.append(t);const a=$('<div class="form-group">');a.append('<label class="form-check-label me-2" for="useSomersloop">Use Somersloop</label>'),a.append(o),n.append(i,"<hr>",a),n.appendTo(e),"function"==typeof $.fn.bootstrapToggle&&o.attr({"data-toggle":"toggle","data-onstyle":"success","data-offstyle":"danger","data-onlabel":"Yes","data-offlabel":"No"}).bootstrapToggle(),this.tableHandler.productionTableRows.findIndex((e=>e.row_id===this.productionTableRow.row_id)),t.on("change",(()=>{this.updateSettings(),this.htmlElement.find("input[name='production_quantity[]'").trigger("change"),this.tableHandler.checklist?.updateCheckList(this.productionTableRow)})),o.on("change",(()=>{this.updateSettings(),this.htmlElement.find("input[name='production_quantity[]'").trigger("change"),this.tableHandler.checklist?.updateCheckList(this.productionTableRow)}))}updateSettings(){const e=$("#maxClockSpeed"),t=$("#useSomersloop");e.length>0&&(this.clockSpeed=this.validateClockSpeed(Number(e.val())),e.val(this.clockSpeed)),t.length>0&&(this.useSomersloop=t.is(":checked"))}validateClockSpeed(e){return e>250&&(e=250),e<0&&(e=0),e}hideSettings(){const e=this.contextMenu;e&&e.length>0&&(e.remove(),this.contextMenu=null)}initCheckBoxes(){this.contextMenu&&this.contextMenu.find('input[type="checkbox"]').each(((e,t)=>{$(t).bootstrapToggle()}))}checkIfAnyOpenAndClose(){const e=this.tableHandler.productionTableRows.filter((e=>null!==e.recipeSetting?.contextMenu));e.length>0&&e.forEach((e=>{e.recipeSetting?.hideSettings()}))}}class F{element;recipeIdElement;searchElement;selectItemsElement;selectItemsMenu;iconGroup;onResizeEvent;open=!1;showVisuals=!0;searchByMenuSettings={show:!1,searchByProducts:!0,searchByIngredients:!1};constructor(e){this.element=e,this.recipeIdElement=this.element.find(".recipe-id"),this.searchElement=this.element.find(".search-input"),this.selectItemsMenu=this.element.find(".select-items-menu"),this.selectItemsElement=this.selectItemsMenu.find(".select-items"),this.iconGroup=this.element.find(".icon-group"),this.showVisuals="true"===localStorage.getItem("showVisuals")||null===localStorage.getItem("showVisuals"),this.searchByMenuSettings=localStorage.getItem("searchByMenuSettings")?JSON.parse(localStorage.getItem("searchByMenuSettings")):this.searchByMenuSettings,this.handleEvents(),this.handleSearchInput({}),this.activateSelectedRecipe(this.recipeIdElement.val()),this.showHideVisuals(),this.showHideSearchByMenu()}handleEvents(){this.searchElement.on("focus",(e=>{this.handeFocus(e),this.updateSearchByMenuSettings()})),$("body").on("mouseup",(e=>{this.handleBlur(e)})),this.selectItemsElement.on("click",".select-item",(e=>{this.handleSelectItemClick(e)})),this.searchElement.on("input",(e=>{this.handleSearchInput(e)})),this.iconGroup.on("click",(e=>{const t=$(e.target).closest(".search-by-menu-button");"showHideRecipesVisuals"===t.attr("name")&&(this.showVisuals=!this.showVisuals,localStorage.setItem("showVisuals",this.showVisuals.toString()),this.showHideVisuals()),"searchByMenu"===t.attr("name")&&(this.searchByMenuSettings.show=!this.searchByMenuSettings.show,localStorage.setItem("searchByMenuSettings",JSON.stringify(this.searchByMenuSettings)),this.showHideSearchByMenu())})),this.selectItemsMenu.on("click",".search-by-products",(e=>{this.searchByMenuSettings.searchByProducts=!this.searchByMenuSettings.searchByProducts,localStorage.setItem("searchByMenuSettings",JSON.stringify(this.searchByMenuSettings)),$(e.currentTarget).toggleClass("active",this.searchByMenuSettings.searchByProducts),this.handleSearchInput({})})),this.selectItemsMenu.on("click",".search-by-ingredients",(e=>{this.searchByMenuSettings.searchByIngredients=!this.searchByMenuSettings.searchByIngredients,localStorage.setItem("searchByMenuSettings",JSON.stringify(this.searchByMenuSettings)),$(e.currentTarget).toggleClass("active",this.searchByMenuSettings.searchByIngredients),this.handleSearchInput({})}))}updateSearchByMenuSettings(){this.searchByMenuSettings=localStorage.getItem("searchByMenuSettings")?JSON.parse(localStorage.getItem("searchByMenuSettings")):this.searchByMenuSettings,this.selectItemsMenu.find(".search-by-products").first().prop("checked",this.searchByMenuSettings.searchByProducts),this.selectItemsMenu.find(".search-by-ingredients").first().prop("checked",this.searchByMenuSettings.searchByIngredients)}showHideSearchByMenu(){this.searchByMenuSettings.show=!!localStorage.getItem("searchByMenuSettings")&&JSON.parse(localStorage.getItem("searchByMenuSettings")).show,this.searchByMenuSettings.show?this.selectItemsMenu.find(".search-by-menu").addClass("show"):this.selectItemsMenu.find(".search-by-menu").removeClass("show")}showHideVisuals(){this.showVisuals="true"===localStorage.getItem("showVisuals")||null===localStorage.getItem("showVisuals"),this.showVisuals?(this.selectItemsMenu.removeClass("hide-visuals"),this.iconGroup.find('.search-by-menu-button[name="showHideRecipesVisuals"] i').removeClass("fa-eye").addClass("fa-eye-slash")):(this.selectItemsMenu.addClass("hide-visuals"),this.iconGroup.find('.search-by-menu-button[name="showHideRecipesVisuals"] i').removeClass("fa-eye-slash").addClass("fa-eye")),this.moveIcons()}positionSelectItems(){this.selectItemsMenu.detach().appendTo("body"),this.selectItemsMenu.addClass("show"),this.searchElement.trigger("select");const e=$(window).innerHeight()||0,t=this.searchElement.offset()||{top:0,left:0},o=this.searchElement.outerHeight()||0,n=this.searchElement.outerWidth()||0,i=this.selectItemsMenu.outerHeight()||0;t.top+o+i>e?this.selectItemsMenu.css({bottom:e-t.top,top:"auto",left:t.left,width:n}):this.selectItemsMenu.css({top:t.top+o,bottom:"auto",left:t.left,width:n})}handeFocus(e){this.open||(this.selectItemsElement.scrollTop(0),this.selectItemsElement.trigger("scroll"),this.selectItemsMenu.detach().appendTo("body"),this.selectItemsMenu.addClass("show"),this.positionSelectItems(),this.onResizeEvent=$(window).on("resize",(()=>{this.positionSelectItems()})),this.open=!0,this.checkForScrollbar(),this.handleSearchInput({}))}handleBlur(e){($(e.target).closest(this.selectItemsElement).length>0||$(e.target).closest(this.searchElement).length>0||$(e.target).closest(this.selectItemsMenu).length>0)&&0===e.button||(this.hideSelectItems(),this.open=!1)}hideSelectItems(){this.selectItemsMenu.removeClass("show"),this.selectItemsMenu.detach().appendTo(this.element),this.onResizeEvent&&this.onResizeEvent.off("resize"),this.selectItemsMenu.css({top:"",left:"",width:""}),this.open=!1}handleSelectItemClick(e){const t=$(e.currentTarget);if(t.hasClass("select-item")&&t.attr("data-recipe-id")){const e=t.data("recipe-id"),o=t.data("recipe-name");e&&(this.hideSelectItems(),this.recipeIdElement.val(e),this.searchElement.val(o),this.handleSearchInput({}),this.recipeIdElement.trigger("change"),t.closest(".select-item").addClass("active").siblings().removeClass("active"))}}handleSearchInput(e){this.searchByMenuSettings=localStorage.getItem("searchByMenuSettings")?JSON.parse(localStorage.getItem("searchByMenuSettings")):this.searchByMenuSettings;const t=this.searchElement.val();let o=this.selectItemsElement.find(".select-item");const n=[],i=o.toArray().sort(((e,t)=>{const o=$(e).find(".recipe-name").text().toLowerCase(),n=$(t).find(".recipe-name").text().toLowerCase();return o.localeCompare(n)}));this.selectItemsElement.append(i),o=this.selectItemsElement.find(".select-item"),o.each(((e,o)=>{const i=$(o),a=i.find(".recipe-product").map(((e,t)=>$(t).data("product-name"))).get(),s=i.find(".recipe-ingredient").map(((e,t)=>$(t).data("ingredient-name"))).get(),l=i.find(".recipe-name").text().toLowerCase(),r=this.searchByMenuSettings.searchByProducts&&a.length>0,p=this.searchByMenuSettings.searchByIngredients&&s.length>0,c=t.toLowerCase(),u=l.includes(c)||r&&a.some((e=>e.toLowerCase().includes(c)))||p&&s.some((e=>e.toLowerCase().includes(c)));t.toLowerCase()===l?n.push({element:i,weight:2}):r&&a.some((e=>e.toLowerCase()===t.toLowerCase()))&&n.push({element:i,weight:1}),p&&s.some((e=>e.toLowerCase()===t.toLowerCase()))&&n.push({element:i,weight:1}),u?i.show():i.hide()})),n.length>0&&(n.sort(((e,t)=>e.weight!==t.weight?e.weight-t.weight:t.element.text().localeCompare(e.element.text()))),n.forEach((e=>{e.element.detach().prependTo(this.selectItemsElement)}))),0===o.filter(((e,t)=>"none"!==$(t).css("display"))).length?0===this.selectItemsElement.find(".no-results").length&&this.selectItemsElement.append('<div class="no-results text-muted text-center p-2">No results found</div>'):this.selectItemsElement.find(".no-results").remove(),this.checkForScrollbar()}activateSelectedRecipe(e){const t=this.selectItemsElement.find(`.select-item[data-recipe-id="${e}"]`);t.length>0&&t.addClass("active").siblings().removeClass("active")}checkForScrollbar(){this.selectItemsMenu.removeClass("has-scrollbar");const e=this.selectItemsElement.outerHeight()||0;(this.selectItemsElement[0].scrollHeight||0)>e&&this.selectItemsMenu.addClass("has-scrollbar"),this.showHideVisuals(),this.showHideSearchByMenu()}moveIcons(){const e=this.selectItemsElement.outerHeight()||0,t=this.selectItemsMenu.find(".icon-group");e>50?t.addClass(["flex-column"]):t.removeClass(["flex-column"])}}class _{static applyMathCalculation(e,t){if(!/^[0-9+\-*/().\s]*$/.test(e))return t;try{const o=Function(`"use strict"; return (${e})`)();return isNaN(o)?t:o.toString()}catch(e){return t}}}class L{static async importData(e){if(!this.checkIfFileIsSelected()||!this.checkIfFileIsJson())return;const t=$("#importFile").prop("files")[0],o=new FileReader;o.readAsText(t),o.onload=t=>{const o=JSON.parse(t.target?.result);o.productionTable&&o.powerTable&&o.importTable?(e.saveData(o.productionTable,o.powerTable,o.importTable,o.checklist||[]),this.showSuccessMessage("Data successfully imported."),$("#importFile").val("")):this.showErrorMessage("The selected file does not contain the required data.")},o.onerror=()=>{this.showErrorMessage("An error occurred while reading the file. Please try again.")}}static exportData(e){const t=e.productionTableRows,o=e.importsTableRows,n=e.powerTableRows,i=e.checklist?.getChecklist()||[];t.forEach((e=>{const t=i.find((t=>t.productionRow.row_id===e.row_id));e.row_id=m(),t&&(t.productionRow=e)}));const a={productionTable:E.cloneWithoutCircularReferences(t),powerTable:n,importTable:o,checklist:E.cloneWithoutCircularReferences(i)},s=(new TextEncoder).encode(JSON.stringify(a)),l=new Blob([s],{type:"application/json"}),r=URL.createObjectURL(l),p=document.createElement("a");p.href=r,p.download=this.generateFileName(),p.click(),URL.revokeObjectURL(r),this.showSuccessMessage("Data successfully exported.")}static checkIfFileIsSelected(){const e=document.getElementById("importFile");if(!e.files?.length){e.classList.add("is-invalid");const t=e.nextElementSibling;return t&&t.classList.add("d-block"),!1}e.classList.remove("is-invalid");const t=e.nextElementSibling;return t&&t.classList.remove("d-block"),!0}static checkIfFileIsJson(){const e=document.getElementById("importFile"),t=e.files?.[0];if(t&&"application/json"!==t.type){e.classList.add("is-invalid");const t=e.nextElementSibling;return t&&(t.textContent="Please select a valid JSON file.",t.classList.add("d-block")),!1}return!0}static showMessage(e,t){const o=document.getElementById(e);o&&(o.textContent=t,o.classList.add("d-none"),o.classList.remove("show"),o.offsetWidth,o.classList.remove("d-none"),o.classList.add("show"),setTimeout((()=>{o.classList.remove("show"),setTimeout((()=>{o.classList.add("d-none")}),150)}),5e3))}static showSuccessMessage(e,t=1){1!==t||this.showMessage("successAlert",e)}static showErrorMessage(e,t=1){1!==t||this.showMessage("errorAlert",e)}static generateFileName(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone,t=(new Date).toLocaleString("en-GB",{timeZone:e}).replace(/[\/\s,:]/g,"_");let o=$("#productionLineName").text().replace("Production Line - ","");return o=o.replace(/\s/g,"_"),`${o}_data_${t}.json`}}const O=new class{importsTableRows=[];productionTableRows=[];powerTableRows=[];settings=new k;checklist=null;visualisation=null;updated=!1;viewOnly="1"===$("#viewOnly").val();cacheVersion=$("#dataVersion").val();buildingCache=[];recipeCache=[];progressBar=$("#loading-progress");progressInterval=0;totalRows=0;finishedRows=0;recipeSettings=[];constructor(){this.initialize()}async initialize(){this.CheckCacheVersion();let e=500;(0===window.performance.getEntriesByType("navigation").length||window.performance.getEntriesByType("navigation").map((e=>e.type)).includes("reload"))&&(e=0),this.loadFromLocal(),await this.getTableData(),this.addEventListeners(),this.addButtonEventListeners(),this.addShortcuts(),setTimeout((()=>{this.hideLoading(),this.enableButtons(),this.viewOnly&&(this.disableButtons(),this.disableInputs())}),e),this.viewOnly||(this.checklist=new M(this))}async getTableData(){this.totalRows=$("#recipes tbody tr").length,this.progressInterval=100/this.totalRows,this.recipeSettings=JSON.parse($("#settings-data").text()??{}),this.productionTableRows=await this.readTable("recipes",v,!0),await this.readTable("imports",s).then((e=>{this.importsTableRows=e})).catch((e=>{console.error("Failed to load imports table rows:",e)})),this.readTable("power",g).then((e=>{this.powerTableRows=e,this.saveToLocal(),$(document).ready((()=>{this.showCacheAmount()}))})).catch((e=>{console.error("Failed to load power table rows:",e)}))}async readTable(e,t,o=!1){const n=$(`#${e} tbody tr`);let i=0;"power"===e&&(i=1);const a=[];for(let s=0;s<n.length-i;s++){const i=n[s],l=$(i).find("input, select, .recipe-select"),p=[];if(l.each(((e,t)=>{const o=$(t);o.hasClass("recipe-select")?new F(o):!0!==o.data("sp-skip")&&("number"===o.attr("type")?p.push(Number(o.val())):p.push(o.val()))})),"recipes"===e&&n[s+1]?.classList.contains("extra-output")){const e=n[s+1],t=$(e).find("input, select").map(((e,t)=>$(t).val())).get(),o=new r(t[0],Number(t[1]),Number(t[2]));p.push(!0,o),s++,this.finishedRows++}else"recipes"===e&&p.push(!1,null);"recipes"===e&&p.push(this.recipeCache),"power"===e&&(p.push(null),p.push(this.buildingCache));const c=t.create(...p).then((e=>(o&&this.updateProgress(),e)));if(a.push(c),"recipes"===e){const e=this.recipeSettings.find((e=>e.id===+p[0]));c.then((t=>{t.recipeSetting=new B(this,t,$(i),e?.clockSpeed||100,e?.useSomersloop||!1)}))}}return await Promise.all(a)}saveToLocal(){localStorage.setItem("cachedData",JSON.stringify({Version:this.cacheVersion,Recipe:this.recipeCache,Building:this.buildingCache}))}showCacheAmount(){$("#cachedRecipes").html(this.recipeCache.length.toString()),$("#cachedBuildings").html(this.buildingCache.length.toString())}emptyLocal(){localStorage.removeItem("cachedData")}loadFromLocal(){const e=JSON.parse(localStorage.getItem("cachedData")||"{}");this.recipeCache=e.Recipe||[],this.buildingCache=e.Building||[],$("#cachedRecipes").html(this.recipeCache.length.toString()),$("#cachedBuildings").html(this.buildingCache.length.toString())}CheckCacheVersion(){JSON.parse(localStorage.getItem("cachedData")||"{}").Version!==this.cacheVersion.toString()&&(this.emptyLocal(),this.loadFromLocal())}hideLoading(){$("#loading").addClass("d-none"),$("#main-content").removeClass("d-none")}showLoading(e=!0){this.progressBar.parent().removeClass("d-none"),$("#loading").removeClass("d-none"),$("#main-content").addClass("d-none"),e||this.progressBar.parent().addClass("d-none")}updateProgress(){this.finishedRows++;const e=Math.round(this.finishedRows*this.progressInterval);this.progressBar.css("width",`${e}%`),this.progressBar.attr("aria-valuenow",e),this.progressBar.html(`${e}%`)}async addEventListeners(){this.viewOnly||["imports","recipes","power"].forEach((e=>{const t=$(`#${e} tbody`),o=t.find('input:not([data-sp-skip="true"]), select:not([data-sp-skip="true"])');t.find(".delete-production-row").each(((t,o)=>{$(o).on("click",(t=>{t.preventDefault();const o=$(t.target),n=o.closest("tr").index(),i=o.closest("tr").prevAll(".extra-output").length;this.deleteRow(e,n-i,o)}))})),o.each(((t,o)=>{$(o).on("change",(t=>{this.handleInputChange(t,e)}))}))}))}async addEventListenersRow(e,t){e.find('input:not([data-sp-skip="true"]), select:not([data-sp-skip="true"])').each(((e,o)=>{$(o).on("change",(e=>{this.handleInputChange(e,t)}))})),e.find(".delete-production-row").on("click",(e=>{e.preventDefault();const o=$(e.target),n=o.closest("tr").index(),i=o.closest("tr").prevAll(".extra-output").length;this.deleteRow(t,n-i,o)}))}addSpecificEventListener(e){$(`#${e} tbody`).find('input:not([data-sp-skip="true"]), select:not([data-sp-skip="true"])').each(((t,o)=>{$(o).on("change",(t=>{this.handleInputChange(t,e)}))}))}async handleInputChange(e,t){const o=$(e.target),n=o.closest("tr").index(),i=o.closest("tr").prevAll(".extra-output").length,a=o.closest("td").index();let s=o.val();this.checkIfLastRow(o,t)&&this.checkIfSelect(o)&&this.addNewRow(t);const l=this.getRowByTableIdAndIndex(t,n-i);if(o.hasClass("production-quantity")){const e=l.quantity;s=_.applyMathCalculation(s,e),o.val(s)}if(l&&a>=0)switch(this.updateRowData(l,a,s),t){case"imports":default:break;case"recipes":await this.HandleProductionTable(l,n,s,t,o),this.checklist?.updateCheckList(l);break;case"power":await this.HandlePowerTable(l,n,s,t,o)}}getRowByTableIdAndIndex(e,t){switch(e){case"imports":return this.importsTableRows[t];case"recipes":return this.productionTableRows[t];case"power":return this.powerTableRows[t];default:return null}}updateRowData(e,t,o){e[Object.keys(e)[t]]=o}updateRowInTable(e,t,o){const n=$(`#${e} tbody tr`);let i=$(n[t]);i.find('input:not([data-sp-skip="true"]), select:not([data-sp-skip="true"])').each(((e,t)=>{const n=Object.keys(o)[e];let i;i=o.recipe&&o.recipe.hasOwnProperty(n)?o.recipe[n]:o[n],$(t).val(i)})),"recipes"===e&&p.handleDoubleExport(o,i)}addNewRow(e){let t;t="power"===e?$(`#${e} tbody tr:nth-last-child(2)`):$(`#${e} tbody tr:last`);const o=t.clone();switch(o.find('input[type="number"]').val(0),o.find('input[type="text"]').val(""),o.find('input[name="power_clock_speed[]"]').val(100),o.find("select").prop("selectedIndex",0),o.insertAfter(t),this.addEventListenersRow(o,e),e){case"imports":this.importsTableRows.push(new s);break;case"recipes":const e=new v;e.recipeSetting=new B(this,e,o),this.productionTableRows.push(e),new F(o.find(".recipe-select"));break;case"power":this.powerTableRows.push(new g)}}checkIfLastRow(e,t){return"power"===t?e.closest("tr").is(":nth-last-child(2)"):e.closest("tr").is(":last-child")}checkIfSelect(e){return!!e.is("select")||e.parent().hasClass("recipe-select")}UpdateOnIndex(e){for(let t=0;t<e.length;t++){const o=e[t],n=(this.productionTableRows[o],this.productionTableRows.slice(0,o).filter((e=>e.doubleExport)).length),i=this.productionTableRows[o];this.updateRowInTable("recipes",o+n,i)}}async HandlePowerTable(e,t,o,n,i){this.checkIfSelect(i)?await y.updateBuilding(e,o):e.Consumption=y.calculateSingleConsumption(e),this.updateRowInTable(n,t,e),y.updateTotalConsumption(this.powerTableRows)}showVisualization(){if(this.settings.autoImportExport){const e=S.calculateImports(this.productionTableRows);this.viewOnly&&this.disableInputs(),this.importsTableRows=e.importsTableRows}this.visualisation?this.updated?(this.updated=!1,this.visualisation.update()):this.visualisation.updateNodeColors():(this.updated=!1,this.visualisation=new P(this)),$("#showVisualization").modal("show")}saveData(e,t,o,n=null){this.productionTableRows=(e.pop(),e),this.powerTableRows=(t.pop(),t),this.importsTableRows=(o.pop(),o),this.checklist?.setChecklist(n),this.generateTables(),this.powerTableRows.push(new g),this.productionTableRows.push(new v),this.importsTableRows.push(new s),E.saveProductionLine(E.prepareSaveData(this.productionTableRows,this.powerTableRows,this.importsTableRows,this.checklist),this)}generateTables(){$("#power tbody").html(f.generatePowerTable(this.powerTableRows,w,y.calculateTotalConsumption(this.powerTableRows))),$("#imports tbody").html(f.generateImportsTableRows(this.importsTableRows)),$("#recipes tbody").html(f.generateProductionTableRows(this.productionTableRows)),this.addEventListeners()}disableButtons(){$("#save_button").addClass("disabled"),$("#save_button").prop("disabled",!0),$("#edit_product_line").addClass("disabled"),$("#edit_product_line").prop("disabled",!0),$("#showCheckList").addClass("disabled"),$("#showCheckList").prop("disabled",!0)}disableInputs(){$(".px-3.px-lg-5").find("input, select, .delete-production-row").each(((e,t)=>{const o=$(t);o.prop("disabled",!0),o.addClass("disabled")}))}enableButtons(){$("#save_button").removeClass("disabled"),$("#save_button").prop("disabled",!1),$("#showPower").removeClass("disabled"),$("#showPower").prop("disabled",!1),$("#showVisualizationButton").removeClass("disabled"),$("#showVisualizationButton").prop("disabled",!1),$("#edit_product_line").removeClass("disabled"),$("#edit_product_line").prop("disabled",!1),$("#showCheckList").removeClass("disabled"),$("#showCheckList").prop("disabled",!1)}async HandleProductionTable(e,t,o,n,i){if(this.updated=!0,await p.calculateProductionExport(e),this.checkIfSelect(i)&&await p.updateRecipe(e,o),this.updateRowInTable(n,t,e),this.settings.autoImportExport){const e=S.calculateImports(this.productionTableRows);this.importsTableRows=e.importsTableRows,this.UpdateOnIndex(e.indexes)}this.settings.autoPowerMachine&&(this.powerTableRows=y.calculateBuildings(this.productionTableRows,this.powerTableRows),this.addSpecificEventListener("power"))}async addShortcuts(){const e=this;document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("keydown",(t=>{const o=$("#showPowerModal"),n=$("#editProductionLine"),i=$("#helpModal"),a=$("#showVisualization");function s(){o.modal("hide"),n.modal("hide"),i.modal("hide"),a.modal("hide")}if(t.ctrlKey&&"s"===t.key){if(e.viewOnly)return;t.preventDefault(),E.saveProductionLine(E.prepareSaveData(e.productionTableRows,e.powerTableRows,e.importsTableRows,e.checklist),e)}if(t.ctrlKey&&"p"===t.key&&(t.preventDefault(),o.is(":hidden")?(s(),o.modal("show")):o.modal("hide")),t.ctrlKey&&"e"===t.key){if(e.viewOnly)return;t.preventDefault(),s(),n.is(":hidden")?(s(),n.modal("show")):n.modal("hide")}if(t.ctrlKey&&"h"===t.key&&(t.preventDefault(),i.is(":hidden")?(s(),i.find("#welcome").hide(),i.modal("show")):i.modal("hide")),t.ctrlKey&&"q"===t.key&&(t.preventDefault(),window.history.back()),"v"===t.key&&t.ctrlKey){if(["INPUT","SELECT","TEXTAREA","BUTTON"].includes(t.target.tagName))return;t.preventDefault(),a.is(":hidden")?(s(),e.showVisualization()):a.modal("hide")}}))}))}async addButtonEventListeners(){$("#showVisualizationButton").on("click",(()=>{this.showVisualization()})),$("#removeCache").on("click",(()=>{this.emptyLocal(),this.loadFromLocal(),this.showCacheAmount()}))}deleteRow(e,t,o){if(this.checkIfLastRow(o,e))return;switch(e){case"imports":this.importsTableRows.splice(t,1);break;case"recipes":this.productionTableRows.splice(t,1),this.checklist?.removeChecklist(t);break;case"power":this.powerTableRows.splice(t,1)}this.updated=!0;const n=o.closest("tr");if(n.next().hasClass("extra-output")&&n.next().remove(),n.remove(),"recipes"===e){if(this.settings.autoImportExport){const e=S.calculateImports(this.productionTableRows);this.importsTableRows=e.importsTableRows,this.UpdateOnIndex(e.indexes)}this.settings.autoPowerMachine&&(this.powerTableRows=y.calculateBuildings(this.productionTableRows,this.powerTableRows),this.addSpecificEventListener("power"))}console.log(this.productionTableRows)}},N=$("#save_button");return N.on("click",(e=>{e.shiftKey?(e.preventDefault(),E.saveProductionLine(E.prepareSaveData(O.productionTableRows,O.powerTableRows,O.importsTableRows,O.checklist),O),N.tooltip("hide"),N.blur()):(e.preventDefault(),O.showLoading(!1),E.saveProductionLine(E.prepareSaveData(O.productionTableRows,O.powerTableRows,O.importsTableRows,O.checklist),O,!1).then((e=>{e?window.location.href="/game_save/"+encodeURIComponent($("#gameSaveId").val()):O.hideLoading()})))})),$(document).on("DOMContentLoaded",(()=>{const e=$("#exportButton"),t=$("#importButton");e.on("click",(()=>{L.exportData(O)})),t.on("click",(e=>{e.preventDefault(),L.importData(O)}))})),{}})()));