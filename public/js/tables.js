!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.tables=e():t.tables=e()}(this,(()=>(()=>{"use strict";var t,e,o,n={},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var o=i[t]={exports:{}};return n[t].call(o.exports,o,o.exports,a),o.exports}a.m=n,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,a.t=function(o,n){if(1&n&&(o=this(o)),8&n)return o;if("object"==typeof o&&o){if(4&n&&o.__esModule)return o;if(16&n&&"function"==typeof o.then)return o}var i=Object.create(null);a.r(i);var l={};t=t||[null,e({}),e([]),e(e)];for(var s=2&n&&o;"object"==typeof s&&!~t.indexOf(s);s=e(s))Object.getOwnPropertyNames(s).forEach((t=>l[t]=()=>o[t]));return l.default=()=>o,a.d(i,l),i},a.d=(t,e)=>{for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((e,o)=>(a.f[o](t,e),e)),[])),a.u=t=>t+".chunk.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o={},a.l=(t,e,n,i)=>{if(o[t])o[t].push(e);else{var l,s;if(void 0!==n)for(var r=document.getElementsByTagName("script"),p=0;p<r.length;p++){var u=r[p];if(u.getAttribute("src")==t){l=u;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.src=t),o[t]=[e];var c=(e,n)=>{l.onerror=l.onload=null,clearTimeout(d);var i=o[t];if(delete o[t],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach((t=>t(n))),e)return e(n)},d=setTimeout(c.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=c.bind(null,l.onerror),l.onload=c.bind(null,l.onload),s&&document.head.appendChild(l)}},a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var o=e.getElementsByTagName("script");if(o.length)for(var n=o.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=o[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t})(),(()=>{var t={796:0};a.f.j=(e,o)=>{var n=a.o(t,e)?t[e]:void 0;if(0!==n)if(n)o.push(n[2]);else{var i=new Promise(((o,i)=>n=t[e]=[o,i]));o.push(n[2]=i);var l=a.p+a.u(e),s=new Error;a.l(l,(o=>{if(a.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var i=o&&("load"===o.type?"missing":o.type),l=o&&o.target&&o.target.src;s.message="Loading chunk "+e+" failed.\n("+i+": "+l+")",s.name="ChunkLoadError",s.type=i,s.request=l,n[1](s)}}),"chunk-"+e,e)}};var e=(e,o)=>{var n,i,[l,s,r]=o,p=0;if(l.some((e=>0!==t[e]))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);r&&r(a)}for(e&&e(o);p<l.length;p++)i=l[p],a.o(t,i)&&t[i]&&t[i][0](),t[i]=0},o=this.webpackChunk=this.webpackChunk||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})();class l{itemId;quantity;product;constructor(t=0,e=0,o=""){this.itemId=t,this.quantity=e,this.product=o}static async create(t=0,e=0,o=""){return new l(t,e,o)}}class s{static gameSaveId=Number($("#gameSaveId").val())??0;static url=new URL(window.location.href);static productionLineId=parseInt(this.url.searchParams.get("id"));static getRecipe(t){return new Promise((function(e,o){$.ajax({type:"GET",url:"getRecipe",data:{id:t},headers:{"X-CSRF-Token":s._getCsrfToken()},dataType:"json",success:function(t){try{e(t)}catch(t){o(t)}},error:function(t,e,n){o(n)}})}))}static getBuilding(t){return new Promise((function(e,o){$.ajax({type:"GET",url:"getBuilding",data:{id:t},headers:{"X-CSRF-Token":s._getCsrfToken()},dataType:"json",success:function(t){try{e(t)}catch(t){o(t)}},error:function(t,e,n){o(n)}})}))}static async saveData(t,e){return new Promise(((o,n)=>{$.ajax({type:"POST",url:"saveProductionLine",data:{gameSaveId:this.gameSaveId,data:JSON.stringify(t),id:e},headers:{"X-CSRF-Token":s._getCsrfToken()},success:function(t){o(JSON.parse(t))},error:function(t,e,o){n(o)}})}))}static saveSettings(t,e,o,n){$.ajax({type:"POST",url:"updateProductionLineSettings",headers:{"X-CSRF-Token":s._getCsrfToken()},data:{gameSaveId:this.gameSaveId,productionLineId:t,autoImportExport:e,autoPowerMachine:o,autoSave:n}})}static _getCsrfToken(){const t=$('meta[name="csrf-token"]');if(0===t.length||void 0===t.attr("content"))throw new Error("CSRF token not found");return t.attr("content")}}class r{Product;Usage;ExportPerMin;Quantity;constructor(t="",e=0,o=0,n=0){this.Product=t,this.Usage=e,this.ExportPerMin=o,this.Quantity=n}}class p{static async calculateProductionExport(t){if(t.exportPerMin=t.quantity-t.Usage,t.doubleExport&&null!==t.recipe){const e=this.calculateSecondExportPerMin(t);void 0!==e&&(t.extraCells.Quantity=e,t.extraCells.ExportPerMin=e)}}static async updateRecipe(t,e){await this.saveRecipe(e,t);const o=t.recipe;if(null!==o&&(t.recipeId=o.id,t.product=o.itemName,t.doubleExport=null!==o.secondItemName,t.doubleExport)){const e=+o.export_amount_per_min,n=+o.export_amount_per_min2/e,i=t.quantity;t.extraCells=new r(o.secondItemName,0,i*n)}}static async saveRecipe(t,e){e.recipe=await s.getRecipe(+t)}static handleDoubleExport(t,e){if(t.doubleExport&&null!==t.extraCells)if(e.next(".extra-output").length){const o=e.next(".extra-output"),n=o.find('input[name="production_usage2[]"]'),i=o.find('input[name="production_export2[]"]');n.val(t.extraCells.Usage),i.val(t.extraCells.ExportPerMin)}else e.find("td:nth-child(2)").attr("rowspan",2),e.find("td:nth-child(3)").attr("rowspan",2),e.find("td:nth-child(2) select").css("height","78px"),e.find("td:nth-child(3) input").css("height","78px"),$(`\n                    <tr class="extra-output">\n                        <td class="m-0 p-0">\n                            <input type="text" name="product" value="${t.extraCells.Product}" class="form-control rounded-0" readonly>\n                        </td>\n                        <td class="m-0 p-0">\n                            <input type="number" name="production_usage2[]" value="${t.extraCells.Usage}" class="form-control rounded-0" readonly step="any">\n                        </td>\n                        <td class="m-0 p-0">\n                            <input type="number" name="production_export2[]" value="${t.extraCells.ExportPerMin}" class="form-control rounded-0" readonly step="any">\n                        </td>\n                    </tr>\n                `).insertAfter(e);else e.next(".extra-output").length&&(e.next(".extra-output").remove(),e.find("td:nth-child(2)").removeAttr("rowspan"),e.find("td:nth-child(3)").removeAttr("rowspan"),e.find("td:nth-child(2) select").css("height",""),e.find("td:nth-child(3) input").css("height",""))}static calculateSecondExportPerMin(t){if(null===t.recipe)return;const e=t.recipe.export_amount_per_min2,o=t.recipe.export_amount_per_min;if(null===e||null===o)return;const n=e/o;return t.quantity*n}}const u={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let c;const d=new Uint8Array(16),h=[];for(let t=0;t<256;++t)h.push((t+256).toString(16).slice(1));const m=function(t,e,o){if(u.randomUUID&&!e&&!t)return u.randomUUID();const n=(t=t||{}).random??t.rng?.()??function(){if(!c){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");c=crypto.getRandomValues.bind(crypto)}return c(d)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){if((o=o||0)<0||o+16>e.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[o+t]=n[t];return e}return function(t,e=0){return(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase()}(n)};class v{row_id;recipeId;quantity;product;Usage;exportPerMin;doubleExport;extraCells;recipe;imports;productionImports;recipeSetting=null;constructor(t=m(),e="",o=0,n="",i=0,a=0,l=!1,s=null){this.row_id=t,this.recipeId=+e,this.quantity=o,this.product=n,this.Usage=i,this.exportPerMin=a,this.doubleExport=l,this.extraCells=s,this.recipe=null,this.imports=[],this.productionImports=[]}static async create(t=0,e="",o=0,n="",i=0,a=0,l=!1,r=null,u=[]){const c=new v(t,e,o,n,i,a,l,r);return null==c.recipe&&(c.recipe=u.find((t=>t.id===+e))||null,null==c.recipe&&e&&(c.recipe=await s.getRecipe(+e),c.recipe&&!u.find((t=>t.id===c.recipe?.id))&&u.push(c.recipe))),null!==c.extraCells&&(c.extraCells.Quantity=p.calculateSecondExportPerMin(c)),c}async getRecipe(t){this.recipe=await s.getRecipe(+t)}saveDoubleExportQuantity(){this.doubleExport&&null!==this.extraCells&&(this.extraCells.Quantity=p.calculateSecondExportPerMin(this))}}class g{buildingId;quantity;clockSpeed;Consumption;userRow;building;constructor(t=NaN,e=0,o=100,n=0,i=!0,a=null){this.buildingId=t,this.quantity=e,this.clockSpeed=o,this.Consumption=n,this.userRow=i,this.building=a}static async create(t=NaN,e=0,o=100,n=0,i=!0,a=null,l=[]){if("string"==typeof i)switch(i.toLowerCase()){case"0":case"false":i=!1;break;default:i=!0}const r=new g(t,e,o,n,i,a);if(!a&&t&&(r.building=l.find((e=>e.id===+t))||null,!r.building)){const e=await s.getBuilding(t);e&&!l.find((t=>t.id===e.id))&&l.push(e),r.building=e}return r}}const b='\n<option value="" disabled>Select a building</option>\n<option value="16">Assembler</option>\n<option value="247">AWESOME Sink</option>\n<option value="17">Blender</option>\n<option value="19">Constructor</option>\n<option value="6">Converter</option>\n<option value="13">Foundry</option>\n<option value="246">Hypertube Entrance</option>\n<option value="21">Main Portal</option>\n<option value="15">Manufacturer</option>\n<option value="10">Miner Mk.1</option>\n<option value="9">Miner Mk.2</option>\n<option value="11">Miner Mk.3</option>\n<option value="8">Oil Extractor</option>\n<option value="14">Packager</option>\n<option value="7">Particle Accelerator</option>\n<option value="249">Pipeline Pump Mk.1</option>\n<option value="248">Pipeline Pump Mk.2</option>\n<option value="5">Quantum Encoder</option>\n<option value="12">Refinery</option>\n<option value="22">Satellite Portal</option>\n<option value="18">Smelter</option>\n<option value="250">Valve</option>\n<option value="4">Water Extractor</option>\n',w='\n<option value="" disabled>Select an item</option>\n<option value="111">Actual Snow</option>\n<option value="82">Adaptive Control Unit</option>\n<option value="48">AI Expansion Server</option>\n<option value="79">AI Limiter</option>\n<option value="45">Alclad Aluminum Sheet</option>\n<option value="102">Alien DNA Capsule</option>\n<option value="100">Alien Protein</option>\n<option value="72">Alumina Solution</option>\n<option value="71">Aluminum Casing</option>\n<option value="7">Aluminum Ingot</option>\n<option value="70">Aluminum Scrap</option>\n<option value="56">Assembly Director System</option>\n<option value="77">Automated Wiring</option>\n<option value="98">Ballistic Warp Drive</option>\n<option value="8">Battery</option>\n<option value="128">Bauxite</option>\n<option value="55">Biochemical Sculptor</option>\n<option value="137">Biomass</option>\n<option value="95">Black Powder</option>\n<option value="117">Blue FICSMAS Ornament</option>\n<option value="101">Blue Power Slug</option>\n<option value="20">Cable</option>\n<option value="110">Candy Cane</option>\n<option value="57">Caterium Ingot</option>\n<option value="129">Caterium Ore</option>\n<option value="59">Circuit Board</option>\n<option value="123">Coal</option>\n<option value="14">Compacted Coal</option>\n<option value="73">Computer</option>\n<option value="3">Concrete</option>\n<option value="37">Cooling System</option>\n<option value="113">Copper FICSMAS Ornament</option>\n<option value="69">Copper Ingot</option>\n<option value="130">Copper Ore</option>\n<option value="88">Copper Powder</option>\n<option value="26">Copper Sheet</option>\n<option value="134">Crude Oil</option>\n<option value="32">Crystal Oscillator</option>\n<option value="34">Dark Matter Crystal</option>\n<option value="41">Dark Matter Residue</option>\n<option value="44">Diamonds</option>\n<option value="93">Dissolved Silica</option>\n<option value="90">Electromagnetic Control Rod</option>\n<option value="58">Empty Canister</option>\n<option value="31">Empty Fluid Tank</option>\n<option value="61">Encased Industrial Beam</option>\n<option value="84">Encased Plutonium Cell</option>\n<option value="92">Encased Uranium Cell</option>\n<option value="43">Excited Photonic Matter</option>\n<option value="146">Fabric</option>\n<option value="54">Ficsite Ingot</option>\n<option value="38">Ficsite Trigon</option>\n<option value="112">FICSMAS Bow</option>\n<option value="109">FICSMAS Decoration</option>\n<option value="118">FICSMAS Gift</option>\n<option value="108">FICSMAS Ornament Bundle</option>\n<option value="115">FICSMAS Tree Branch</option>\n<option value="107">FICSMAS Wonder Star</option>\n<option value="96">Ficsonium</option>\n<option value="121">Ficsonium Fuel Rod</option>\n<option value="24">Fuel</option>\n<option value="52">Fused Modular Frame</option>\n<option value="99">Gas Filter</option>\n<option value="150">Hatcher Remains</option>\n<option value="89">Heat Sink</option>\n<option value="74">Heavy Modular Frame</option>\n<option value="64">Heavy Oil Residue</option>\n<option value="76">High-Speed Connector</option>\n<option value="147">Hog Remains</option>\n<option value="13">Iodine-Infused Filter</option>\n<option value="35">Ionized Fuel</option>\n<option value="114">Iron FICSMAS Ornament</option>\n<option value="21">Iron Ingot</option>\n<option value="122">Iron Ore</option>\n<option value="5">Iron Plate</option>\n<option value="18">Iron Rod</option>\n<option value="138">Leaves</option>\n<option value="132">Limestone</option>\n<option value="141">Liquid Biofuel</option>\n<option value="49">Magnetic Field Generator</option>\n<option value="103">Mercer Sphere</option>\n<option value="81">Modular Engine</option>\n<option value="27">Modular Frame</option>\n<option value="33">Motor</option>\n<option value="139">Mycelia</option>\n<option value="47">Neural-Quantum Processor</option>\n<option value="29">Nitric Acid</option>\n<option value="125">Nitrogen Gas</option>\n<option value="86">Non-Fissile Uranium</option>\n<option value="91">Nuclear Pasta</option>\n<option value="142">Packaged Alumina Solution</option>\n<option value="9">Packaged Fuel</option>\n<option value="15">Packaged Heavy Oil Residue</option>\n<option value="10">Packaged Ionized Fuel</option>\n<option value="136">Packaged Liquid Biofuel</option>\n<option value="144">Packaged Nitric Acid</option>\n<option value="143">Packaged Nitrogen Gas</option>\n<option value="17">Packaged Oil</option>\n<option value="11">Packaged Rocket Fuel</option>\n<option value="145">Packaged Sulfuric Acid</option>\n<option value="12">Packaged Turbofuel</option>\n<option value="68">Packaged Water</option>\n<option value="16">Petroleum Coke</option>\n<option value="60">Plastic</option>\n<option value="120">Plutonium Fuel Rod</option>\n<option value="85">Plutonium Pellet</option>\n<option value="2">Plutonium Waste</option>\n<option value="63">Polymer Resin</option>\n<option value="83">Pressure Conversion Cube</option>\n<option value="104">Purple Power Slug</option>\n<option value="65">Quartz Crystal</option>\n<option value="80">Quickwire</option>\n<option value="53">Radio Control Unit</option>\n<option value="131">Raw Quartz</option>\n<option value="42">Reanimated SAM</option>\n<option value="116">Red FICSMAS Ornament</option>\n<option value="22">Reinforced Iron Plate</option>\n<option value="25">Rocket Fuel</option>\n<option value="23">Rotor</option>\n<option value="62">Rubber</option>\n<option value="127">SAM</option>\n<option value="50">SAM Fluctuator</option>\n<option value="28">Screw</option>\n<option value="4">Silica</option>\n<option value="97">Singularity Cell</option>\n<option value="75">Smart Plating</option>\n<option value="106">Smokeless Powder</option>\n<option value="135">Solid Biofuel</option>\n<option value="148">Spitter Remains</option>\n<option value="78">Stator</option>\n<option value="6">Steel Beam</option>\n<option value="66">Steel Ingot</option>\n<option value="51">Steel Pipe</option>\n<option value="149">Stinger Remains</option>\n<option value="126">Sulfur</option>\n<option value="87">Sulfuric Acid</option>\n<option value="36">Supercomputer</option>\n<option value="46">Superposition Oscillator</option>\n<option value="94">Thermal Propulsion Rocket</option>\n<option value="40">Time Crystal</option>\n<option value="39">Turbo Motor</option>\n<option value="30">Turbofuel</option>\n<option value="133">Uranium</option>\n<option value="119">Uranium Fuel Rod</option>\n<option value="1">Uranium Waste</option>\n<option value="67">Versatile Framework</option>\n<option value="124">Water</option>\n<option value="19">Wire</option>\n<option value="140">Wood</option>\n<option value="105">Yellow Power Slug</option>\n',f='\n    <option value="" disabled>Select a recipe</option>\n    <option value="259">Actual Snow</option>\n    <option value="116">Adaptive Control Unit</option>\n    <option value="14">AI Expansion Server</option>\n    <option value="110">AI Limiter</option>\n    <option value="95">Alclad Aluminum Sheet</option>\n    <option value="245">Alien DNA Capsule</option>\n    <option value="242">Alien Power Matrix</option>\n    <option value="133">Alternate: Adhered Iron Plate</option>\n    <option value="177">Alternate: Alclad Casing</option>\n    <option value="182">Alternate: Aluminum Beam</option>\n    <option value="183">Alternate: Aluminum Rod</option>\n    <option value="105">Alternate: Automated Speed Wiring</option>\n    <option value="189">Alternate: Basic Iron Ingot</option>\n    <option value="49">Alternate: Biocoal</option>\n    <option value="132">Alternate: Bolted Frame</option>\n    <option value="208">Alternate: Bolted Iron Plate</option>\n    <option value="204">Alternate: Cast Screw</option>\n    <option value="227">Alternate: Caterium Circuit Board</option>\n    <option value="226">Alternate: Caterium Computer</option>\n    <option value="194">Alternate: Caterium Wire</option>\n    <option value="48">Alternate: Charcoal</option>\n    <option value="202">Alternate: Cheap Silica</option>\n    <option value="176">Alternate: Classic Battery</option>\n    <option value="62">Alternate: Cloudy Diamonds</option>\n    <option value="131">Alternate: Coated Cable</option>\n    <option value="130">Alternate: Coated Iron Canister</option>\n    <option value="129">Alternate: Coated Iron Plate</option>\n    <option value="128">Alternate: Coke Steel Ingot</option>\n    <option value="50">Alternate: Compacted Coal</option>\n    <option value="215">Alternate: Compacted Steel Ingot</option>\n    <option value="175">Alternate: Cooling Device</option>\n    <option value="127">Alternate: Copper Alloy Ingot</option>\n    <option value="122">Alternate: Copper Rotor</option>\n    <option value="225">Alternate: Crystal Computer</option>\n    <option value="64">Alternate: Dark Matter Crystallization</option>\n    <option value="63">Alternate: Dark Matter Trap</option>\n    <option value="8">Alternate: Dark-Ion Fuel</option>\n    <option value="174">Alternate: Diluted Fuel</option>\n    <option value="121">Alternate: Diluted Packaged Fuel</option>\n    <option value="185">Alternate: Distilled Silica</option>\n    <option value="173">Alternate: Electric Motor</option>\n    <option value="120">Alternate: Electrode Aluminum Scrap</option>\n    <option value="119">Alternate: Electrode Circuit Board</option>\n    <option value="222">Alternate: Electromagnetic Connection Rod</option>\n    <option value="206">Alternate: Encased Industrial Pipe</option>\n    <option value="172">Alternate: Fertile Uranium</option>\n    <option value="221">Alternate: Fine Black Powder</option>\n    <option value="224">Alternate: Fine Concrete</option>\n    <option value="118">Alternate: Flexible Framework</option>\n    <option value="187">Alternate: Fused Quartz Crystal</option>\n    <option value="210">Alternate: Fused Quickwire</option>\n    <option value="117">Alternate: Fused Wire</option>\n    <option value="220">Alternate: Heat Exchanger</option>\n    <option value="171">Alternate: Heat-Fused Frame</option>\n    <option value="219">Alternate: Heavy Encased Frame</option>\n    <option value="112">Alternate: Heavy Flexible Frame</option>\n    <option value="111">Alternate: Heavy Oil Residue</option>\n    <option value="196">Alternate: Infused Uranium Cell</option>\n    <option value="170">Alternate: Instant Plutonium Cell</option>\n    <option value="169">Alternate: Instant Scrap</option>\n    <option value="230">Alternate: Insulated Cable</option>\n    <option value="223">Alternate: Insulated Crystal Oscillator</option>\n    <option value="217">Alternate: Iron Alloy Ingot</option>\n    <option value="179">Alternate: Iron Pipe</option>\n    <option value="195">Alternate: Iron Wire</option>\n    <option value="193">Alternate: Leached Caterium Ingot</option>\n    <option value="191">Alternate: Leached Copper Ingot</option>\n    <option value="188">Alternate: Leached Iron ingot</option>\n    <option value="181">Alternate: Molded Beam</option>\n    <option value="178">Alternate: Molded Steel Pipe</option>\n    <option value="4">Alternate: Nitro Rocket Fuel</option>\n    <option value="163">Alternate: OC Supercomputer</option>\n    <option value="61">Alternate: Oil-Based Diamonds</option>\n    <option value="60">Alternate: Petroleum Diamonds</option>\n    <option value="59">Alternate: Pink Diamonds</option>\n    <option value="184">Alternate: Plastic AI Limiter</option>\n    <option value="104">Alternate: Plastic Smart Plating</option>\n    <option value="162">Alternate: Plutonium Fuel Unit</option>\n    <option value="248">Alternate: Polyester Fabric</option>\n    <option value="103">Alternate: Polymer Resin</option>\n    <option value="93">Alternate: Pure Aluminum Ingot</option>\n    <option value="92">Alternate: Pure Caterium Ingot</option>\n    <option value="91">Alternate: Pure Copper Ingot</option>\n    <option value="90">Alternate: Pure Iron Ingot</option>\n    <option value="88">Alternate: Pure Quartz Crystal</option>\n    <option value="186">Alternate: Quartz Purification</option>\n    <option value="229">Alternate: Quickwire Cable</option>\n    <option value="201">Alternate: Quickwire Stator</option>\n    <option value="209">Alternate: Radio Connection Unit</option>\n    <option value="161">Alternate: Radio Control System</option>\n    <option value="211">Alternate: Recycled Plastic</option>\n    <option value="87">Alternate: Recycled Rubber</option>\n    <option value="213">Alternate: Rigor Motor</option>\n    <option value="86">Alternate: Rubber Concrete</option>\n    <option value="228">Alternate: Silicon Circuit Board</option>\n    <option value="218">Alternate: Silicon High-Speed Connector</option>\n    <option value="160">Alternate: Sloppy Alumina</option>\n    <option value="216">Alternate: Solid Steel Ingot</option>\n    <option value="85">Alternate: Steamed Copper Sheet</option>\n    <option value="72">Alternate: Steel Canister</option>\n    <option value="180">Alternate: Steel Cast Plate</option>\n    <option value="67">Alternate: Steel Rod</option>\n    <option value="205">Alternate: Steel Rotor</option>\n    <option value="203">Alternate: Steel Screw</option>\n    <option value="214">Alternate: Steeled Frame</option>\n    <option value="207">Alternate: Stitched Iron Plate</option>\n    <option value="156">Alternate: Super-State Computer</option>\n    <option value="192">Alternate: Tempered Caterium Ingot</option>\n    <option value="190">Alternate: Tempered Copper Ingot</option>\n    <option value="145">Alternate: Turbo Blend Fuel</option>\n    <option value="18">Alternate: Turbo Diamonds</option>\n    <option value="198">Alternate: Turbo Electric Motor</option>\n    <option value="66">Alternate: Turbo Heavy Fuel</option>\n    <option value="134">Alternate: Turbo Pressure Motor</option>\n    <option value="212">Alternate: Uranium Fuel Unit</option>\n    <option value="65">Alternate: Wet Concrete</option>\n    <option value="96">Alumina Solution</option>\n    <option value="94">Aluminum Casing</option>\n    <option value="99">Aluminum Ingot</option>\n    <option value="97">Aluminum Scrap</option>\n    <option value="153">Assembly Director System</option>\n    <option value="109">Automated Wiring</option>\n    <option value="234">Ballistic Warp Drive</option>\n    <option value="148">Battery</option>\n    <option value="28">Bauxite (Caterium)</option>\n    <option value="29">Bauxite (Copper)</option>\n    <option value="25">Biochemical Sculptor</option>\n    <option value="240">Biomass (Mycelia)</option>\n    <option value="246">Biomass (Alien Protein)</option>\n    <option value="263">Biomass (Leaves)</option>\n    <option value="264">Biomass (Wood)</option>\n    <option value="241">Black Powder</option>\n    <option value="256">Blue FICSMAS Ornament</option>\n    <option value="268">Cable</option>\n    <option value="262">Candy Cane</option>\n    <option value="197">Caterium Ingot</option>\n    <option value="30">Caterium Ore (Copper)</option>\n    <option value="31">Caterium Ore (Quartz)</option>\n    <option value="51">Circuit Board</option>\n    <option value="32">Coal (Iron)</option>\n    <option value="33">Coal (Limestone)</option>\n    <option value="113">Computer</option>\n    <option value="266">Concrete</option>\n    <option value="147">Cooling System</option>\n    <option value="257">Copper FICSMAS Ornament</option>\n    <option value="270">Copper Ingot</option>\n    <option value="34">Copper Ore (Quartz)</option>\n    <option value="35">Copper Ore (Sulfur)</option>\n    <option value="139">Copper Powder</option>\n    <option value="125">Copper Sheet</option>\n    <option value="101">Crystal Oscillator</option>\n    <option value="11">Dark Matter Crystal</option>\n    <option value="9">Dark Matter Residue</option>\n    <option value="23">Diamonds</option>\n    <option value="157">Electromagnetic Control Rod</option>\n    <option value="73">Empty Canister</option>\n    <option value="166">Empty Fluid Tank</option>\n    <option value="106">Encased Industrial Beam</option>\n    <option value="135">Encased Plutonium Cell</option>\n    <option value="146">Encased Uranium Cell</option>\n    <option value="10">Excited Photonic Matter</option>\n    <option value="249">Fabric</option>\n    <option value="21">Ficsite Ingot (Iron)</option>\n    <option value="26">Ficsite Ingot (Aluminum)</option>\n    <option value="27">Ficsite Ingot (Caterium)</option>\n    <option value="20">Ficsite Trigon</option>\n    <option value="261">FICSMAS Bow</option>\n    <option value="253">FICSMAS Decoration</option>\n    <option value="254">FICSMAS Ornament Bundle</option>\n    <option value="260">FICSMAS Tree Branch</option>\n    <option value="252">FICSMAS Wonder Star</option>\n    <option value="231">Ficsonium</option>\n    <option value="232">Ficsonium Fuel Rod</option>\n    <option value="52">Fuel</option>\n    <option value="165">Fused Modular Frame</option>\n    <option value="247">Gas Filter</option>\n    <option value="244">Hatcher Protein</option>\n    <option value="164">Heat Sink</option>\n    <option value="114">Heavy Modular Frame</option>\n    <option value="154">High-Speed Connector</option>\n    <option value="238">Hog Protein</option>\n    <option value="235">Iodine-Infused Filter</option>\n    <option value="15">Ionized Fuel</option>\n    <option value="258">Iron FICSMAS Ornament</option>\n    <option value="3">Iron Ingot</option>\n    <option value="36">Iron Ore (Limestone)</option>\n    <option value="1">Iron Plate</option>\n    <option value="2">Iron Rod</option>\n    <option value="37">Limestone (Sulfur)</option>\n    <option value="75">Liquid Biofuel</option>\n    <option value="159">Magnetic Field Generator</option>\n    <option value="115">Modular Engine</option>\n    <option value="123">Modular Frame</option>\n    <option value="107">Motor</option>\n    <option value="13">Neural-Quantum Processor</option>\n    <option value="137">Nitric Acid</option>\n    <option value="38">Nitrogen Gas (Bauxite)</option>\n    <option value="39">Nitrogen Gas (Caterium)</option>\n    <option value="138">Non-Fissile Uranium</option>\n    <option value="143">Nuclear Pasta</option>\n    <option value="98">Packaged Alumina Solution</option>\n    <option value="74">Packaged Fuel</option>\n    <option value="78">Packaged Heavy Oil Residue</option>\n    <option value="16">Packaged Ionized Fuel</option>\n    <option value="76">Packaged Liquid Biofuel</option>\n    <option value="142">Packaged Nitric Acid</option>\n    <option value="167">Packaged Nitrogen Gas</option>\n    <option value="77">Packaged Oil</option>\n    <option value="6">Packaged Rocket Fuel</option>\n    <option value="152">Packaged Sulfuric Acid</option>\n    <option value="46">Packaged Turbofuel</option>\n    <option value="79">Packaged Water</option>\n    <option value="53">Petroleum Coke</option>\n    <option value="54">Plastic</option>\n    <option value="141">Plutonium Fuel Rod</option>\n    <option value="140">Plutonium Pellet</option>\n    <option value="136">Pressure Conversion Cube</option>\n    <option value="89">Quartz Crystal</option>\n    <option value="236">Quickwire</option>\n    <option value="150">Radio Control Unit</option>\n    <option value="40">Raw Quartz (Bauxite)</option>\n    <option value="41">Raw Quartz (Coal)</option>\n    <option value="24">Reanimated SAM</option>\n    <option value="255">Red FICSMAS Ornament</option>\n    <option value="265">Reinforced Iron Plate</option>\n    <option value="56">Residual Fuel</option>\n    <option value="57">Residual Plastic</option>\n    <option value="58">Residual Rubber</option>\n    <option value="5">Rocket Fuel</option>\n    <option value="124">Rotor</option>\n    <option value="55">Rubber</option>\n    <option value="19">SAM Fluctuator</option>\n    <option value="267">Screw</option>\n    <option value="100">Silica</option>\n    <option value="233">Singularity Cell</option>\n    <option value="126">Smart Plating</option>\n    <option value="251">Smokeless Powder</option>\n    <option value="237">Solid Biofuel</option>\n    <option value="239">Spitter Protein</option>\n    <option value="108">Stator</option>\n    <option value="68">Steel Beam</option>\n    <option value="70">Steel Ingot</option>\n    <option value="69">Steel Pipe</option>\n    <option value="243">Stinger Protein</option>\n    <option value="42">Sulfur (Coal)</option>\n    <option value="43">Sulfur (Iron)</option>\n    <option value="151">Sulfuric Acid</option>\n    <option value="149">Supercomputer</option>\n    <option value="12">Superposition Oscillator</option>\n    <option value="250">Synthetic Power Shard</option>\n    <option value="200">Thermal Propulsion Rocket</option>\n    <option value="22">Time Crystal</option>\n    <option value="199">Turbo Motor</option>\n    <option value="45">Turbofuel</option>\n    <option value="102">Unpackage Alumina Solution</option>\n    <option value="81">Unpackage Fuel</option>\n    <option value="83">Unpackage Heavy Oil Residue</option>\n    <option value="17">Unpackage Ionized Fuel</option>\n    <option value="80">Unpackage Liquid Biofuel</option>\n    <option value="144">Unpackage Nitric Acid</option>\n    <option value="168">Unpackage Nitrogen Gas</option>\n    <option value="82">Unpackage Oil</option>\n    <option value="7">Unpackage Rocket Fuel</option>\n    <option value="155">Unpackage Sulfuric Acid</option>\n    <option value="47">Unpackage Turbofuel</option>\n    <option value="84">Unpackage Water</option>\n    <option value="158">Uranium Fuel Rod</option>\n    <option value="44">Uranium Ore (Bauxite)</option>\n    <option value="71">Versatile Framework</option>\n    <option value="269">Wire</option>\n';class y{static generatePowerTable(t,e,o){return t.map(((t,o)=>`\n      <tr>\n        <td class="m-0 p-0 w-50">\n          <select class="form-control rounded-0" name="power_building_id[]" min="0">\n            ${e.replace(`<option value="${t.buildingId}">`,`<option value="${t.buildingId}" selected>`)}\n          </select>\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="${t.quantity}" class="form-control rounded-0" name="power_amount[]" min="0" step="any" data-index="${o}" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="${t.clockSpeed}" class="form-control rounded-0" name="power_clock_speed[]" min="1" max="250" step="any" data-index="${o}" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="${t.Consumption}" class="form-control rounded-0" disabled name="power_Consumption[]" min="0" step="any">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="hidden" value="${t.userRow?1:0}" class="form-control rounded-0" readonly name="user[]" min="0">\n        </td>\n      </tr>\n    `)).join("")+`\n      <tr>\n        <td class="m-0 p-0 w-50">\n          <select class="form-control rounded-0" name="power_building_id[]" min="0">\n            ${e.replace(/<option /,"<option selected ")} \x3c!-- Selects the first option --\x3e\n          </select>\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="0" class="form-control rounded-0" name="power_amount[]" min="0" step="any" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="100" class="form-control rounded-0" name="power_clock_speed[]" min="1" max="250" step="any" onchange="updateConsumption()">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="number" value="0" class="form-control rounded-0" readonly name="power_Consumption[]" min="0" step="any">\n        </td>\n        <td class="m-0 p-0 w-25">\n          <input type="hidden" value="1" class="form-control rounded-0" readonly name="user[]" min="0">\n        </td>\n      </tr>\n    `+`\n      <tr>\n        <td colspan="1" class="table-dark">\n          Total:\n        </td>\n        <td colspan="2"></td>\n        <td class="w-25 m-0 p-0">\n          <input type="number" name="total_consumption" readonly class="form-control rounded-0" id="totalConsumption" value="${o}">\n        </td>\n      </tr>\n    `}static generateImportsTableRows(t){return t.map((t=>{const e=Number(t.quantity)%1==0?t.quantity.toFixed(0):t.quantity.toFixed(5);return`\n            <tr>\n                <td class="m-0 p-0 w-75">\n                    <select name="imports_item_id[]" class="form-control rounded-0">\n                        ${w.replace(`value="${t.itemId}"`,`value="${t.itemId}" selected`)}\n                    </select>\n                </td>\n                <td class="m-0 p-0 w-25">\n                    <input min="0" type="number" name="imports_ammount[]" class="form-control rounded-0" value="${e}" readonly>\n                </td>\n            </tr>\n        `})).join("")+`\n        <tr>\n            <td class="m-0 p-0 w-75">\n                <select name="imports_item_id[]" class="form-control rounded-0">\n                    ${w.replace(/<option /,"<option selected ")} \x3c!-- Selects the first option --\x3e\n                </select>\n            </td>\n            <td class="m-0 p-0 w-25">\n                <input min="0" type="number" name="imports_ammount[]" class="form-control rounded-0">\n            </td>\n        </tr>`}static generateProductionTableRows(t){return t.map((t=>{let e="",o="",n="";return t.doubleExport&&(e='style="height: 78px"',n='rowspan="2"',o=`\n            <tr class="extra-output">\n                <td class="m-0 p-0">\n                    <input type="text" readonly class="form-control rounded-0 product-name" value="${t.extraCells?.Product}">\n                </td>\n                <td class="m-0 p-0">\n                    <input min="0" type="number" step="any" name="production_usage2[]" value="${t.extraCells?.Usage}" required readonly class="form-control rounded-0 usage-amount">\n                </td>\n                <td class="m-0 p-0">\n                    <input min="0" type="number" step="any" name="production_export2[]" value="${t.extraCells?.Quantity}" required readonly class="form-control rounded-0 export-amount">\n                </td>\n            </tr>\n            `),` <tr>\n          <td class="hidden">\n            <input type="hidden" name="production_id[]" value="${t.row_id}">\n          </td>\n          <td class="m-0 p-0" ${n}>\n            <select name="production_recipe_id[]" class="form-control rounded-0 item-recipe-id recipe" ${e}>\n              ${f.replace(`value="${t.recipeId}"`,`value="${t.recipeId}" selected`)}\n            </select>\n          </td>\n          <td class="m-0 p-0" ${n}>\n            <input min="0" type="number" step="any" name="production_quantity[]" value="${t.quantity}" required class="form-control rounded-0 production-quantity" ${e}>\n          </td>\n          <td class="m-0 p-0">\n            <input type="text" readonly class="form-control rounded-0 product-name" value="${t.product}">\n          </td>\n          <td class="m-0 p-0">\n            <input min="0" type="number" step="any" name="production_usage[]" value="${t.Usage}" required readonly class="form-control rounded-0 usage-amount">\n          </td>\n          <td class="m-0 p-0">\n            <input min="0" type="number" step="any" name="production_export[]" value="${t.exportPerMin}" required readonly class="form-control rounded-0 export-amount">\n          </td>\n        </tr>\n        ${o}\n        `})).join("")+`\n        <tr>\n            <td class="m-0 p-0">\n                <select name="production_recipe_id[]" class="form-control rounded-0 item-recipe-id recipe">\n                    ${f.replace(/<option /,"<option selected ")}\n                </select>\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_quantity[]" required class="form-control rounded-0 production-quantity">\n            </td>\n            <td class="m-0 p-0">\n                <input type="text" readonly class="form-control rounded-0 product-name">\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_usage[]" required readonly class="form-control rounded-0 usage-amount">\n            </td>\n            <td class="m-0 p-0">\n                <input min="0" type="number" value="0" step="any" name="production_export[]" required readonly class="form-control rounded-0 export-amount">\n            </td>\n        </tr>\n    `}static createCard(t,e,o,n,i,a,l){return`\n        <div class="card mb-2" id="check-${t}">\n            <div class="card-body p-3">\n                <h5 class="card-title recipeName">${e}</h5>\n                <p class="card-text"><span class="productionAmount">${o}</span> per min - <span class="buildingAmount">${+n.toFixed(5)}</span> <span class="buildingName">${l}</span></p>\n                <div style="display: flex; justify-content: space-between;">\n                    <div>\n                        <input type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="dark" for="build" class="beenBuild"\n                               data-onlabel="<i class='fa-solid fa-check'></i>" data-offlabel="<i class='fa-solid fa-times'></i>"\n                               data-size="sm" data-style="ios" data-theme="dark" ${i?"checked":""}/>\n                        <label for="build">Build</label>\n                    </div>\n                    <div>\n                        \x3c!--                        same checkbox as above--\x3e\n                        <input type="checkbox" data-toggle="toggle" data-onstyle="success" data-offstyle="dark" for="tested" class="beenTested"\n                               data-onlabel="<i class='fa-solid fa-check'></i>" data-offlabel="<i class='fa-solid fa-times'></i>"\n                               data-size="sm" data-style="ios" data-theme="dark" ${a?"checked":""}/>\n                        <label for="tested">Tested</label>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}}class C{static calculateBuildings(t,e){const o=e.filter((t=>1==t.userRow));o.pop();let n=[];for(let e=0;e+1<t.length;e++){const o=t[e],i=o.recipe;if(null!==i){const t=i.building,e=n.find((e=>e.buildingId===t.id)),a=o.recipeSetting?.clockSpeed||100,l=o.recipeSetting?.useSomersloop||!1;let s=C.calculateBuildingAmount(i,o),r=0;const p=+C.calculateConsumption(s,a,t.power_used,l);if(s%1!=0&&(r=s%1,s=Math.floor(s)),e?(e.quantity+=s,e.Consumption=+C.calculateConsumption(e.quantity,a,t.power_used,l),e.clockSpeed=a):n.push(new g(t.id,s,a,p,!1,t)),r>0){const e=100*r;if(e<1)continue;const o=+C.calculateConsumption(1,e,t.power_used,l);n.push(new g(t.id,1,+e.toFixed(5),o,!1,t))}}}n=n.concat(o);const i=y.generatePowerTable(n,b,C.calculateTotalConsumption(n));return $("#power tbody").html(i),n.push(new g),n}static calculateBuildingAmount(t,e){const o=e.quantity,n=e.recipeSetting?.clockSpeed||100,i=e.recipeSetting?.useSomersloop||!1;return o/(t.export_amount_per_min*(n/100))/(i?2:1)}static calculateConsumption(t,e,o,n){return+(t*o*Math.pow(1+(n?4:0)/4,2)*Math.pow(e/100,1.321928)).toFixed(5)}static calculateTotalConsumption(t){const e=t.filter((t=>0!==t.Consumption)).reduce(((t,e)=>t+(Number(e.Consumption)||0)),0);return parseFloat(e.toFixed(5))}static calculateSingleConsumption(t){if(null===t.building)return 0;const e=Math.pow(t.clockSpeed/100,1.321928);return+(t.quantity*t.building.power_used*e).toFixed(5)}static async updateBuilding(t,e){t.building=await s.getBuilding(e),t.buildingId=e,t.Consumption=+C.calculateSingleConsumption(t)}static updateTotalConsumption(t){const e=C.calculateTotalConsumption(t);$("#totalConsumption").val(e)}}class S{index;amount;doubleExport;product;constructor(t=0,e=0,o="",n=!1){this.index=t,this.amount=e,this.product=o,this.doubleExport=n}}class x{static calculateImports(t){let e=[],o=this.resetUsage(t);for(let n=0;n+1<t.length;n++){const i=t[n],a=i.recipe?.resources,l=this.calculateProductionRate(i);a&&this.processRequiredItems(a,l,i,t,e,o)}const n=y.generateImportsTableRows(e);return $("#imports tbody").html(n),e.push(new l),{importsTableRows:e,indexes:o}}static resetUsage(t){const e=[];for(const o of t)if(o.productionImports=[],o.imports=[],o.Usage>0&&(e.push(t.indexOf(o)),o.Usage=0,o.exportPerMin=o.quantity),null!==o.extraCells&&o.extraCells.Usage>0){let n=t.indexOf(o);-1===n||e.includes(n)||e.push(n),o.extraCells.Usage=0,o.extraCells.ExportPerMin=o.extraCells.Quantity}return e}static calculateProductionRate(t){return t.recipe?.export_amount_per_min?t.quantity/t.recipe.export_amount_per_min:0}static processRequiredItems(t,e,o,n,i,a){for(const l of t){let t=l.importAmount*e/(o.recipeSetting?.useSomersloop?2:1);const s=n.filter((t=>t.product===l.name)),r=n.filter((t=>null!==t.extraCells&&t.extraCells.Product===l.name));let p=0,u=0;const{totalUsed:c,totalAvailable:d}=this.processProducedRows(s,t,u,p,n,a,o,l.name);u=c,p=d;const{totalUsed:h,totalAvailable:m}=this.processDoubleExportRows(r,t,u,p,n,a,o,l.name);u=h,p=m;const v=t-u;v>0&&this.addToImportsTable(i,l.itemId,v,o,l.name)}}static processProducedRows(t,e,o,n,i,a,l,s){for(const r of t){const t=r.quantity-r.Usage,p=Math.min(t,e-o);if(p<=0)continue;r.Usage+=+p.toFixed(5),r.exportPerMin=+(r.quantity-r.Usage).toFixed(5),o+=p,n+=t;const u=i.indexOf(r);l.productionImports.push(new S(u,p,s)),-1===u||a.includes(u)||a.push(u)}return{totalUsed:o,totalAvailable:n}}static processDoubleExportRows(t,e,o,n,i,a,l,s){for(const r of t){if(null===r.extraCells)continue;const t=r.extraCells.Quantity-r.extraCells.Usage,p=Math.min(t,e-o);if(p<=0)continue;r.extraCells.Usage+=+p.toFixed(5),r.extraCells.ExportPerMin=+(r.extraCells.Quantity-r.extraCells.Usage).toFixed(5),o+=p,n+=t;const u=i.indexOf(r);l.productionImports.push(new S(u,p,s,!0)),-1===u||a.includes(u)||a.push(u)}return{totalUsed:o,totalAvailable:n}}static addToImportsTable(t,e,o,n,i){const a=t.find((t=>t.itemId===e));(o=+o.toFixed(5))<=1e-4||(a?(a.quantity+=o,n.imports.push(new S(t.indexOf(a),o,i))):(t.push(new l(e,o,i)),n.imports.push(new S(t.length-1,o,i))))}}class k{autoImportExport=!0;autoPowerMachine=!0;autoSave=!1;constructor(){this.addEventListeners(),this.applyChanges()}applyChanges(){const t=new URL(window.location.href),e=parseInt(t.searchParams.get("id")),o=document.getElementById("auto_import_export"),n=document.getElementById("auto_power_machine");o&&(this.autoImportExport=o.checked),n&&(this.autoPowerMachine=n.checked),s.saveSettings(e,this.autoImportExport,this.autoPowerMachine,this.autoSave)}addEventListeners(){const t=document.getElementById("auto_import_export"),e=document.getElementById("auto_power_machine");t&&t.addEventListener("change",(()=>{$("#auto_import_export").parent().parent().tooltip("hide"),this.applyChanges()})),e&&e.addEventListener("change",(()=>{$("#auto_power_machine").parent().parent().tooltip("hide"),this.applyChanges()}))}}class A{id;product;quantity;X;Y;constructor(t,e,o){this.id=t,this.product=e,this.quantity=o,this.X=0,this.Y=0}}class I{id;product;quantity;building;buildingId;buildingAmount;checklist;X;Y;constructor(t,e,o,n,i,a,l){this.id=t,this.product=e,this.quantity=o,this.building=n,this.buildingId=i,this.buildingAmount=a,this.checklist=l,this.X=0,this.Y=0}}class R{id;product;quantity;X;Y;constructor(t,e,o){this.id=t,this.product=e,this.quantity=o,this.X=0,this.Y=0}}class T{id;sourceId;targetId;quantity;product;constructor(t,e,o,n,i){this.id=t,this.sourceId=e,this.targetId=o,this.quantity=n,this.product=i}}let P;class E{TableHandler;importNodes=[];productionNodes=[];exportNodes=[];importConnections=[];productionConnections=[];exportConnections=[];layout="klay";showExport=!1;showImport=!0;showChecklist=!0;useRoots=!0;cy=null;constructor(t){this.TableHandler=t,this.getterData(),this.createVisualization(),this.addEventListeners()}update(){this.getterData(),this.createVisualization()}async createVisualization(){await this.loadCytoscapeExtensions();let t=[];this.showImport&&(t.push(...this.importNodes.map((t=>this.addNode("import",t)))),[].push(...this.importNodes.map((t=>`import_${t.id}`))),t.push(...this.importConnections.map((t=>this.addConnection("import",t,"import","production"))))),t.push(...this.productionNodes.map((t=>this.addNode("production",t)))),t.push(...this.productionConnections.map(((t,e)=>({...this.addConnection("production",t,"production","production"),data:{...this.addConnection("production",t,"production","production").data,id:`productionConnection_${e}`}})))),this.showExport&&(t.push(...this.exportNodes.map((t=>this.addNode("export",t)))),t.push(...this.exportConnections.map((t=>this.addConnection("export",t,"production","export")))));const e=P({container:document.getElementById("graph"),elements:t,style:[{selector:"node",style:{label:"data(label)","background-color":"data(color)","text-halign":"center","text-valign":"center",width:200,height:200,color:"black","font-size":25,"text-wrap":"wrap"}},{selector:"node.top-text",style:{"text-margin-y":-60}},{selector:"edge",style:{label:"data(label)","font-size":25,"text-background-color":"white","text-background-opacity":.5,"text-background-padding":"3px","text-background-shape":"roundrectangle",color:"black",width:5,"line-color":"data(color)","target-arrow-color":"#333","target-arrow-shape":"triangle","target-arrow-fill":"filled","curve-style":"bezier","control-point-step-size":40}}],layout:{name:"klay",animate:!0,spacingFactor:2,nodeDimensionsIncludeLabels:!0,avoidOverlap:!0}});e.ready((()=>{e.nodes().forEach((t=>{this.applyQTip(t,t.data("title")),t.on("drag",(()=>{t.qtip("api").visible&&t.qtip("api").hide()})),t.on("mouseout",(()=>{t.qtip("api").hide()}))})),e.edges().forEach((t=>{this.applyQTip(t,t.data("label"))})),e.center(),e.fit()})),this.cy=e}applyQTip(t,e){t.qtip({content:e,position:{my:"top center",at:"bottom center"},style:{classes:"qtip-bootstrap",tip:{width:16,height:8}},show:{event:"mouseover",delay:100},hide:{event:"mouseout"}})}updateNodeColors(){this.cy?this.cy.nodes().forEach((t=>{const e=t.data();if(e.id.startsWith("production")){const o=this.productionNodes.find((t=>`production_${t.id}`===e.id));if(!o)return;t.style("background-color",this.showChecklist?this.getColor(o.checklist):"green")}})):console.error("Cytoscape instance not found!")}getColor(t){return t?t.beenBuild&&t.beenTested?"#28A745":t.beenBuild?"#FFD700":"#A0A0A0":"#A0A0A0"}addNode(t,e){return{data:{id:`${t}_${e.id}`,label:`${e.product}\n${e.quantity}${e.building?`\n\n\n\n${e.building}\n${e.buildingAmount}`:""}`,color:"import"===t?"blue":"export"===t?"red":this.showChecklist?this.getColor(e.checklist):"green",title:`${t.charAt(0).toUpperCase()+t.slice(1)}: ${e.product}<br>Amount: ${e.quantity}${e.building?`<br><hr>Building: ${e.building}<br>Amount of building: ${e.buildingAmount}`:""}`},classes:"production"===t?"top-text":""}}addConnection(t,e,o,n){return{data:{id:`${t}Connection_${e.id}`,source:`${o}_${e.sourceId}`,target:`${n}_${e.targetId}`,label:`${e.product} ${e.quantity}`,color:"import"===t?"blue":"export"===t?"red":"green"}}}getterData(){this.importNodes=[],this.productionNodes=[],this.exportNodes=[],this.importConnections=[],this.productionConnections=[],this.exportConnections=[],this.getImportNodes(),this.getProduction(),this.getExportNodes(),this.getImportConnection()}addEventListeners(){$("#showChecklist").on("change",(t=>{const e=$(t.target);this.showChecklist=e.prop("checked"),this.updateNodeColors()})),$("#export").on("change",(t=>{const e=$(t.target);this.showExport=e.prop("checked"),this.createVisualization()})),$("#import").on("change",(t=>{const e=$(t.target);this.showImport=e.prop("checked"),this.createVisualization()})),$("#refresh").on("click",(()=>{this.createVisualization()})),$("#roots").on("change",(t=>{const e=$(t.target);this.useRoots=e.prop("checked"),this.createVisualization()}))}getImportConnection(){let t=0;for(let e=0;e<this.TableHandler.productionTableRows.length;e++){const o=this.TableHandler.productionTableRows[e];for(let n=0;n<o.imports.length;n++){const i=o.imports[n];this.importConnections.push(new T(t,i.index,e,+i.amount.toFixed(3),i.product)),t++}}}getProduction(){for(let t=0;t<this.TableHandler.productionTableRows.length;t++){const e=this.TableHandler.productionTableRows[t],o=e.recipe?.building,n=(e.quantity,e.recipe),i=this.TableHandler.checklist?.getChecklist().find((t=>t.productionRow.row_id==e.row_id));if(!n)continue;let a=C.calculateBuildingAmount(n,e).toFixed(5);o&&n&&this.productionNodes.push(new I(t,n.name,e.quantity,o.name,o.id,+a,i));for(let o=0;o<e.productionImports.length;o++){const n=e.productionImports[o];this.productionConnections.push(new T(t,n.index,t,+n.amount.toFixed(3),n.product))}}}getImportNodes(){for(let t=0;t<this.TableHandler.importsTableRows.length;t++){const e=this.TableHandler.importsTableRows[t];""!==e.product&&e.quantity>0&&this.importNodes.push(new A(t,e.product,e.quantity))}}getExportNodes(){let t=0;for(let e=0;e<this.TableHandler.productionTableRows.length;e++){const o=this.TableHandler.productionTableRows[e];o.exportPerMin>0&&(this.exportNodes.push(new R(t,o.product,o.exportPerMin)),this.exportConnections.push(new T(t,e,this.exportNodes.length-1,o.exportPerMin,o.product)),t++),o.extraCells?.ExportPerMin>0&&(this.exportNodes.push(new R(t,o.product,o.extraCells?.ExportPerMin)),this.exportConnections.push(new T(t,e,this.exportNodes.length-1,o.extraCells?.ExportPerMin,o.product)),t++)}}async loadCytoscapeExtensions(){P=(await a.e(165).then(a.bind(a,165))).default;const{default:t}=await a.e(889).then(a.t.bind(a,889,23)),{default:e}=await a.e(503).then(a.t.bind(a,503,23));P.use(t),P.use(e)}}class F{static prepareSaveData(t,e,o,n){return{productionTableRows:this.cloneWithoutCircularReferences(t),powerTableRows:e,importsTableRows:o,checklist:this.cloneWithoutCircularReferences(n?.getChecklist()||[])}}static cloneWithoutCircularReferences(t){return t.map((t=>JSON.parse(JSON.stringify(t,((t,e)=>{if("productionTableRow"!==t&&"tableHandler"!==t)return e})))))}static saveProductionLine(t,e,o=!0){try{const n=new URL(window.location.href),i=parseInt(n.searchParams.get("id"));return s.saveData(t,i).then((t=>{if(t.success){if(!o)return!0;this.showSuccessMessage("Data successfully saved.");const n=t.data.newAndOldIds;return n.length>0&&this.updateProductionIds(n,e),!0}return this.showErrorMessage("An error occurred while saving the data. Please try again."),!1})).catch((t=>(console.error("Error while saving data:",t),this.showErrorMessage("An error occurred while saving the data. Please try again."),!1)))}catch(t){return console.error("Error while saving data:",t),this.showErrorMessage("An error occurred while saving the data. Please try again."),Promise.resolve(!1)}}static showSuccessMessage(t){this.showMessage("saveSuccessAlert",t)}static showErrorMessage(t){this.showMessage("saveErrorAlert",t)}static showMessage(t,e){const o=document.getElementById(t);o&&(o.textContent=e,o.classList.add("d-none"),o.classList.remove("show"),o.offsetWidth,o.classList.remove("d-none"),o.classList.add("show"),setTimeout((()=>{o.classList.remove("show"),setTimeout((()=>{o.classList.add("d-none")}),150)}),5e3))}static updateProductionIds(t,e){t.forEach((t=>{const o=t.new,n=t.old;$(`#recipes input[type="hidden"][name="production_id[]"][value="${n}"]`).val(o);const i=e.productionTableRows.find((t=>t.row_id===n));i&&(i.row_id=o)}))}}class M{htmlElement=$("#Checklist");canvasBody=this.htmlElement.find(".offcanvas-body");tableHandler;checklist=[];constructor(t){this.tableHandler=t,this.CheckForExistingChecklist(),this.attachEvents()}CheckForExistingChecklist(){const t=this.htmlElement.find("#checkListData").text();t?(JSON.parse(t).forEach(((t,e)=>{const o=t.production_id,n=1===t.been_build,i=1===t.been_tested,a=this.tableHandler.productionTableRows.find((t=>t.row_id==o));a&&this.checklist.push({index:e,productionRow:a,beenBuild:n,beenTested:i})})),this.buildChecklist(),this.generateMissingChecklist()):this.createChecklist()}buildChecklist(){this.checklist.forEach(((t,e)=>{this.createChecklistCard(t.productionRow,e,t.beenBuild,t.beenTested)})),this.initCheckBoxes()}createChecklist(){this.checklist=[],$("#Checklist .offcanvas-body").empty(),this.tableHandler.productionTableRows.forEach(((t,e)=>{this.createChecklistCard(t,e),this.checklist.push({index:e,productionRow:t,beenBuild:!1,beenTested:!1})})),this.initCheckBoxes()}createChecklistCard(t,e,o=!1,n=!1){const i=t.quantity;if(!t.recipe)return;const a=t.recipe?.name||"Unknown",l=t.recipe?.building?.name||"Unknown",s=C.calculateBuildingAmount(t.recipe,t);i<=0||(this.canvasBody.append(y.createCard(e,a,i,s,o,n,l)),this.attachToggleEvents(this.canvasBody.find(".card").last()))}updateCheckList(t){const e=this.checklist.find((e=>e.productionRow.row_id==t.row_id));if(e){const o=e.productionRow;if(!o.recipe)return;const n=o.quantity,i=o.recipe?.name||"Unknown",a=o.recipe?.building?.name||"Unknown",l=C.calculateBuildingAmount(o.recipe,o),s=this.canvasBody.find(`#check-${e.index}`);0===s.length?this.createChecklistCard(t,e.index):$(s).replaceWith(y.createCard(e.index,i,n,l,!1,!1,a)),this.checklist[e.index]={index:e.index,productionRow:t,beenBuild:!1,beenTested:!1}}else this.createChecklistCard(t,this.checklist.length),this.checklist.push({index:this.checklist.length,productionRow:t,beenBuild:!1,beenTested:!1});this.initCheckBoxes()}attachEvents(){const t=$("#Checklist #searchChecklist"),e=$("#Checklist #resetSearchChecklist");t.on("input",(()=>{const e=t.val();this.searchChecklist(e)})),e.on("click",(()=>{t.val(""),this.clearSearch()}))}attachToggleEvents(t){const e=t.find("input[type='checkbox'][for='tested']"),o=t.find("input[type='checkbox'][for='build']");e.on("change",(t=>{const e=$(t.target).closest(".card").attr("id")?.replace("check-","");e&&(this.checklist[+e].beenTested=$(t.target).is(":checked"))})),o.on("change",(t=>{const e=$(t.target).closest(".card").attr("id")?.replace("check-","");e&&(this.checklist[+e].beenBuild=$(t.target).is(":checked"))}))}generateMissingChecklist(){this.tableHandler.productionTableRows.forEach(((t,e)=>{this.checklist.find((e=>e.productionRow.row_id==t.row_id))||(this.createChecklistCard(t,e),this.checklist.push({index:e,productionRow:t,beenBuild:!1,beenTested:!1}))}))}searchChecklist(t){t=t.toLowerCase();const e=$("#Checklist .offcanvas-body");e.find(".alert").remove();const o=e.find(".card");o.each(((e,o)=>{$(o).find(".recipeName").text().toLowerCase().includes(t)?$(o).show():$(o).hide()})),o.toArray().some((t=>$(t).is(":visible")))||e.append("<div class='alert alert-danger'>No results found</div>")}clearSearch(){$("#Checklist .offcanvas-body").find(".card").each(((t,e)=>{$(e).show()}))}getChecklist(){return this.checklist.filter((t=>0!=+t.productionRow.quantity&&t.productionRow.quantity))}initCheckBoxes(){this.canvasBody.find("input[type='checkbox']").each(((t,e)=>{$(e).bootstrapToggle()}))}}class B{clockSpeed;useSomersloop;productionTableRow;tableHandler;htmlElement;contextMenu=null;constructor(t,e,o,n=100,i=!1){this.clockSpeed=n,this.useSomersloop=i,this.tableHandler=t,this.productionTableRow=e,this.htmlElement=o,this.addEventListeners()}addEventListeners(){this.htmlElement.find(".open-p-settings").on("click",(t=>{window.getSelection()?.toString()||(this.contextMenu?this.hideSettings():(this.checkIfAnyOpenAndClose(),t.preventDefault(),this.showSettings(t)))})),this.htmlElement.on("contextmenu",(t=>{window.getSelection()?.toString()||(t.preventDefault(),this.contextMenu?this.hideSettings():(this.checkIfAnyOpenAndClose(),this.showSettings(t)))})),$(window).on("resize",(()=>{this.contextMenu&&this.hideSettings()})),$(document).on("click",(t=>{$(t.target).closest(".context-menu").length||$(t.target).closest(".open-p-settings").length||(t.stopPropagation(),this.hideSettings())})),$(document).on("contextmenu",(t=>{$(t.target).closest("tr").length||$(t.target).closest(".context-menu").length||(t.stopPropagation(),this.hideSettings())}))}showSettings(t){const e=this.htmlElement,o=$('<div class="context-menu">');o.css("display","block"),o.css("top",(e?.offset()?.top??0)+(e?.height()??0)*(this.productionTableRow.doubleExport?2:1)+"px"),o.addClass("bg-body p-2 shadow rounded-bottom border border-primary"),o.css("left",e.offset()?.left+"px"),o.css("z-index","9999"),o.css("width",e.width()+"px"),o.css("height","auto"),o.css("position","absolute"),this.showOptions(o),o.appendTo("body"),this.contextMenu=o,this.initCheckBoxes()}showOptions(t){const e=$(`\n        <input type="number" class="form-control" id="maxClockSpeed" step="any" min="0" max="250"  value="${this.clockSpeed}">\n    `),o=$(`\n        <input type="checkbox" class="form-check-input" id="useSomersloop" ${this.useSomersloop?"checked":""}>\n    `),n=$('<div class="context-menu-wrapper">'),i=$('<div class="form-group">').append('<label class="form-check-label me-2" for="useSomersloop">Clock Speed</label>');i.append(e);const a=$('<div class="form-group">');a.append('<label class="form-check-label me-2" for="useSomersloop">Use Somersloop</label>'),a.append(o),n.append(i,"<hr>",a),n.appendTo(t),"function"==typeof $.fn.bootstrapToggle&&o.attr({"data-toggle":"toggle","data-onstyle":"success","data-offstyle":"danger","data-onlabel":"Yes","data-offlabel":"No"}).bootstrapToggle();const l=this.tableHandler.productionTableRows.findIndex((t=>t.row_id===this.productionTableRow.row_id));e.on("change",(()=>{this.updateSettings(),this.tableHandler.HandleProductionTable(this.productionTableRow,l,this.productionTableRow.quantity,"recipes",this.htmlElement),this.tableHandler.checklist?.updateCheckList(this.productionTableRow)})),o.on("change",(()=>{this.updateSettings(),this.tableHandler.HandleProductionTable(this.productionTableRow,l,this.productionTableRow.quantity,"recipes",this.htmlElement),this.tableHandler.checklist?.updateCheckList(this.productionTableRow)}))}updateSettings(){const t=$("#maxClockSpeed"),e=$("#useSomersloop");t.length>0&&(this.clockSpeed=this.validateClockSpeed(Number(t.val())),t.val(this.clockSpeed)),e.length>0&&(this.useSomersloop=e.is(":checked"))}validateClockSpeed(t){return t>250&&(t=250),t<0&&(t=0),t}hideSettings(){const t=this.contextMenu;t&&t.length>0&&(t.remove(),this.contextMenu=null)}initCheckBoxes(){this.contextMenu&&this.contextMenu.find('input[type="checkbox"]').each(((t,e)=>{$(e).bootstrapToggle()}))}checkIfAnyOpenAndClose(){const t=this.tableHandler.productionTableRows.filter((t=>null!==t.recipeSetting?.contextMenu));t.length>0&&t.forEach((t=>{t.recipeSetting?.hideSettings()}))}}class _{static async importData(t){if(!this.checkIfFileIsSelected()||!this.checkIfFileIsJson())return;const e=$("#importFile").prop("files")[0],o=new FileReader;o.readAsText(e),o.onload=e=>{const o=JSON.parse(e.target?.result);o.productionTable&&o.powerTable&&o.importTable?(t.saveData(o.productionTable,o.powerTable,o.importTable),this.showSuccessMessage("Data successfully imported.")):this.showErrorMessage("The selected file does not contain the required data.")}}static exportData(t){const e=t.productionTableRows,o=t.importsTableRows,n={productionTable:e,powerTable:t.powerTableRows,importTable:o},i=(new TextEncoder).encode(JSON.stringify(n)),a=new Blob([i],{type:"application/json"}),l=URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download=this.generateFileName(),s.click(),URL.revokeObjectURL(l),this.showSuccessMessage("Data successfully exported.")}static checkIfFileIsSelected(){const t=document.getElementById("importFile");if(!t.files?.length){t.classList.add("is-invalid");const e=t.nextElementSibling;return e&&e.classList.add("d-block"),!1}t.classList.remove("is-invalid");const e=t.nextElementSibling;return e&&e.classList.remove("d-block"),!0}static checkIfFileIsJson(){const t=document.getElementById("importFile"),e=t.files?.[0];if(e&&"application/json"!==e.type){t.classList.add("is-invalid");const e=t.nextElementSibling;return e&&(e.textContent="Please select a valid JSON file.",e.classList.add("d-block")),!1}return!0}static showMessage(t,e){const o=document.getElementById(t);o&&(o.textContent=e,o.classList.add("d-none"),o.classList.remove("show"),o.offsetWidth,o.classList.remove("d-none"),o.classList.add("show"),setTimeout((()=>{o.classList.remove("show"),setTimeout((()=>{o.classList.add("d-none")}),150)}),5e3))}static showSuccessMessage(t,e=1){1!==e||this.showMessage("successAlert",t)}static showErrorMessage(t,e=1){1!==e||this.showMessage("errorAlert",t)}static generateFileName(){const t=Intl.DateTimeFormat().resolvedOptions().timeZone,e=(new Date).toLocaleString("en-GB",{timeZone:t}).replace(/[\/\s,:]/g,"_");let o=$("#productionLineName").text().replace("Production Line - ","");return o=o.replace(/\s/g,"_"),`${o}_data_${e}.json`}}const L=new class{importsTableRows=[];productionTableRows=[];powerTableRows=[];settings=new k;checklist=null;visualisation=null;updated=!1;cacheVersion=$("#dataVersion").val();buildingCache=[];recipeCache=[];progressBar=$("#loading-progress");progressInterval=0;totalRows=0;finishedRows=0;recipeSettings=[];constructor(){this.initialize()}async initialize(){this.CheckCacheVersion();let t=500;(0===window.performance.getEntriesByType("navigation").length||window.performance.getEntriesByType("navigation").map((t=>t.type)).includes("reload"))&&(t=0),this.loadFromLocal(),await this.getTableData(),this.addEventListeners(),this.addButtonEventListeners(),this.addShortcuts(),setTimeout((()=>{this.hideLoading(),this.enableButtons()}),t),this.checklist=new M(this)}async getTableData(){this.totalRows=$("#recipes tbody tr").length,this.progressInterval=100/this.totalRows,this.recipeSettings=JSON.parse($("#settings-data").text()??{}),this.productionTableRows=await this.readTable("recipes",v,!0),await this.readTable("imports",l).then((t=>{this.importsTableRows=t})).catch((t=>{console.error("Failed to load imports table rows:",t)})),this.readTable("power",g).then((t=>{this.powerTableRows=t,this.saveToLocal(),this.showCacheAmount()})).catch((t=>{console.error("Failed to load power table rows:",t)}))}async readTable(t,e,o=!1){const n=$(`#${t} tbody tr`);let i=0;"power"===t&&(i=1);const a=[];for(let l=0;l<n.length-i;l++){const i=n[l],s=$(i).find("input, select"),p=[];if(s.each(((t,e)=>{"number"===$(e).attr("type")?p.push(Number($(e).val())):p.push($(e).val())})),"recipes"===t&&n[l+1]?.classList.contains("extra-output")){const t=n[l+1],e=$(t).find("input, select").map(((t,e)=>$(e).val())).get(),o=new r(e[0],Number(e[1]),Number(e[2]));p.push(!0,o),l++,this.finishedRows++}else"recipes"===t&&p.push(!1,null);"recipes"===t&&p.push(this.recipeCache),"power"===t&&(p.push(null),p.push(this.buildingCache));const u=e.create(...p).then((t=>(o&&this.updateProgress(),t)));if(a.push(u),"recipes"===t){const t=this.recipeSettings.find((t=>t.id===+p[0]));u.then((e=>{e.recipeSetting=new B(this,e,$(i),t?.clockSpeed||100,t?.useSomersloop||!1)}))}}return await Promise.all(a)}saveToLocal(){localStorage.setItem("cachedData",JSON.stringify({Version:this.cacheVersion,Recipe:this.recipeCache,Building:this.buildingCache}))}showCacheAmount(){$("#cachedRecipes").html(this.recipeCache.length.toString()),$("#cachedBuildings").html(this.buildingCache.length.toString())}emptyLocal(){localStorage.removeItem("cachedData")}loadFromLocal(){const t=JSON.parse(localStorage.getItem("cachedData")||"{}");this.recipeCache=t.Recipe||[],this.buildingCache=t.Building||[],$("#cachedRecipes").html(this.recipeCache.length.toString()),$("#cachedBuildings").html(this.buildingCache.length.toString())}CheckCacheVersion(){JSON.parse(localStorage.getItem("cachedData")||"{}").Version!==this.cacheVersion.toString()&&(this.emptyLocal(),this.loadFromLocal())}hideLoading(){$("#loading").addClass("d-none"),$("#main-content").removeClass("d-none")}showLoading(t=!0){this.progressBar.parent().removeClass("d-none"),$("#loading").removeClass("d-none"),$("#main-content").addClass("d-none"),t||this.progressBar.parent().addClass("d-none")}updateProgress(){this.finishedRows++;const t=Math.round(this.finishedRows*this.progressInterval);this.progressBar.css("width",`${t}%`),this.progressBar.attr("aria-valuenow",t),this.progressBar.html(`${t}%`)}async addEventListeners(){["imports","recipes","power"].forEach((t=>{$(`#${t} tbody`).find("input, select").each(((e,o)=>{$(o).on("change",(e=>{this.handleInputChange(e,t)}))}))}))}addSpecificEventListener(t){$(`#${t} tbody`).find("input, select").each(((e,o)=>{$(o).on("change",(e=>{this.handleInputChange(e,t)}))}))}async handleInputChange(t,e){const o=$(t.target),n=o.closest("tr").index(),i=o.closest("tr").prevAll(".extra-output").length,a=o.closest("td").index(),l=o.val();this.checkIfLastRow(o,e)&&this.checkIfSelect(o)&&this.addNewRow(e);const s=this.getRowByTableIdAndIndex(e,n-i);if(s&&a>=0)switch(this.updateRowData(s,a,l),e){case"imports":default:break;case"recipes":await this.HandleProductionTable(s,n,l,e,o),this.checklist?.updateCheckList(s);break;case"power":await this.HandlePowerTable(s,n,l,e,o)}}getRowByTableIdAndIndex(t,e){switch(t){case"imports":return this.importsTableRows[e];case"recipes":return this.productionTableRows[e];case"power":return this.powerTableRows[e];default:return null}}updateRowData(t,e,o){t[Object.keys(t)[e]]=o}updateRowInTable(t,e,o){const n=$(`#${t} tbody tr`);let i=$(n[e]);i.find("input, select").each(((t,e)=>{const n=Object.keys(o)[t];let i;i=o.recipe&&o.recipe.hasOwnProperty(n)?o.recipe[n]:o[n],$(e).val(i)})),"recipes"===t&&p.handleDoubleExport(o,i)}addNewRow(t){let e;e="power"===t?$(`#${t} tbody tr:nth-last-child(2)`):$(`#${t} tbody tr:last`);const o=e.clone();switch(o.find('input[type="number"]').val(0),o.find('input[type="text"]').val(""),o.find('input[name="power_clock_speed[]"]').val(100),o.find("select").prop("selectedIndex",0),o.insertAfter(e),o.find("input, select").each(((e,o)=>{$(o).on("change",(e=>{this.handleInputChange(e,t)}))})),t){case"imports":this.importsTableRows.push(new l);break;case"recipes":const t=new v;t.recipeSetting=new B(this,t,o),this.productionTableRows.push(t);break;case"power":this.powerTableRows.push(new g)}}checkIfLastRow(t,e){return"power"===e?t.closest("tr").is(":nth-last-child(2)"):t.closest("tr").is(":last-child")}checkIfSelect(t){return t.is("select")}UpdateOnIndex(t){for(let e=0;e<t.length;e++){const o=t[e],n=(this.productionTableRows[o],this.productionTableRows.slice(0,o).filter((t=>t.doubleExport)).length),i=this.productionTableRows[o];this.updateRowInTable("recipes",o+n,i)}}async HandlePowerTable(t,e,o,n,i){this.checkIfSelect(i)?await C.updateBuilding(t,o):t.Consumption=C.calculateSingleConsumption(t),this.updateRowInTable(n,e,t),C.updateTotalConsumption(this.powerTableRows)}showVisualization(){if(this.settings.autoImportExport){const t=x.calculateImports(this.productionTableRows);this.importsTableRows=t.importsTableRows}this.visualisation?this.updated?(this.updated=!1,this.visualisation.update()):this.visualisation.updateNodeColors():(this.updated=!1,this.visualisation=new E(this)),$("#showVisualization").modal("show")}saveData(t,e,o){this.productionTableRows=(t.pop(),t),this.powerTableRows=(e.pop(),e),this.importsTableRows=(o.pop(),o),this.generateTables(),this.powerTableRows.push(new g),this.productionTableRows.push(new v),this.importsTableRows.push(new l)}generateTables(){$("#power tbody").html(y.generatePowerTable(this.powerTableRows,b,C.calculateTotalConsumption(this.powerTableRows))),$("#imports tbody").html(y.generateImportsTableRows(this.importsTableRows)),$("#recipes tbody").html(y.generateProductionTableRows(this.productionTableRows)),this.addEventListeners()}disableButtons(){$("#save_button").addClass("disabled"),$("#save_button").prop("disabled",!0),$("#showPower").addClass("disabled"),$("#showPower").prop("disabled",!0)}enableButtons(){$("#save_button").removeClass("disabled"),$("#save_button").prop("disabled",!1),$("#showPower").removeClass("disabled"),$("#showPower").prop("disabled",!1),$("#showVisualizationButton").removeClass("disabled"),$("#showVisualizationButton").prop("disabled",!1),$("#edit_product_line").removeClass("disabled"),$("#edit_product_line").prop("disabled",!1),$("#showCheckList").removeClass("disabled"),$("#showCheckList").prop("disabled",!1)}async HandleProductionTable(t,e,o,n,i){if(this.updated=!0,await p.calculateProductionExport(t),this.checkIfSelect(i)&&await p.updateRecipe(t,o),this.updateRowInTable(n,e,t),this.settings.autoImportExport){const t=x.calculateImports(this.productionTableRows);this.importsTableRows=t.importsTableRows,this.UpdateOnIndex(t.indexes)}this.settings.autoPowerMachine&&(this.powerTableRows=C.calculateBuildings(this.productionTableRows,this.powerTableRows),this.addSpecificEventListener("power"))}async addShortcuts(){const t=this;document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("keydown",(e=>{const o=$("#showPowerModal"),n=$("#editProductionLine"),i=$("#helpModal"),a=$("#showVisualization");function l(){o.modal("hide"),n.modal("hide"),i.modal("hide"),a.modal("hide")}if(e.ctrlKey&&"s"===e.key&&(e.preventDefault(),F.saveProductionLine(F.prepareSaveData(t.productionTableRows,t.powerTableRows,t.importsTableRows,t.checklist),t)),e.ctrlKey&&"p"===e.key&&(e.preventDefault(),o.is(":hidden")?(l(),o.modal("show")):o.modal("hide")),e.ctrlKey&&"e"===e.key&&(e.preventDefault(),l(),n.is(":hidden")?(l(),n.modal("show")):n.modal("hide")),e.ctrlKey&&"h"===e.key&&(e.preventDefault(),i.is(":hidden")?(l(),i.find("#welcome").hide(),i.modal("show")):i.modal("hide")),e.ctrlKey&&"q"===e.key&&(e.preventDefault(),window.history.back()),"v"===e.key&&e.ctrlKey){if(["INPUT","SELECT","TEXTAREA","BUTTON"].includes(e.target.tagName))return;e.preventDefault(),a.is(":hidden")?(l(),t.showVisualization()):a.modal("hide")}}))}))}async addButtonEventListeners(){$("#showVisualizationButton").on("click",(()=>{this.showVisualization()})),$("#removeCache").on("click",(()=>{this.emptyLocal(),this.loadFromLocal(),this.showCacheAmount()}))}},N=$("#save_button");N.on("click",(t=>{t.shiftKey?(t.preventDefault(),F.saveProductionLine(F.prepareSaveData(L.productionTableRows,L.powerTableRows,L.importsTableRows,L.checklist),L),N.tooltip("hide"),N.blur()):(t.preventDefault(),L.showLoading(!1),F.saveProductionLine(F.prepareSaveData(L.productionTableRows,L.powerTableRows,L.importsTableRows,L.checklist),L,!1).then((t=>{t?window.location.href="/game_save?id="+encodeURIComponent($("#gameSaveId").val()):L.hideLoading()})))}));const U=$("#exportButton"),O=$("#importButton");return U.on("click",(()=>{_.exportData(L)})),O.on("click",(t=>{t.preventDefault(),_.importData(L)})),{}})()));